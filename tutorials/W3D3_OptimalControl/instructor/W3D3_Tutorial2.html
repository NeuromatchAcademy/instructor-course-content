
<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Tutorial 2: Optimal Control for Continuous State — Neuromatch Academy: Computational Neuroscience (instructor's version)</title>
<!-- Loaded before other Sphinx assets -->
<link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
<link as="font" crossorigin="" href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link href="../../../_static/pygments.css" rel="stylesheet" type="text/css">
<link href="../../../_static/styles/sphinx-book-theme.css" rel="stylesheet" type="text/css">
<link href="../../../_static/togglebutton.css" rel="stylesheet" type="text/css">
<link href="../../../_static/copybutton.css" rel="stylesheet" type="text/css">
<link href="../../../_static/mystnb.css" rel="stylesheet" type="text/css">
<link href="../../../_static/sphinx-thebe.css" rel="stylesheet" type="text/css"/>
<link href="../../../_static/custom.css" rel="stylesheet" type="text/css"/>
<link href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" rel="stylesheet" type="text/css"/>
<link href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" rel="stylesheet" type="text/css"/>
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf" rel="preload"/>
<script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
<script src="../../../_static/jquery.js"></script>
<script src="../../../_static/underscore.js"></script>
<script src="../../../_static/doctools.js"></script>
<script src="../../../_static/togglebutton.js"></script>
<script src="../../../_static/clipboard.min.js"></script>
<script src="../../../_static/copybutton.js"></script>
<script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
<script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
<script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
<script async="async" src="../../../_static/sphinx-thebe.js"></script>
<script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
<link href="../../../_static/nma-logo-square-4xp.png" rel="shortcut icon">
<link href="../../../genindex.html" rel="index" title="Index"/>
<link href="../../../search.html" rel="search" title="Search"/>
<link href="W3D3_Outro.html" rel="next" title="Outro"/>
<link href="W3D3_Tutorial1.html" rel="prev" title="Tutorial 1: Optimal Control for Discrete States"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="None" name="docsearch:language"/>
<!-- Google Analytics -->
</link></link></link></link></link></link></head>
<body data-offset="60" data-spy="scroll" data-target="#bd-toc-nav">
<!-- Checkboxes to toggle the left sidebar -->
<input aria-label="Toggle navigation sidebar" class="sidebar-toggle" id="__navigation" name="__navigation" type="checkbox"/>
<label class="overlay overlay-navbar" for="__navigation">
<div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input aria-label="Toggle in-page Table of Contents" class="sidebar-toggle" id="__page-toc" name="__page-toc" type="checkbox"/>
<label class="overlay overlay-pagetoc" for="__page-toc">
<div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>
<div class="container-fluid" id="banner"></div>
<div class="container-xl">
<div class="row">
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
<div class="bd-sidebar__content">
<div class="bd-sidebar__top"><div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../../index.html">
<!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
<img alt="logo" class="logo" src="../../../_static/nma-logo-square-4xp.png"/>
<h1 class="site-logo" id="site-title">Neuromatch Academy: Computational Neuroscience (instructor's version)</h1>
</a>
</div><form action="../../../search.html" class="bd-search d-flex align-items-center" method="get">
<i class="icon fas fa-search"></i>
<input aria-label="Search this book..." autocomplete="off" class="form-control" id="search-input" name="q" placeholder="Search this book..." type="search"/>
</form><nav aria-label="Main" class="bd-links" id="bd-docs-nav">
<div class="bd-toc-item active">
<ul class="nav bd-sidenav bd-sidenav__home-link">
<li class="toctree-l1">
<a class="reference internal" href="../../intro.html">
                    Introduction
                </a>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../Schedule/schedule_intro.html">
   Schedule
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox">
<label for="toctree-checkbox-1">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../Schedule/daily_schedules.html">
     General schedule
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../Schedule/shared_calendars.html">
     Shared calendars
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../Schedule/timezone_widget.html">
     Timezone widget
    </a>
</li>
</ul>
</input></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../TechnicalHelp/tech_intro.html">
   Technical Help
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox">
<label for="toctree-checkbox-2">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../TechnicalHelp/Jupyterbook.html">
     Using jupyterbook
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox">
<label for="toctree-checkbox-3">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../TechnicalHelp/Tutorial_colab.html">
       Using Google Colab
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../TechnicalHelp/Tutorial_kaggle.html">
       Using Kaggle
      </a>
</li>
</ul>
</input></li>
<li class="toctree-l2">
<a class="reference internal" href="../../TechnicalHelp/Discord.html">
     Using discord
    </a>
</li>
</ul>
</input></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="../../TechnicalHelp/Links_Policy.html">
   Quick links and policies
  </a>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="../../../prereqs/ComputationalNeuroscience.html">
   Prerequisites and preparatory materials for NMA Computational Neuroscience
  </a>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="../../../tatraining/TA_Training_CN.html">
   TA Training - Computational Neuroscience
  </a>
</li>
</ul>
<p class="caption">
<span class="caption-text">
  Pre-reqs Refresher
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/chapter_title.html">
   Neuro Video Series (W0D0)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
<label for="toctree-checkbox-4">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial1.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial2.html">
     Human Psychophysics
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial3.html">
     Behavioral Readout
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial4.html">
     Live in Lab
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial5.html">
     Brain Signals: Spiking Activity
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial6.html">
     Brain Signals: LFP
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial7.html">
     Brain Signals: EEG &amp; MEG
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial8.html">
     Brain Signals: fMRI
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial9.html">
     Brain Signals: Calcium Imaging
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial10.html">
     Stimulus Representation
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial11.html">
     Neurotransmitters
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial12.html">
     Neurons to Consciousness
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W0D1_PythonWorkshop1/chapter_title.html">
   Python Workshop 1 (W0D1)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
<label for="toctree-checkbox-5">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D1_PythonWorkshop1/instructor/W0D1_Tutorial1.html">
     Tutorial: LIF Neuron Part I
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W0D2_PythonWorkshop2/chapter_title.html">
   Python Workshop 2 (W0D2)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
<label for="toctree-checkbox-6">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D2_PythonWorkshop2/instructor/W0D2_Tutorial1.html">
     Tutorial 1: LIF Neuron Part II
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W0D3_LinearAlgebra/chapter_title.html">
   Linear Algebra (W0D3)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
<label for="toctree-checkbox-7">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D3_LinearAlgebra/instructor/W0D3_Tutorial1.html">
     Tutorial 1: Vectors
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D3_LinearAlgebra/instructor/W0D3_Tutorial2.html">
     Tutorial 2: Matrices
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D3_LinearAlgebra/instructor/W0D3_Tutorial3.html">
     Bonus Tutorial: Discrete Dynamical Systems
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D3_LinearAlgebra/instructor/W0D3_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D3_LinearAlgebra/instructor/W0D3_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W0D4_Calculus/chapter_title.html">
   Calculus (W0D4)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
<label for="toctree-checkbox-8">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D4_Calculus/instructor/W0D4_Tutorial1.html">
     Tutorial 1: Differentiation and Integration
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D4_Calculus/instructor/W0D4_Tutorial2.html">
     Tutorial 2: Differential Equations
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D4_Calculus/instructor/W0D4_Tutorial3.html">
     Tutorial 3: Numerical Methods
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D4_Calculus/instructor/W0D4_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W0D5_Statistics/chapter_title.html">
   Statistics (W0D5)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
<label for="toctree-checkbox-9">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D5_Statistics/instructor/W0D5_Tutorial1.html">
     Tutorial 1: Probability Distributions
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D5_Statistics/instructor/W0D5_Tutorial2.html">
     Tutorial 2: Statistical Inference
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D5_Statistics/instructor/W0D5_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D5_Statistics/instructor/W0D5_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
</ul>
<p class="caption">
<span class="caption-text">
  Intro to Modeling
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W1D1_ModelTypes/chapter_title.html">
   Model Types (W1D1)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
<label for="toctree-checkbox-10">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D1_ModelTypes/instructor/W1D1_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D1_ModelTypes/instructor/W1D1_Tutorial1.html">
     Tutorial 1: “What” models
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D1_ModelTypes/instructor/W1D1_Tutorial2.html">
     Tutorial 2: “How” models
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D1_ModelTypes/instructor/W1D1_Tutorial3.html">
     Tutorial 3: “Why” models
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D1_ModelTypes/instructor/W1D1_Tutorial4.html">
     Tutorial 4: Model Discussions
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D1_ModelTypes/instructor/W1D1_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D1_ModelTypes/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D1_ModelTypes/instructor/W1D1_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W2D1_ModelingPractice/chapter_title.html">
   Modeling Practice (W2D1)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
<label for="toctree-checkbox-11">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D1_ModelingPractice/instructor/W2D1_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D1_ModelingPractice/instructor/W2D1_Tutorial1.html">
     Tutorial 1: Framing the Question
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D1_ModelingPractice/instructor/W2D1_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D1_ModelingPractice/instructor/W2D1_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
</ul>
<p class="caption">
<span class="caption-text">
  Machine Learning
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W1D2_ModelFitting/chapter_title.html">
   Model Fitting (W1D2)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
<label for="toctree-checkbox-12">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/instructor/W1D2_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/instructor/W1D2_Tutorial1.html">
     Tutorial 1: Linear regression with MSE
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/instructor/W1D2_Tutorial2.html">
     Tutorial 2: Linear regression with MLE
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/instructor/W1D2_Tutorial3.html">
     Tutorial 3: Confidence intervals and bootstrapping
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/instructor/W1D2_Tutorial4.html">
     Tutorial 4: Multiple linear regression and polynomial regression
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/instructor/W1D2_Tutorial5.html">
     Tutorial 5: Model Selection: Bias-variance trade-off
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/instructor/W1D2_Tutorial6.html">
     Tutorial 6: Model Selection: Cross-validation
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/instructor/W1D2_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/instructor/W1D2_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W1D3_GeneralizedLinearModels/chapter_title.html">
   Generalized Linear Models (W1D3)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
<label for="toctree-checkbox-13">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D3_GeneralizedLinearModels/instructor/W1D3_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D3_GeneralizedLinearModels/instructor/W1D3_Tutorial1.html">
     Tutorial 1: GLMs for Encoding
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D3_GeneralizedLinearModels/instructor/W1D3_Tutorial2.html">
     Tutorial 2: Classifiers and regularizers
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D3_GeneralizedLinearModels/instructor/W1D3_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D3_GeneralizedLinearModels/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D3_GeneralizedLinearModels/instructor/W1D3_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W1D4_DimensionalityReduction/chapter_title.html">
   Dimensionality Reduction (W1D4)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
<label for="toctree-checkbox-14">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D4_DimensionalityReduction/instructor/W1D4_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D4_DimensionalityReduction/instructor/W1D4_Tutorial1.html">
     Tutorial 1: Geometric view of data
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D4_DimensionalityReduction/instructor/W1D4_Tutorial2.html">
     Tutorial 2: Principal Component Analysis
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D4_DimensionalityReduction/instructor/W1D4_Tutorial3.html">
     Tutorial 3: Dimensionality Reduction &amp; Reconstruction
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D4_DimensionalityReduction/instructor/W1D4_Tutorial4.html">
     Tutorial 4:  Nonlinear Dimensionality Reduction
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D4_DimensionalityReduction/instructor/W1D4_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D4_DimensionalityReduction/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D4_DimensionalityReduction/instructor/W1D4_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W1D5_DeepLearning/chapter_title.html">
   Deep Learning (W1D5)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
<label for="toctree-checkbox-15">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D5_DeepLearning/instructor/W1D5_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D5_DeepLearning/instructor/W1D5_Tutorial1.html">
     Tutorial 1: Decoding Neural Responses
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D5_DeepLearning/instructor/W1D5_Tutorial2.html">
     Tutorial 2: Convolutional Neural Networks
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D5_DeepLearning/instructor/W1D5_Tutorial3.html">
     Tutorial 3: Building and Evaluating Normative Encoding Models
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D5_DeepLearning/instructor/W1D5_Tutorial4.html">
     Bonus Tutorial: Diving Deeper into Decoding &amp; Encoding
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D5_DeepLearning/instructor/W1D5_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D5_DeepLearning/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D5_DeepLearning/instructor/W1D5_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../Bonus_Autoencoders/chapter_title.html">
   Autoencoders (Bonus)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
<label for="toctree-checkbox-16">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../Bonus_Autoencoders/instructor/Bonus_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../Bonus_Autoencoders/instructor/Bonus_Tutorial1.html">
     Tutorial 1: Intro to Autoencoders
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../Bonus_Autoencoders/instructor/Bonus_Tutorial2.html">
     Tutorial 2: Autoencoder extensions
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../Bonus_Autoencoders/instructor/Bonus_Tutorial3.html">
     Tutorial 3: Autoencoders applications
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../Bonus_Autoencoders/instructor/Bonus_Outro.html">
     Outro
    </a>
</li>
</ul>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../../Module_WrapUps/MachineLearning.html">
   Machine Learning Wrap-Up
  </a>
</li>
</ul>
<p class="caption">
<span class="caption-text">
  Dynamical Systems
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W2D2_LinearSystems/chapter_title.html">
   Linear Systems (W2D2)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
<label for="toctree-checkbox-17">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D2_LinearSystems/instructor/W2D2_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D2_LinearSystems/instructor/W2D2_Tutorial1.html">
     Tutorial 1: Linear dynamical systems
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D2_LinearSystems/instructor/W2D2_Tutorial2.html">
     Tutorial 2: Markov Processes
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D2_LinearSystems/instructor/W2D2_Tutorial3.html">
     Tutorial 3: Combining determinism and stochasticity
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D2_LinearSystems/instructor/W2D2_Tutorial4.html">
     Tutorial 4: Autoregressive models
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D2_LinearSystems/instructor/W2D2_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D2_LinearSystems/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D2_LinearSystems/instructor/W2D2_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W2D3_BiologicalNeuronModels/chapter_title.html">
   Biological Neuron Models (W2D3)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
<label for="toctree-checkbox-18">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D3_BiologicalNeuronModels/instructor/W2D3_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D3_BiologicalNeuronModels/instructor/W2D3_Tutorial1.html">
     Tutorial 1: The Leaky Integrate-and-Fire (LIF) Neuron Model
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D3_BiologicalNeuronModels/instructor/W2D3_Tutorial2.html">
     Tutorial 2: Effects of Input Correlation
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D3_BiologicalNeuronModels/instructor/W2D3_Tutorial3.html">
     Tutorial 3: Synaptic transmission - Models of static and dynamic synapses
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D3_BiologicalNeuronModels/instructor/W2D3_Tutorial4.html">
     Bonus Tutorial: Spike-timing dependent plasticity (STDP)
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D3_BiologicalNeuronModels/instructor/W2D3_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D3_BiologicalNeuronModels/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D3_BiologicalNeuronModels/instructor/W2D3_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W2D4_DynamicNetworks/chapter_title.html">
   Dynamic Networks (W2D4)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
<label for="toctree-checkbox-19">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D4_DynamicNetworks/instructor/W2D4_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D4_DynamicNetworks/instructor/W2D4_Tutorial1.html">
     Tutorial 1: Neural Rate Models
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D4_DynamicNetworks/instructor/W2D4_Tutorial2.html">
     Tutorial 2: Wilson-Cowan Model
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D4_DynamicNetworks/instructor/W2D4_Tutorial3.html">
     Bonus Tutorial: Extending the Wilson-Cowan Model
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D4_DynamicNetworks/instructor/W2D4_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D4_DynamicNetworks/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D4_DynamicNetworks/instructor/W2D4_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../../Module_WrapUps/DynamicalSystems.html">
   Dynamical Systems Wrap-Up
  </a>
</li>
</ul>
<p class="caption">
<span class="caption-text">
  Stochastic Processes
 </span>
</p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W3D1_BayesianDecisions/chapter_title.html">
   Bayesian Decisions (W3D1)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
<label for="toctree-checkbox-20">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D1_BayesianDecisions/instructor/W3D1_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D1_BayesianDecisions/instructor/W3D1_Tutorial1.html">
     Tutorial 1: Bayes with a binary hidden state
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D1_BayesianDecisions/instructor/W3D1_Tutorial2.html">
     Tutorial 2: Bayesian inference and decisions with continuous hidden state
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D1_BayesianDecisions/instructor/W3D1_Tutorial3.html">
     Bonus Tutorial : Fitting to data
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D1_BayesianDecisions/instructor/W3D1_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D1_BayesianDecisions/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D1_BayesianDecisions/instructor/W3D1_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W3D2_HiddenDynamics/chapter_title.html">
   Hidden Dynamics (W3D2)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
<label for="toctree-checkbox-21">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D2_HiddenDynamics/instructor/W3D2_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D2_HiddenDynamics/instructor/W3D2_Tutorial1.html">
     Tutorial 1: Sequential Probability Ratio Test
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D2_HiddenDynamics/instructor/W3D2_Tutorial2.html">
     Tutorial 2: Hidden Markov Model
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D2_HiddenDynamics/instructor/W3D2_Tutorial3.html">
     Tutorial 3: The Kalman Filter
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D2_HiddenDynamics/instructor/W3D2_Tutorial4.html">
     Bonus Tutorial 4: The Kalman Filter, part 2
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D2_HiddenDynamics/instructor/W3D2_Tutorial5.html">
     Bonus Tutorial 5: Expectation Maximization for spiking neurons
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D2_HiddenDynamics/instructor/W3D2_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D2_HiddenDynamics/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D2_HiddenDynamics/instructor/W3D2_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 current active has-children">
<a class="reference internal" href="../chapter_title.html">
   Optimal Control (W3D3)
  </a>
<input checked="" class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
<label for="toctree-checkbox-22">
<i class="fas fa-chevron-down">
</i>
</label>
<ul class="current">
<li class="toctree-l2">
<a class="reference internal" href="W3D3_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="W3D3_Tutorial1.html">
     Tutorial 1: Optimal Control for Discrete States
    </a>
</li>
<li class="toctree-l2 current active">
<a class="current reference internal" href="#">
     Tutorial 2: Optimal Control for Continuous State
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="W3D3_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="W3D3_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W3D4_ReinforcementLearning/chapter_title.html">
   Reinforcement Learning (W3D4)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
<label for="toctree-checkbox-23">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D4_ReinforcementLearning/instructor/W3D4_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D4_ReinforcementLearning/instructor/W3D4_Tutorial1.html">
     Tutorial 1: Learning to Predict
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D4_ReinforcementLearning/instructor/W3D4_Tutorial2.html">
     Tutorial 2: Learning to Act: Multi-Armed Bandits
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D4_ReinforcementLearning/instructor/W3D4_Tutorial3.html">
     Tutorial 3: Learning to Act: Q-Learning
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D4_ReinforcementLearning/instructor/W3D4_Tutorial4.html">
     Tutorial 4: Model-Based Reinforcement Learning
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D4_ReinforcementLearning/instructor/W3D4_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D4_ReinforcementLearning/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D4_ReinforcementLearning/instructor/W3D4_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W3D5_NetworkCausality/chapter_title.html">
   Network Causality (W3D5)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/>
<label for="toctree-checkbox-24">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D5_NetworkCausality/instructor/W3D5_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D5_NetworkCausality/instructor/W3D5_Tutorial1.html">
     Tutorial 1: Interventions
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D5_NetworkCausality/instructor/W3D5_Tutorial2.html">
     Tutorial 2: Correlations
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D5_NetworkCausality/instructor/W3D5_Tutorial3.html">
     Tutorial 3: Simultaneous fitting/regression
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D5_NetworkCausality/instructor/W3D5_Tutorial4.html">
     Tutorial 4: Instrumental Variables
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D5_NetworkCausality/instructor/W3D5_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D5_NetworkCausality/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D5_NetworkCausality/instructor/W3D5_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../../Module_WrapUps/StochasticProcesses.html">
   Stochastic Processes Wrap-Up
  </a>
</li>
</ul>
<p class="caption">
<span class="caption-text">
  Project Booklet
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="../../../projects/README.html">
   Introduction
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../../../projects/docs/project_guidance.html">
   Daily guide for projects
  </a>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../../projects/modelingsteps/intro.html">
   Modeling Step-by-Step Guide
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/>
<label for="toctree-checkbox-25">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../../projects/modelingsteps/ModelingSteps_1through4.html">
     Modeling Steps 1 - 4
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../../projects/modelingsteps/ModelingSteps_5through10.html">
     Modeling Steps 5 - 10
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../../projects/modelingsteps/TrainIllusionModel.html">
     Example Model Project: the Train Illusion
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../../projects/modelingsteps/TrainIllusionDataProject.html">
     Example Data Project: the Train Illusion
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../../projects/docs/datasets_overview.html">
   Datasets
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/>
<label for="toctree-checkbox-26">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../../projects/docs/neurons.html">
     Neurons
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" type="checkbox"/>
<label for="toctree-checkbox-27">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../../projects/neurons/README.html">
       Guide
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../../projects/neurons/neurons_videos.html">
       Overview videos
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../../projects/docs/fMRI.html">
     fMRI
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" type="checkbox"/>
<label for="toctree-checkbox-28">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../../projects/fMRI/README.html">
       Guide
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../../projects/fMRI/fMRI_videos.html">
       Overview videos
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../../projects/docs/ECoG.html">
     ECoG
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" type="checkbox"/>
<label for="toctree-checkbox-29">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../../projects/ECoG/README.html">
       Guide
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../../projects/ECoG/ECoG_videos.html">
       Overview videos
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../../projects/docs/behavior.html">
     Behavior
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" type="checkbox"/>
<label for="toctree-checkbox-30">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../../projects/behavior/README.html">
       Guide
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../../projects/behavior/behavior_videos.html">
       Overview videos
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../../projects/docs/theory.html">
     Theory
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" type="checkbox"/>
<label for="toctree-checkbox-31">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../../projects/theory/README.html">
       Guide
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../../../projects/docs/project_templates.html">
   Project Templates
  </a>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../../projects/docs/project_2020_highlights.html">
   Projects 2020
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" type="checkbox"/>
<label for="toctree-checkbox-32">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../../projects/docs/projects_2020/neurons.html">
     Neurons
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../../projects/docs/projects_2020/theory.html">
     Theory
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../../projects/docs/projects_2020/behavior.html">
     Behavior
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../../projects/docs/projects_2020/fMRI.html">
     fMRI
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../../projects/docs/projects_2020/eeg.html">
     EEG
    </a>
</li>
</ul>
</li>
</ul>
</div>
</nav></div>
<div class="bd-sidebar__bottom">
<!-- To handle the deprecated key -->
<div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>
</div>
</div>
<div id="rtd-footer-container"></div>
</div>
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
<div class="header-article row sticky-top noprint">
<div class="col py-1 d-flex header-article-main">
<div class="header-article__left">
<label class="headerbtn" data-placement="right" data-toggle="tooltip" for="__navigation" title="Toggle navigation">
<span class="headerbtn__icon-container">
<i class="fas fa-bars"></i>
</span>
</label>
</div>
<div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
<button aria-label="Launch interactive content" class="headerbtn menu-dropdown__trigger">
<i class="fas fa-rocket"></i>
</button>
<div class="menu-dropdown__content">
<ul>
</ul>
</div>
</div>
<button class="headerbtn" data-placement="bottom" data-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode">
<span class="headerbtn__icon-container">
<i class="fas fa-expand"></i>
</span>
</button>
<div class="menu-dropdown menu-dropdown-repository-buttons">
<button aria-label="Source repositories" class="headerbtn menu-dropdown__trigger">
<i class="fab fa-github"></i>
</button>
<div class="menu-dropdown__content">
<ul>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://github.com/NeuromatchAcademy/instructor-course-content" title="Source repository">
<span class="headerbtn__icon-container">
<i class="fab fa-github"></i>
</span>
<span class="headerbtn__text-container">repository</span>
</a>
</li>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://github.com/NeuromatchAcademy/instructor-course-content/issues/new?title=Issue%20on%20page%20%2Ftutorials/W3D3_OptimalControl/instructor/W3D3_Tutorial2.html&amp;body=Your%20issue%20content%20here." title="Open an issue">
<span class="headerbtn__icon-container">
<i class="fas fa-lightbulb"></i>
</span>
<span class="headerbtn__text-container">open issue</span>
</a>
</li>
</ul>
</div>
</div>
<div class="menu-dropdown menu-dropdown-download-buttons">
<button aria-label="Download this page" class="headerbtn menu-dropdown__trigger">
<i class="fas fa-download"></i>
</button>
<div class="menu-dropdown__content">
<ul>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="../../../_sources/tutorials/W3D3_OptimalControl/instructor/W3D3_Tutorial2.ipynb" title="Download source file">
<span class="headerbtn__icon-container">
<i class="fas fa-file"></i>
</span>
<span class="headerbtn__text-container">.ipynb</span>
</a>
</li>
<li>
<button class="headerbtn" data-placement="left" data-toggle="tooltip" onclick="printPdf(this)" title="Print to PDF">
<span class="headerbtn__icon-container">
<i class="fas fa-file-pdf"></i>
</span>
<span class="headerbtn__text-container">.pdf</span>
</button>
</li>
</ul>
</div>
</div>
<label class="headerbtn headerbtn-page-toc" for="__page-toc">
<span class="headerbtn__icon-container">
<i class="fas fa-list"></i>
</span>
</label>
</div>
</div>
<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
<div class="tocsection onthispage pt-5 pb-3">
<i class="fas fa-list"></i> Contents
    </div>
<nav aria-label="Page" id="bd-toc-nav">
<ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#">
   Tutorial 2: Optimal Control for Continuous State
  </a>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#tutorial-objectives">
   Tutorial Objectives
  </a>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#setup">
   Setup
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#figure-settings">
     Figure Settings
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#plotting-functions">
     Plotting Functions
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#helper-functions">
     Helper Functions
    </a>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-1-exploring-a-linear-dynamical-system-lds-with-open-loop-and-closed-loop-control">
   Section 1: Exploring a Linear Dynamical System (LDS) with Open-Loop and Closed-Loop Control
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-1-flying-through-space">
     Video 1: Flying Through Space
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#coding-exercise-1-implement-state-evolution-equations">
       Coding Exercise 1: Implement state evolution equations
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-1-1-explore-no-control-vs-open-loop-control-vs-closed-loop-control">
       Interactive Demo 1.1: Explore no control vs. open-loop control vs. closed-loop control
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-1-2-exploring-the-closed-loop-setting-further">
       Interactive Demo 1.2: Exploring the closed-loop setting further
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-2-designing-an-optimal-control-input-using-a-linear-quadratic-regulator-lqr">
   Section 2: Designing an optimal control input using a linear quadratic regulator (LQR)
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-2-linear-quadratic-regulator-lqr">
     Video 2: Linear quadratic regulator (LQR)
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-2-1-constraints-on-the-system">
     Section 2.1 Constraints on the system
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#setting-up-a-cost-function">
       Setting up a cost function
      </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-2-2-solving-lqr">
     Section 2.2 Solving LQR
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#coding-exercise-2-2-implement-the-cost-function">
       Coding Exercise 2.2: Implement the cost function
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-2-2-lqr-to-the-origin">
       Interactive Demo 2.2: LQR to the origin
      </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-2-3-the-tradeoff-between-state-cost-and-control-cost">
     Section 2.3: The tradeoff between state cost and control cost
    </a>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-3-lqr-for-tracking-a-time-varying-goal">
   Section 3: LQR for tracking a time-varying goal
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-3-tracking-a-moving-goal">
     Video 3: Tracking a moving goal
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-3-lqr-control-to-desired-time-varying-goal">
       Interactive Demo 3: LQR control to desired time-varying goal
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-4-control-of-an-partially-observed-state-using-a-linear-quadratic-gaussian-lqg-controller">
   Section 4: Control of an partially observed state using a Linear Quadratic Gaussian (LQG) controller
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-4-1-introducing-the-lqg-controller">
     Section 4.1 Introducing the LQG Controller
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-4-linear-quadratic-gaussian-lqg-control">
       Video 4: Linear Quadratic Gaussian (LQG) Control
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-4-1-the-kalman-filter-in-conjunction-with-a-linear-closed-loop-controller-lqg-control">
       Interactive Demo 4.1: The Kalman filter in conjunction with a linear closed-loop controller (LQG Control)
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-4-2-lqg-controller-output-with-varying-control-gains">
       Interactive Demo 4.2: LQG controller output with varying control gains
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-4-3-lqg-controller-with-varying-weight-on-the-control-effort-costs">
       Interactive Demo 4.3: LQG controller with varying weight on the control effort costs
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-4-4-how-does-the-process-noise-and-the-measurement-noise-influence-the-controlled-state-and-desired-action">
       Interactive Demo 4.4: How does the process noise and the measurement noise influence the controlled state and desired action?
      </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-4-2-noise-effects-on-the-lqg">
     Section 4.2 Noise effects on the LQG
    </a>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#summary">
   Summary
  </a>
</li>
</ul>
</nav>
</div>
</div>
<div class="article row">
<div class="col pl-md-3 pl-lg-5 content-container">
<!-- Table of contents that is only displayed when printing the page -->
<div class="onlyprint" id="jb-print-docs-body">
<h1>Tutorial 2: Optimal Control for Continuous State</h1>
<!-- Table of contents -->
<div id="print-main-content">
<div id="jb-print-toc">
<div>
<h2> Contents </h2>
</div>
<nav aria-label="Page">
<ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#">
   Tutorial 2: Optimal Control for Continuous State
  </a>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#tutorial-objectives">
   Tutorial Objectives
  </a>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#setup">
   Setup
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#figure-settings">
     Figure Settings
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#plotting-functions">
     Plotting Functions
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#helper-functions">
     Helper Functions
    </a>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-1-exploring-a-linear-dynamical-system-lds-with-open-loop-and-closed-loop-control">
   Section 1: Exploring a Linear Dynamical System (LDS) with Open-Loop and Closed-Loop Control
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-1-flying-through-space">
     Video 1: Flying Through Space
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#coding-exercise-1-implement-state-evolution-equations">
       Coding Exercise 1: Implement state evolution equations
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-1-1-explore-no-control-vs-open-loop-control-vs-closed-loop-control">
       Interactive Demo 1.1: Explore no control vs. open-loop control vs. closed-loop control
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-1-2-exploring-the-closed-loop-setting-further">
       Interactive Demo 1.2: Exploring the closed-loop setting further
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-2-designing-an-optimal-control-input-using-a-linear-quadratic-regulator-lqr">
   Section 2: Designing an optimal control input using a linear quadratic regulator (LQR)
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-2-linear-quadratic-regulator-lqr">
     Video 2: Linear quadratic regulator (LQR)
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-2-1-constraints-on-the-system">
     Section 2.1 Constraints on the system
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#setting-up-a-cost-function">
       Setting up a cost function
      </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-2-2-solving-lqr">
     Section 2.2 Solving LQR
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#coding-exercise-2-2-implement-the-cost-function">
       Coding Exercise 2.2: Implement the cost function
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-2-2-lqr-to-the-origin">
       Interactive Demo 2.2: LQR to the origin
      </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-2-3-the-tradeoff-between-state-cost-and-control-cost">
     Section 2.3: The tradeoff between state cost and control cost
    </a>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-3-lqr-for-tracking-a-time-varying-goal">
   Section 3: LQR for tracking a time-varying goal
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-3-tracking-a-moving-goal">
     Video 3: Tracking a moving goal
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-3-lqr-control-to-desired-time-varying-goal">
       Interactive Demo 3: LQR control to desired time-varying goal
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-4-control-of-an-partially-observed-state-using-a-linear-quadratic-gaussian-lqg-controller">
   Section 4: Control of an partially observed state using a Linear Quadratic Gaussian (LQG) controller
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-4-1-introducing-the-lqg-controller">
     Section 4.1 Introducing the LQG Controller
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-4-linear-quadratic-gaussian-lqg-control">
       Video 4: Linear Quadratic Gaussian (LQG) Control
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-4-1-the-kalman-filter-in-conjunction-with-a-linear-closed-loop-controller-lqg-control">
       Interactive Demo 4.1: The Kalman filter in conjunction with a linear closed-loop controller (LQG Control)
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-4-2-lqg-controller-output-with-varying-control-gains">
       Interactive Demo 4.2: LQG controller output with varying control gains
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-4-3-lqg-controller-with-varying-weight-on-the-control-effort-costs">
       Interactive Demo 4.3: LQG controller with varying weight on the control effort costs
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-4-4-how-does-the-process-noise-and-the-measurement-noise-influence-the-controlled-state-and-desired-action">
       Interactive Demo 4.4: How does the process noise and the measurement noise influence the controlled state and desired action?
      </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-4-2-noise-effects-on-the-lqg">
     Section 4.2 Noise effects on the LQG
    </a>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#summary">
   Summary
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<main id="main-content" role="main">
<div>
<p><a href="https://colab.research.google.com/github/NeuromatchAcademy/course-content/blob/main/tutorials/W3D3_OptimalControl/instructor/W3D3_Tutorial2.ipynb" target="_blank"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg"/></a>   <a href="https://kaggle.com/kernels/welcome?src=https://raw.githubusercontent.com/NeuromatchAcademy/course-content/main/tutorials/W3D3_OptimalControl/instructor/W3D3_Tutorial2.ipynb" target="_blank"><img alt="Open in Kaggle" src="https://kaggle.com/static/images/open-in-kaggle.svg"/></a></p>
<div class="section" id="tutorial-2-optimal-control-for-continuous-state">
<h1>Tutorial 2: Optimal Control for Continuous State<a class="headerlink" href="#tutorial-2-optimal-control-for-continuous-state" title="Permalink to this headline">¶</a></h1>
<p><strong>Week 3, Day 3: Optimal Control</strong></p>
<p><strong>By Neuromatch Academy</strong></p>
<p><strong>Content creators:</strong> Zhengwei Wu, Shreya Saxena, Xaq Pitkow</p>
<p><strong>Content reviewers:</strong> Karolina Stosio, Roozbeh Farhoodi, Saeed Salehi, Ella Batty, Spiros Chavlis, Matt Krause and Michael Waskom</p>
<p align="center"><img src="https://github.com/NeuromatchAcademy/widgets/blob/master/sponsors.png?raw=True"/></p></div>
<hr class="docutils"/>
<div class="section" id="tutorial-objectives">
<h1>Tutorial Objectives<a class="headerlink" href="#tutorial-objectives" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, we will implement a continuous control task. You will design control inputs for a linear dynamical system to reach a target state. The state here is continuous-valued, i.e., takes on any real number from <span class="math notranslate nohighlight">\(-\infty\)</span> to <span class="math notranslate nohighlight">\(\infty\)</span>.</p>
<p>You have already learned about control for binary states in Tutorial 1, and you have learned about stochastic dynamics, latent states, and measurements yesterday. Now we introduce you to the new concepts of designing a controller with full observation of the state (linear quadratic regulator - LQR), and under partial observability of the state (linear quadratic gaussian - LQG).</p>
<p>The running example we consider throughout the tutorial is a cat trying to catch a mouse in space using its handy little jet pack to navigate.</p>
<p>In this tutorial you will:</p>
<ul class="simple">
<li><p>Apply the ideas of optimal control to solve a toy example: Astrocat catching mice in space</p></li>
<li><p>Design an optimal controller with a full observation of the state (linear quadratic regulator - LQR)</p></li>
<li><p>Design an optimal controller under partial observability of the state (linear quadratic gaussian - LQG)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Tutorial slides</span>
<span class="c1"># @markdown These are the slides for all videos in this tutorial.</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">IFrame</span>
<span class="n">link_id</span> <span class="o">=</span> <span class="s2">"8j5rs"</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"If you want to download the slides: https://osf.io/download/</span><span class="si">{</span><span class="n">link_id</span><span class="si">}</span><span class="s2">/"</span><span class="p">)</span>
<span class="n">IFrame</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="sa">f</span><span class="s2">"https://mfr.ca-1.osf.io/render?url=https://osf.io/</span><span class="si">{</span><span class="n">link_id</span><span class="si">}</span><span class="s2">/?direct%26mode=render%26action=download%26mode=render"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">854</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">480</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils"/>
<div class="section" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">gridspec</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="figure-settings">
<h2>Figure Settings<a class="headerlink" href="#figure-settings" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Figure Settings</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = 'retina'
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/NeuromatchAcademy/course-content/main/nma.mplstyle"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plotting-functions">
<h2>Plotting Functions<a class="headerlink" href="#plotting-functions" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Plotting Functions</span>

<span class="k">def</span> <span class="nf">plot_vs_time</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">slabel</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">goal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">slabel</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">goal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">goal</span><span class="p">,</span> <span class="s1">'m--'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'goal $g$'</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Time"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">"upper right"</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">ylabel</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_kf_state_vs_time</span><span class="p">(</span><span class="n">latent_states</span><span class="p">,</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">goal</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

  <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>
  <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

  <span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">latent_states</span><span class="p">,</span> <span class="n">estimates</span><span class="p">,</span> <span class="s1">'r.'</span><span class="p">)</span>
  <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">latent_states</span><span class="p">,</span> <span class="n">latent_states</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">)</span>
  <span class="c1"># ax0.set_xlim([min(estimates), max(estimates)])</span>
  <span class="c1"># ax0.set_ylim([min(estimates), max(estimates)])</span>
  <span class="n">ax0</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Latent State'</span><span class="p">)</span>
  <span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Estimated State'</span><span class="p">)</span>
  <span class="n">ax0</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">'equal'</span><span class="p">)</span>

  <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">latent_states</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'Latent State'</span><span class="p">)</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">estimates</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'Estimated State'</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">goal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">goal</span><span class="p">,</span> <span class="s1">'m--'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'goal'</span><span class="p">)</span>

  <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Time'</span><span class="p">)</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'State'</span><span class="p">)</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">"upper right"</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="helper-functions">
<h2>Helper Functions<a class="headerlink" href="#helper-functions" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Helper Functions</span>

<span class="c1"># Global variables</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">standard_normal_noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">standard_normal_noise_meas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">gaussian</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">'Gaussian'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'mean'</span><span class="p">,</span> <span class="s1">'cov'</span><span class="p">])</span>

<span class="k">class</span> <span class="nc">ExerciseError</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
  <span class="k">pass</span>


<span class="k">def</span> <span class="nf">test_lds_class</span><span class="p">(</span><span class="n">lds_class</span><span class="p">):</span>
  <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">isclose</span>
  <span class="n">ldsys</span> <span class="o">=</span> <span class="n">lds_class</span><span class="p">(</span><span class="n">ini_state</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">noise_var</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">isclose</span><span class="p">(</span><span class="n">ldsys</span><span class="o">.</span><span class="n">dynamics</span><span class="p">(</span><span class="mf">.9</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1.8</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">ExerciseError</span><span class="p">(</span><span class="s2">"'dynamics' method is not correctly implemented!"</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">isclose</span><span class="p">(</span><span class="n">ldsys</span><span class="o">.</span><span class="n">dynamics_openloop</span><span class="p">(</span><span class="mf">.9</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ldsys</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">-</span><span class="mf">1.</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">ExerciseError</span><span class="p">(</span><span class="s2">"'dynamics_openloop' method is not correctly implemented!"</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">isclose</span><span class="p">(</span><span class="n">ldsys</span><span class="o">.</span><span class="n">dynamics_closedloop</span><span class="p">(</span><span class="mf">.9</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ldsys</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">+</span><span class="mf">.3</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mf">3.</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">ExerciseError</span><span class="p">(</span><span class="s2">"s[t] in 'dynamics_closedloop' method is not correctly implemented!"</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">isclose</span><span class="p">(</span><span class="n">ldsys</span><span class="o">.</span><span class="n">dynamics_closedloop</span><span class="p">(</span><span class="mf">.9</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ldsys</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">+</span><span class="mf">.3</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mf">.6</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">ExerciseError</span><span class="p">(</span><span class="s2">"a[t] in 'dynamics_closedloop' method is not correctly implemented!"</span><span class="p">)</span>
  <span class="n">ldsys</span><span class="o">.</span><span class="n">noise_var</span> <span class="o">=</span> <span class="mf">1.</span>
  <span class="k">if</span> <span class="n">isclose</span><span class="p">(</span><span class="n">ldsys</span><span class="o">.</span><span class="n">dynamics</span><span class="p">(</span><span class="mf">.9</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1.8</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">ExerciseError</span><span class="p">(</span><span class="s2">"Did you forget to add noise to your s[t+1] in 'dynamics'?"</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">isclose</span><span class="p">(</span><span class="n">ldsys</span><span class="o">.</span><span class="n">dynamics_openloop</span><span class="p">(</span><span class="mf">.9</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ldsys</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">-</span><span class="mf">1.</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">ExerciseError</span><span class="p">(</span><span class="s2">"Did you forget to add noise to your s[t+1] in 'dynamics_openloop'?"</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">isclose</span><span class="p">(</span><span class="n">ldsys</span><span class="o">.</span><span class="n">dynamics_closedloop</span><span class="p">(</span><span class="mf">.9</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ldsys</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">+</span><span class="mf">.3</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mf">3.</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">ExerciseError</span><span class="p">(</span><span class="s2">"Did you forget to add noise to your s[t+1] in 'dynamics_closedloop'?"</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">isclose</span><span class="p">(</span><span class="n">ldsys</span><span class="o">.</span><span class="n">dynamics_closedloop</span><span class="p">(</span><span class="mf">.9</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ldsys</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">+</span><span class="mf">.3</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mf">.6</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">ExerciseError</span><span class="p">(</span><span class="s2">"Your input a[t] should not be noisy in 'dynamics_closedloop'."</span><span class="p">)</span>

  <span class="nb">print</span><span class="p">(</span><span class="s1">'Well Done!'</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_lqr_class</span><span class="p">(</span><span class="n">lqr_class</span><span class="p">):</span>
  <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">isclose</span>
  <span class="n">lqreg</span> <span class="o">=</span> <span class="n">lqr_class</span><span class="p">(</span><span class="n">ini_state</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">noise_var</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
  <span class="n">lqreg</span><span class="o">.</span><span class="n">goal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">])</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">isclose</span><span class="p">(</span><span class="n">lqreg</span><span class="o">.</span><span class="n">calculate_J_state</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">25</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">ExerciseError</span><span class="p">(</span><span class="s2">"'calculate_J_state' method is not correctly implemented!"</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">isclose</span><span class="p">(</span><span class="n">lqreg</span><span class="o">.</span><span class="n">calculate_J_control</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="mi">25</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">ExerciseError</span><span class="p">(</span><span class="s2">"'calculate_J_control' method is not correctly implemented!"</span><span class="p">)</span>

  <span class="nb">print</span><span class="p">(</span><span class="s1">'Well Done!'</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<hr class="docutils"/>
<div class="section" id="section-1-exploring-a-linear-dynamical-system-lds-with-open-loop-and-closed-loop-control">
<h1>Section 1: Exploring a Linear Dynamical System (LDS) with Open-Loop and Closed-Loop Control<a class="headerlink" href="#section-1-exploring-a-linear-dynamical-system-lds-with-open-loop-and-closed-loop-control" title="Permalink to this headline">¶</a></h1>
<div class="section" id="video-1-flying-through-space">
<h2>Video 1: Flying Through Space<a class="headerlink" href="#video-1-flying-through-space" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_remove-input docutils container">
</div>
<p>In this example, a cat is trying to catch a mouse in space. The location of the mouse is the goal state <span class="math notranslate nohighlight">\(g\)</span>, here a static goal. Later on, we will make the goal time-varying, i.e., <span class="math notranslate nohighlight">\(g(t)\)</span>. The cat’s location is the state of the system <span class="math notranslate nohighlight">\(s_t\)</span>. The state has its internal dynamics: think of the cat drifting slowly in space. These dynamics are such that the state at the next time step <span class="math notranslate nohighlight">\(s_{t+1}\)</span> are a linear function of the current state <span class="math notranslate nohighlight">\(s_t\)</span>. There is some process noise affecting the state (think about engine corrosions on the little jetpack causing unintended movements) here modeled as Gaussian noise <span class="math notranslate nohighlight">\(w_t\)</span>.</p>
<p>The control input or action <span class="math notranslate nohighlight">\(a_t\)</span> is the action of the jet pack, which has an effect <span class="math notranslate nohighlight">\(Ba_t\)</span> on the state at the next time step <span class="math notranslate nohighlight">\(s_{t+1}\)</span>. In this tutorial, we will be designing the action <span class="math notranslate nohighlight">\(a_t\)</span> to reach the goal <span class="math notranslate nohighlight">\(g\)</span>, with known state dynamics.</p>
<p>Thus, our linear discrete-time system evolves according to the following equation:</p>
<div class="amsmath math notranslate nohighlight" id="equation-49cf1472-42d1-4d74-afc2-2f19847f561e">
<span class="eqno">(420)<a class="headerlink" href="#equation-49cf1472-42d1-4d74-afc2-2f19847f561e" title="Permalink to this equation">¶</a></span>\[\begin{align}
s_{t+1} &amp;= Ds_t + Ba_t + w_t \tag{1}\\
s_{0} &amp;= s_{init}
\end{align}\]</div>
<p>with</p>
<p><span class="math notranslate nohighlight">\(t\)</span>: time step, ranging from <span class="math notranslate nohighlight">\(1\)</span> to <span class="math notranslate nohighlight">\(T\)</span>, where <span class="math notranslate nohighlight">\(T\)</span> is the time horizon.</p>
<p><span class="math notranslate nohighlight">\(s_t\)</span>: state at time <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p><span class="math notranslate nohighlight">\(a_t\)</span>: action at time <span class="math notranslate nohighlight">\(t\)</span> (also known as “control input”).</p>
<p><span class="math notranslate nohighlight">\(w_t\)</span>: gaussian noise at time <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p><span class="math notranslate nohighlight">\(D\)</span>: transition matrix.</p>
<p><span class="math notranslate nohighlight">\(B\)</span>: input matrix.</p>
<br/>
<p>For simplicity, we will consider the 1D case, where the matrices reduce to scalars, and the states, control and noise are one-dimensional as well. Specifically, <span class="math notranslate nohighlight">\(D\)</span> and <span class="math notranslate nohighlight">\(B\)</span> are scalars.</p>
<p>We will consider the goal <span class="math notranslate nohighlight">\(g\)</span> to be the origin, i.e., <span class="math notranslate nohighlight">\(g=0\)</span>, for Exercises 1 and 2.2. Later on, we will explore scenarios where the goal state changes over time <span class="math notranslate nohighlight">\(g(t)\)</span>.</p>
<br/>
<p><strong>Stability</strong></p>
<p>The system is stable, i.e., the output remains finite for any finite initial condition <span class="math notranslate nohighlight">\(s_{init}\)</span>, if <span class="math notranslate nohighlight">\(|D| &lt; 1\)</span>. Note that if the state dynamics are stable, the state eventually reaches <span class="math notranslate nohighlight">\(0\)</span> (No control is needed!). However, when <span class="math notranslate nohighlight">\(|D|&gt;1\)</span> or the goal <span class="math notranslate nohighlight">\(g \neq 0\)</span> selecting an appropriate sequence of actions becomes essential to completing the task.</p>
<br/>
<p><strong>Open-loop control and Closed-loop linear control</strong></p>
<p>In <em>open-loop control</em>, <span class="math notranslate nohighlight">\(a_t\)</span> is not a function of <span class="math notranslate nohighlight">\(s_t\)</span>. In <em>closed-loop linear control</em>, <span class="math notranslate nohighlight">\(a_t\)</span> is a linear function of the state <span class="math notranslate nohighlight">\(s_t\)</span>. Specifically, <span class="math notranslate nohighlight">\(a_t\)</span> is the control gain, <span class="math notranslate nohighlight">\(L_t\)</span>, multiplied by <span class="math notranslate nohighlight">\(s_t\)</span>, i.e., <span class="math notranslate nohighlight">\(a_t=L_t s_t\)</span>.</p>
<p>In the next excercise, you will explore what happens when nothing is controlling the system, when the system is being controlled following an open-loop control policy, and when the system is under closed-loop linear control.</p>
<div class="section" id="coding-exercise-1-implement-state-evolution-equations">
<h3>Coding Exercise 1: Implement state evolution equations<a class="headerlink" href="#coding-exercise-1-implement-state-evolution-equations" title="Permalink to this headline">¶</a></h3>
<p>Implement the state evolution equations in the class methods as provided below, for the following cases:</p>
<p>(a) no control: <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">dynamics</span></code></p>
<p>(b) open-loop control: <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">dynamics_openloop</span></code></p>
<p>(c) closed-loop control: <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">dynamics_closedloop</span></code></p>
<br/>
<p><strong>Tip:</strong> refer to Equation (1) above. The provided code uses the same notation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="k">class</span> <span class="nc">LDS</span><span class="p">:</span>
<span class="w">  </span><span class="sd">"""</span>
<span class="sd">    T: Length of timeline (global, fixed variable)</span>
<span class="sd">    standard_normal_noise: Global noise of length T drawn from N(0, 1)</span>
<span class="sd">    noise: Gaussian noise N(mean, var) = mean + sqrt(var) * standard_normal_noise</span>
<span class="sd">    ...</span>
<span class="sd">  """</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ini_state</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">noise_var</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">static_noise</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ini_state</span> <span class="o">=</span> <span class="n">ini_state</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">noise_var</span> <span class="o">=</span> <span class="n">noise_var</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">static_noise</span> <span class="o">=</span> <span class="n">static_noise</span>

  <span class="k">def</span> <span class="nf">dynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">D</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>  <span class="c1"># states initialization</span>
    <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ini_state</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_noise</span><span class="p">:</span>
      <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noise_var</span><span class="p">)</span> <span class="o">*</span> <span class="n">standard_normal_noise</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noise_var</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
      <span class="c1">####################################################################</span>
      <span class="c1">## Insert your code here to fill with the state dynamics equation</span>
      <span class="c1">## without any control input</span>
      <span class="c1">## complete the function and remove</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Exercise: Please complete 'dynamics'"</span><span class="p">)</span>
      <span class="c1">####################################################################</span>
      <span class="c1"># calculate the state of t+1</span>
      <span class="n">s</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>

    <span class="k">return</span> <span class="n">s</span>

  <span class="k">def</span> <span class="nf">dynamics_openloop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">D</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">B</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>  <span class="c1"># states initialization</span>
    <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ini_state</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_noise</span><span class="p">:</span>
      <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noise_var</span><span class="p">)</span> <span class="o">*</span> <span class="n">standard_normal_noise</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noise_var</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
      <span class="c1">####################################################################</span>
      <span class="c1">## Insert your code here to fill with the state dynamics equation</span>
      <span class="c1">## with open-loop control input a[t]</span>
      <span class="c1">## complete the function and remove</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Please complete 'dynamics_openloop'"</span><span class="p">)</span>
      <span class="c1">####################################################################</span>
      <span class="c1"># calculate the state of t+1</span>
      <span class="n">s</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>

    <span class="k">return</span> <span class="n">s</span>

  <span class="k">def</span> <span class="nf">dynamics_closedloop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">D</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">B</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">L</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>  <span class="c1"># states initialization</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ini_state</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_noise</span><span class="p">:</span>
      <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noise_var</span><span class="p">)</span> <span class="o">*</span> <span class="n">standard_normal_noise</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noise_var</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
      <span class="c1">####################################################################</span>
      <span class="c1">## Insert your code here to fill with the state dynamics equation</span>
      <span class="c1">## with closed-loop control input as a function of control gain L.</span>
      <span class="c1">## complete the function and remove</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Please complete 'dynamics_closedloop'"</span><span class="p">)</span>
      <span class="c1">####################################################################</span>
      <span class="c1"># calculate the current action</span>
      <span class="n">a</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
      <span class="c1"># calculate the next state</span>
      <span class="n">s</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>

    <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">a</span>


<span class="c1"># Test your function</span>
<span class="n">test_lds_class</span><span class="p">(</span><span class="n">LDS</span><span class="p">)</span>

</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to_remove solution</span>
<span class="k">class</span> <span class="nc">LDS</span><span class="p">:</span>
<span class="w">  </span><span class="sd">"""</span>
<span class="sd">    T: Length of timeline (global, fixed variable)</span>
<span class="sd">    standard_normal_noise: Global noise of length T drawn from N(0, 1)</span>
<span class="sd">    noise: Gaussian noise N(mean, var) = mean + sqrt(var) * standard_normal_noise</span>
<span class="sd">    ...</span>
<span class="sd">  """</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ini_state</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">noise_var</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">static_noise</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ini_state</span> <span class="o">=</span> <span class="n">ini_state</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">noise_var</span> <span class="o">=</span> <span class="n">noise_var</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">static_noise</span> <span class="o">=</span> <span class="n">static_noise</span>

  <span class="k">def</span> <span class="nf">dynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">D</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>  <span class="c1"># states initialization</span>
    <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ini_state</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_noise</span><span class="p">:</span>
      <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noise_var</span><span class="p">)</span> <span class="o">*</span> <span class="n">standard_normal_noise</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noise_var</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
      <span class="c1"># calculate the state of t+1</span>
      <span class="n">s</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span> <span class="o">*</span> <span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">noise</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">s</span>

  <span class="k">def</span> <span class="nf">dynamics_openloop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">D</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">B</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>  <span class="c1"># states initialization</span>
    <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ini_state</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_noise</span><span class="p">:</span>
      <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noise_var</span><span class="p">)</span> <span class="o">*</span> <span class="n">standard_normal_noise</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noise_var</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
      <span class="c1"># calculate the state of t+1</span>
      <span class="n">s</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span> <span class="o">*</span> <span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">noise</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">s</span>

  <span class="k">def</span> <span class="nf">dynamics_closedloop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">D</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">B</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">L</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>  <span class="c1"># states initialization</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ini_state</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_noise</span><span class="p">:</span>
      <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noise_var</span><span class="p">)</span> <span class="o">*</span> <span class="n">standard_normal_noise</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noise_var</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
      <span class="c1"># calculate the current action</span>
      <span class="n">a</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
      <span class="c1"># calculate the next state</span>
      <span class="n">s</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span> <span class="o">*</span> <span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">noise</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">a</span>


<span class="c1"># Test your function</span>
<span class="n">test_lds_class</span><span class="p">(</span><span class="n">LDS</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="interactive-demo-1-1-explore-no-control-vs-open-loop-control-vs-closed-loop-control">
<h3>Interactive Demo 1.1: Explore no control vs. open-loop control vs. closed-loop control<a class="headerlink" href="#interactive-demo-1-1-explore-no-control-vs-open-loop-control-vs-closed-loop-control" title="Permalink to this headline">¶</a></h3>
<p>Once your code above passes the test, use the interactive demo below to visualize the effects of different kinds of control inputs.</p>
<p>(a) For the no-control case, can you identify two distinct outcomes, depending on the value of D? Why?</p>
<p>(b) The open-loop controller works well–or does it? Are there any problems in in challenging (high noise) conditions.</p>
<p>(c) Does the closed-loop controller fare better with the noise? Vary the values of <span class="math notranslate nohighlight">\(L\)</span> and find a range where it quickly reaches the goal.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@markdown Make sure you execute this cell to enable the widget!</span>
<span class="c1">#@markdown Play around (attentively) with **`a`** and **`L`** to see the effect on the open-loop controlled and closed-loop controlled state.</span>

<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">'''&lt;style&gt;.widget-label { min-width: 15ex !important; }&lt;/style&gt;'''</span><span class="p">))</span>

<span class="nd">@widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">D</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"D"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.05</span><span class="p">),</span>
                  <span class="n">L</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"L"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">0.6</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.</span><span class="p">),</span>
                  <span class="n">a</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"a"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">2.</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.</span><span class="p">),</span>
                  <span class="n">B</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"B"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">3.</span><span class="p">),</span>
                  <span class="n">noise_var</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="mf">.1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"noise_var"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">.2</span><span class="p">),</span>
                  <span class="n">ini_state</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"ini_state"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">10.</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">simulate_lds</span><span class="p">(</span><span class="n">D</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">L</span><span class="o">=-</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">a</span><span class="o">=-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">noise_var</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">ini_state</span><span class="o">=</span><span class="mf">2.</span><span class="p">):</span>
<span class="w">  </span><span class="sd">"""</span>
<span class="sd">    ...</span>
<span class="sd">  """</span>
  <span class="n">static_noise</span> <span class="o">=</span> <span class="kc">True</span>

  <span class="c1"># linear dynamical system</span>
  <span class="n">lds</span> <span class="o">=</span> <span class="n">LDS</span><span class="p">(</span><span class="n">ini_state</span><span class="p">,</span> <span class="n">noise_var</span><span class="p">,</span> <span class="n">static_noise</span><span class="p">)</span>

  <span class="c1"># No control</span>
  <span class="n">s_no_control</span><span class="o">=</span><span class="n">lds</span><span class="o">.</span><span class="n">dynamics</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>

  <span class="c1"># Open loop control</span>
  <span class="n">at</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
  <span class="n">s_open_loop</span> <span class="o">=</span> <span class="n">lds</span><span class="o">.</span><span class="n">dynamics_openloop</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">at</span><span class="p">)</span>

  <span class="c1"># Closed loop control</span>
  <span class="n">Lt</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="n">L</span>
  <span class="n">s_closed_loop</span><span class="p">,</span> <span class="n">a_closed_loop</span> <span class="o">=</span> <span class="n">lds</span><span class="o">.</span><span class="n">dynamics_closedloop</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">Lt</span><span class="p">)</span>

  <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s_no_control</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'No control'</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s_open_loop</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Open Loop with a = </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s_closed_loop</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Closed Loop with L = </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">L</span><span class="p">))</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="s1">'m--'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'goal'</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'LDS State Evolution'</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'State'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Time'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">"upper right"</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to_remove explanation</span>

<span class="sd">"""</span>
<span class="sd">In Exercise 1.2, you should have noticed the following:</span>
<span class="sd">* No control (blue): the dynamics parameter D controls how fast the dynamics decay</span>
<span class="sd">  towards 0. For -1&lt;D&lt;1, the system is stable and therefore approaches zero quickly.</span>
<span class="sd">  However, D&gt;1 produces an unstable system, causing , you should have</span>
<span class="sd">  noticed that the 'no control' state (blue curve) rapidly explodes</span>
<span class="sd">  (i.e., heads off to infinity)</span>
<span class="sd">* Open-loop control: While the open-loop state (green curve) often reaches the goal</span>
<span class="sd">  quickly, it may not stay there. Under high noise conditions, it tends to</span>
<span class="sd">  drift away from the goal, though you may not see this in every simulation.</span>
<span class="sd">* Closed-loop control: The closed-loop state (red curve) reaches the goal and</span>
<span class="sd">  stays there even in the presence of noise. It converges especially quickly for</span>
<span class="sd">  Ls around 0.45</span>
<span class="sd">  Remember that in closed-loop control,</span>
<span class="sd">  we have a[t]=L[t] * s[t] $. Note that with a constant control gain $L[t]=L,</span>
<span class="sd">  the state evolution equations can be rearranged to show that the stability of</span>
<span class="sd">  the closed-loop system now depends on the value of D+BL. (See Equation 2, below).</span>
<span class="sd">  If $|D+BL|&lt;1$, our closed-loop system will be stable. More generally, you can</span>
<span class="sd">  view the role of a closed-loop control input as changing the system *dynamics*</span>
<span class="sd">  in an optimal way to reach the goal.</span>
<span class="sd">"""</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="interactive-demo-1-2-exploring-the-closed-loop-setting-further">
<h3>Interactive Demo 1.2: Exploring the closed-loop setting further<a class="headerlink" href="#interactive-demo-1-2-exploring-the-closed-loop-setting-further" title="Permalink to this headline">¶</a></h3>
<p>Execute the cell below to visualize the MSE between the state and goal, as a function of control gain <span class="math notranslate nohighlight">\(L\)</span>. You should see a U-shaped curve, with a minimum MSE. The control gain at which the minimum MSE is reached, is the ‘optimal’ constant control gain for minimizing MSE, here called the numerical optimum.</p>
<p>A green dashed line is shown <span class="math notranslate nohighlight">\(L = -\frac{D}{B}\)</span> with <span class="math notranslate nohighlight">\(D=1.1\)</span> and <span class="math notranslate nohighlight">\(B=2\)</span>. Why is this the theoretical optimal control gain for minimizing MSE of the state <span class="math notranslate nohighlight">\(s\)</span> to the goal <span class="math notranslate nohighlight">\(g=0\)</span>? Examine how the states evolve with a constant gain <span class="math notranslate nohighlight">\(L\)</span>.</p>
<div class="amsmath math notranslate nohighlight" id="equation-b60d8267-03a1-42a3-bc8d-d4eafbfcb05d">
<span class="eqno">(421)<a class="headerlink" href="#equation-b60d8267-03a1-42a3-bc8d-d4eafbfcb05d" title="Permalink to this equation">¶</a></span>\[\begin{align}
s_{t+1} &amp;= Ds_t + Ba_t + w_t \\
&amp;= Ds_t + B(Ls_t) + w_t \\
&amp;= (D+BL)s_t + w_t \tag{2}
\end{align}\]</div>
<p>Execute this cell to visualize MSE between state and goal, as a function of control gain</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@markdown Execute this cell to visualize MSE between state and goal, as a function of control gain</span>
<span class="k">def</span> <span class="nf">calculate_plot_mse</span><span class="p">():</span>
  <span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">noise_var</span><span class="p">,</span> <span class="n">ini_state</span> <span class="o">=</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">2.</span>
  <span class="n">num_iterations</span> <span class="o">=</span> <span class="mi">50</span>
  <span class="n">num_candidates</span> <span class="o">=</span> <span class="mi">100</span>

  <span class="n">control_gain_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">num_candidates</span><span class="p">)</span>
  <span class="n">mse_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">num_candidates</span><span class="p">,</span> <span class="n">num_iterations</span><span class="p">])</span>

  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_iterations</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_candidates</span><span class="p">):</span>
      <span class="n">lds</span> <span class="o">=</span> <span class="n">LDS</span><span class="p">(</span><span class="n">ini_state</span><span class="p">,</span> <span class="n">noise_var</span><span class="p">)</span>
      <span class="n">L</span> <span class="o">=</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">control_gain_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">s</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">lds</span><span class="o">.</span><span class="n">dynamics_closedloop</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
      <span class="n">mse_array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

  <span class="n">opt</span> <span class="o">=</span> <span class="o">-</span><span class="n">control_gain_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mse_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))]</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">-</span><span class="n">control_gain_array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mse_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="s1">'b'</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=-</span><span class="n">D</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'g'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"control gain (L)"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"MSE between state and goal"</span> <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">"MSE vs control gain, L*=</span><span class="si">{</span><span class="n">opt</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
  <span class="k">return</span> <span class="n">opt</span>

<span class="n">opt</span> <span class="o">=</span> <span class="n">calculate_plot_mse</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now, let’s visualize the evolution of the system as we change the control gain.</p>
<p>Using the next demo, explore the behavior of the system when over- and under- ambitious values of <span class="math notranslate nohighlight">\(L\)</span> are used. The initial position of the slider corresponds to the optimal control gain <span class="math notranslate nohighlight">\(L^*\)</span>, the one that gets us the minimum MSE.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@markdown Make sure you execute this cell to enable the widget!</span>
<span class="c1">#@markdown Explore different values of control gain **`L`** (close to optimal, over- and under- ambitious) \\</span>

<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">'''&lt;style&gt;.widget-label { min-width: 15ex !important; }&lt;/style&gt;'''</span><span class="p">))</span>

<span class="nd">@widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"L"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">1.05</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.051</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">simulate_L</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>

  <span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">noise_var</span><span class="p">,</span> <span class="n">ini_state</span> <span class="o">=</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">2.</span>
  <span class="n">static_noise</span>  <span class="o">=</span> <span class="kc">True</span>
  <span class="n">lds</span> <span class="o">=</span> <span class="n">LDS</span><span class="p">(</span><span class="n">ini_state</span><span class="p">,</span> <span class="n">noise_var</span><span class="p">,</span> <span class="n">static_noise</span><span class="p">)</span>
  <span class="c1"># Closed loop control with the numerical optimal control gain</span>
  <span class="n">Lt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">L</span>
  <span class="n">s_closed_loop_choice</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">lds</span><span class="o">.</span><span class="n">dynamics_closedloop</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">Lt</span><span class="p">)</span>
  <span class="c1"># Closed loop control with the theoretical optimal control gain</span>
  <span class="n">L_theory</span> <span class="o">=</span> <span class="o">-</span> <span class="n">D</span> <span class="o">/</span> <span class="n">B</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
  <span class="n">s_closed_loop_theoretical</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">lds</span><span class="o">.</span><span class="n">dynamics_closedloop</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">L_theory</span><span class="p">)</span>
  <span class="c1"># Plotting closed loop state evolution with both theoretical and numerical optimal control gains</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
  <span class="n">plot_vs_time</span><span class="p">(</span><span class="n">s_closed_loop_theoretical</span><span class="p">,</span>
                <span class="s1">'Closed Loop (Theoretical optimal control gain)'</span><span class="p">,</span><span class="s1">'b'</span><span class="p">)</span>
  <span class="n">plot_vs_time</span><span class="p">(</span><span class="n">s_closed_loop_choice</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">'Closed Loop (your choice of L = </span><span class="si">{</span><span class="n">L</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)'</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">,</span>
                <span class="n">goal</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">"State"</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Closed-loop State Evolution. L* = </span><span class="si">{</span><span class="n">opt</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to_remove explanation</span>

<span class="sd">"""</span>
<span class="sd">In Demo 1.2, you should have seen that the optimal control gain (L = -0.45) takes a</span>
<span class="sd">short amount of time to get to the goal, and then stays there. We can try to get</span>
<span class="sd">to the goal in an even shorter time using an 'over-ambitious' control gain (L &lt; -0.45), but</span>
<span class="sd">this may actually overshoot the goal and may cause oscillations in the system,</span>
<span class="sd">thus increasing the MSE. On the other hand, an 'under-ambitious' control gain</span>
<span class="sd">takes a longer time to get to the goal and thus increases the MSE.</span>
<span class="sd">Finally, at L&gt;0, the system runs away to infinity.</span>
<span class="sd">Why is L=-D/B optimal for reaching our goal? Recall that our next state is</span>
<span class="sd">(D+B*L)*s[t] + noise. Plugging that L=-D/B causes that leading term to become zero,</span>
<span class="sd">which is our goal. Since the noise has zero mean, it's not possible to do any better!</span>
<span class="sd">"""</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<hr class="docutils"/>
<div class="section" id="section-2-designing-an-optimal-control-input-using-a-linear-quadratic-regulator-lqr">
<h1>Section 2: Designing an optimal control input using a linear quadratic regulator (LQR)<a class="headerlink" href="#section-2-designing-an-optimal-control-input-using-a-linear-quadratic-regulator-lqr" title="Permalink to this headline">¶</a></h1>
<div class="section" id="video-2-linear-quadratic-regulator-lqr">
<h2>Video 2: Linear quadratic regulator (LQR)<a class="headerlink" href="#video-2-linear-quadratic-regulator-lqr" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_remove-input docutils container">
</div>
</div>
<div class="section" id="section-2-1-constraints-on-the-system">
<h2>Section 2.1 Constraints on the system<a class="headerlink" href="#section-2-1-constraints-on-the-system" title="Permalink to this headline">¶</a></h2>
<p>Now we will start imposing additional constraints on our system. For example, if you explored different values for <span class="math notranslate nohighlight">\(s_{init}\)</span> above, you would have seen very large values for <span class="math notranslate nohighlight">\(a_t\)</span> in order to get to the mouse in a short amount of time. However, perhaps the design of our jetpack makes it dangerous to use large amounts of fuel in a single timestep. We certainly do not want to explode, so we would like to keep the actions <span class="math notranslate nohighlight">\(a_t\)</span> as small as possible while still maintaining good control.</p>
<p>Moreover, in Exercise 1, we had restricted ourselves to a static control gain <span class="math notranslate nohighlight">\(L_t \equiv L\)</span>. How would we vary it if we could?</p>
<p>This leads us to a more principled way of designing the optimal control input.</p>
<div class="section" id="setting-up-a-cost-function">
<h3>Setting up a cost function<a class="headerlink" href="#setting-up-a-cost-function" title="Permalink to this headline">¶</a></h3>
<p>In a finite-horizon LQR problem,  the cost function is defined as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-90d8fa82-6ce6-4562-8352-b524fd4fb06e">
<span class="eqno">(422)<a class="headerlink" href="#equation-90d8fa82-6ce6-4562-8352-b524fd4fb06e" title="Permalink to this equation">¶</a></span>\[\begin{eqnarray}
J({\bf s},{\bf a}) &amp;=&amp; J_{state}({\bf s}) + \rho J_{control}({\bf a}) \\
 &amp;=&amp; \sum_{t = 0}^{T} (s_{t}-g)^2 + \rho \sum_{t=0}^{T-1}a_{t}^2 \tag{3}
\end{eqnarray}\]</div>
<p>where <span class="math notranslate nohighlight">\(\rho\)</span> is the weight on the control effort cost, as compared to the cost of not being at the goal. Here, <span class="math notranslate nohighlight">\({\bf a} = \{a_t\}_{t=0}^{T-1}\)</span>, <span class="math notranslate nohighlight">\({\bf s} = \{s_t\}_{t=0}^{T}\)</span>. This is a quadratic cost function. In Exercise <span class="math notranslate nohighlight">\(2\)</span>, we will only explore <span class="math notranslate nohighlight">\(g=0\)</span>, in which case <span class="math notranslate nohighlight">\(J_{state}({\bf s})\)</span> can also be expressed as <span class="math notranslate nohighlight">\(\sum_{t = 0}^{T} s_{t}^2\)</span>. In Exercise <span class="math notranslate nohighlight">\(3\)</span>, we will explore a non-zero time-varying goal.</p>
<br/>
<p>The goal of the LQR problem is to find control <span class="math notranslate nohighlight">\({\bf a}\)</span> such that <span class="math notranslate nohighlight">\(J({\bf s},{\bf a})\)</span> is minimized. The goal is then to find the control gain at each time point, i.e.,</p>
<div class="amsmath math notranslate nohighlight" id="equation-7136d2de-ef7e-48c8-b07e-a2b2932f244e">
<span class="eqno">(423)<a class="headerlink" href="#equation-7136d2de-ef7e-48c8-b07e-a2b2932f244e" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\text{argmin} _{\{L_t\}_{t=0}^{T-1}}  J({\bf s},{\bf a}) \tag{4}
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(a_t = L_t s_t\)</span>.</p>
</div>
</div>
<div class="section" id="section-2-2-solving-lqr">
<h2>Section 2.2 Solving LQR<a class="headerlink" href="#section-2-2-solving-lqr" title="Permalink to this headline">¶</a></h2>
<p>The solution to Equation (4), i.e., LQR for a finite time horizon, can be obtained via Dynamic Programming. For details, check out <a class="reference external" href="https://stanford.edu/class/ee363/lectures/dlqr.pdf">this lecture by Stephen Boyd</a>.</p>
<p>For an infinite time horizon, one can obtain a closed-form solution using Riccati equations, and the solution for the control gain becomes time-invariant, i.e., <span class="math notranslate nohighlight">\(L_t \equiv L\)</span>. We will use this in Exercise 4. For  details, check out <a class="reference external" href="https://stanford.edu/class/ee363/lectures/dlqr-ss.pdf">this other lecture by Stephen Boyd</a>.</p>
<br/>
<p>Additional reference for entire section:</p>
<p><a class="reference external" href="http://www.athenasc.com/dpbook.html">Bertsekas, Dimitri P. <em>Dynamic programming and optimal control</em>. Vol. 1. No. 2. Belmont, MA: Athena scientific, 1995</a>.</p>
<div class="section" id="coding-exercise-2-2-implement-the-cost-function">
<h3>Coding Exercise 2.2: Implement the cost function<a class="headerlink" href="#coding-exercise-2-2-implement-the-cost-function" title="Permalink to this headline">¶</a></h3>
<p>The cost function <span class="math notranslate nohighlight">\(J({\bf s}, {\bf a})\)</span> can be divided into two parts: <span class="math notranslate nohighlight">\(J_{state}({\bf s})\)</span> and <span class="math notranslate nohighlight">\(J_{control}({\bf a})\)</span>.</p>
<p>Code up these two parts in the class methods <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">calculate_J_state</span></code> and <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">calculate_J_control</span></code> in the following helper class for LQR.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="k">class</span> <span class="nc">LQR</span><span class="p">(</span><span class="n">LDS</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ini_state</span><span class="p">,</span> <span class="n">noise_var</span><span class="p">,</span> <span class="n">static_noise</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ini_state</span><span class="p">,</span> <span class="n">noise_var</span><span class="p">,</span> <span class="n">static_noise</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>  <span class="c1"># The class LQR only supports g=0</span>

  <span class="k">def</span> <span class="nf">control_gain_LQR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>  <span class="c1"># Dynamic programming variable</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># control gain</span>
    <span class="n">P</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">P_t_1</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">P</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">P_t_1</span> <span class="o">*</span> <span class="n">D</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">D</span> <span class="o">*</span> <span class="n">P_t_1</span> <span class="o">*</span> <span class="n">B</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho</span> <span class="o">+</span> <span class="n">P_t_1</span> <span class="o">*</span> <span class="n">B</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span> <span class="o">*</span> <span class="n">P_t_1</span> <span class="o">*</span> <span class="n">D</span><span class="p">)</span>
        <span class="n">L</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho</span> <span class="o">+</span> <span class="n">P_t_1</span> <span class="o">*</span> <span class="n">B</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span> <span class="o">*</span> <span class="n">P_t_1</span> <span class="o">*</span> <span class="n">D</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">L</span>

  <span class="k">def</span> <span class="nf">calculate_J_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
    <span class="c1">########################################################################</span>
    <span class="c1">## Insert your code here to calculate J_state(s) (see Eq. 3)</span>
    <span class="c1">## complete the function and remove</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Please complete 'calculate_J_state'"</span><span class="p">)</span>
    <span class="c1">########################################################################</span>
    <span class="c1"># calculate the state</span>
    <span class="n">J_state</span> <span class="o">=</span> <span class="o">...</span>

    <span class="k">return</span> <span class="n">J_state</span>

  <span class="k">def</span> <span class="nf">calculate_J_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
    <span class="c1">########################################################################</span>
    <span class="c1">## Insert your code here to calculate J_control(a) (see Eq. 3).</span>
    <span class="c1">## complete the function and remove</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Please complete 'calculate_J_control'"</span><span class="p">)</span>
    <span class="c1">########################################################################</span>
    <span class="c1"># calculate the control</span>
    <span class="n">J_control</span> <span class="o">=</span> <span class="o">...</span>

    <span class="k">return</span> <span class="n">J_control</span>


<span class="c1"># Test class</span>
<span class="n">test_lqr_class</span><span class="p">(</span><span class="n">LQR</span><span class="p">)</span>

</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to_remove solution</span>
<span class="k">class</span> <span class="nc">LQR</span><span class="p">(</span><span class="n">LDS</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ini_state</span><span class="p">,</span> <span class="n">noise_var</span><span class="p">,</span> <span class="n">static_noise</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ini_state</span><span class="p">,</span> <span class="n">noise_var</span><span class="p">,</span> <span class="n">static_noise</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>  <span class="c1"># The class LQR only supports g=0</span>

  <span class="k">def</span> <span class="nf">control_gain_LQR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>  <span class="c1"># Dynamic programming variable</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># control gain</span>
    <span class="n">P</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">P_t_1</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">P</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">P_t_1</span> <span class="o">*</span> <span class="n">D</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">D</span> <span class="o">*</span> <span class="n">P_t_1</span> <span class="o">*</span> <span class="n">B</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho</span> <span class="o">+</span> <span class="n">P_t_1</span> <span class="o">*</span> <span class="n">B</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span> <span class="o">*</span> <span class="n">P_t_1</span> <span class="o">*</span> <span class="n">D</span><span class="p">)</span>
        <span class="n">L</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho</span> <span class="o">+</span> <span class="n">P_t_1</span> <span class="o">*</span> <span class="n">B</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span> <span class="o">*</span> <span class="n">P_t_1</span> <span class="o">*</span> <span class="n">D</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">L</span>

  <span class="k">def</span> <span class="nf">calculate_J_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
    <span class="c1"># calculate the state</span>
    <span class="n">J_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">s</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">J_state</span>

  <span class="k">def</span> <span class="nf">calculate_J_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
    <span class="c1"># calculate the control</span>
    <span class="n">J_control</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">J_control</span>

<span class="c1"># Test class</span>
<span class="n">test_lqr_class</span><span class="p">(</span><span class="n">LQR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="interactive-demo-2-2-lqr-to-the-origin">
<h3>Interactive Demo 2.2: LQR to the origin<a class="headerlink" href="#interactive-demo-2-2-lqr-to-the-origin" title="Permalink to this headline">¶</a></h3>
<p>In this exercise, we will use your new LQR controller to track a static goal at <span class="math notranslate nohighlight">\(g=0\)</span>. Here, we will explore how varying <span class="math notranslate nohighlight">\(\rho\)</span> (the weight on the control effort cost) affects the state trajectory, actions selected, and control gain.</p>
<ol class="simple">
<li><p>Play around with the value of <span class="math notranslate nohighlight">\(\rho\)</span> and see the effects on the sequence of states, the magnitude of the actions, and variability of control gain.</p></li>
<li><p>What do you notice on the control gain when <span class="math notranslate nohighlight">\(\rho\)</span> is too large? and too small?</p></li>
<li><p>For different values of <span class="math notranslate nohighlight">\(\rho\)</span>, how does the magnitude of the actions change?</p></li>
</ol>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@markdown Make sure you execute this cell to enable the widget!</span>
<span class="c1">#@markdown Explore different values of control gain **`L`** (close to optimal, over- and under- ambitious) \\</span>

<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">'''&lt;style&gt;.widget-label { min-width: 15ex !important; }&lt;/style&gt;'''</span><span class="p">))</span>

<span class="nd">@widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">rho</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="mf">25.</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"rho"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">50.</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">simulate_rho</span><span class="p">(</span><span class="n">rho</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
    <span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">ini_state</span><span class="p">,</span> <span class="n">noise_var</span> <span class="o">=</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">.1</span>  <span class="c1"># state parameter</span>
    <span class="n">static_noise</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">lqr</span> <span class="o">=</span> <span class="n">LQR</span><span class="p">(</span><span class="n">ini_state</span><span class="p">,</span> <span class="n">noise_var</span><span class="p">,</span> <span class="n">static_noise</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">lqr</span><span class="o">.</span><span class="n">control_gain_LQR</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>
    <span class="n">s_lqr</span><span class="p">,</span> <span class="n">a_lqr</span> <span class="o">=</span> <span class="n">lqr</span><span class="o">.</span><span class="n">dynamics_closedloop</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">'LQR Control for rho = </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rho</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plot_vs_time</span><span class="p">(</span><span class="n">s_lqr</span><span class="p">,</span><span class="s1">'State evolution'</span><span class="p">,</span><span class="s1">'b'</span><span class="p">,</span><span class="n">goal</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'State $s_t$'</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">plot_vs_time</span><span class="p">(</span><span class="n">a_lqr</span><span class="p">,</span><span class="s1">'LQR Action'</span><span class="p">,</span><span class="s1">'b'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Action $a_t$'</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">plot_vs_time</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="s1">'Control Gain'</span><span class="p">,</span><span class="s1">'b'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Control Gain $L_t$'</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to_remove explanation</span>

<span class="sd">"""</span>
<span class="sd">* A small value for rho results in large values for |a[t]|.</span>
<span class="sd">* A large value for rho leads to small values for |a[t]|.</span>
<span class="sd">* The control gain becomes more time-varying (as opposed to fairly static)</span>
<span class="sd">  for large rho.</span>
<span class="sd">"""</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="section-2-3-the-tradeoff-between-state-cost-and-control-cost">
<h2>Section 2.3: The tradeoff between state cost and control cost<a class="headerlink" href="#section-2-3-the-tradeoff-between-state-cost-and-control-cost" title="Permalink to this headline">¶</a></h2>
<p>In Exercise 2.1, you implemented code to calculate for <span class="math notranslate nohighlight">\(J_{state}\)</span> and <span class="math notranslate nohighlight">\(J_{control}\)</span> in the class methods for the class LQR.</p>
<p>We will now plot them against each other for varying values of <span class="math notranslate nohighlight">\(\rho\)</span> to explore the tradeoff between state cost and control cost.</p>
<p>Execute this cell to visualize the tradeoff between state and control cost</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@markdown Execute this cell to visualize the tradeoff between state and control cost</span>
<span class="k">def</span> <span class="nf">calculate_plot_costs</span><span class="p">():</span>

  <span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">noise_var</span><span class="p">,</span> <span class="n">ini_state</span> <span class="o">=</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">10.</span>
  <span class="n">num_iterations</span> <span class="o">=</span> <span class="mi">50</span>
  <span class="n">num_candidates</span> <span class="o">=</span> <span class="mi">100</span>

  <span class="n">rho_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">num_candidates</span><span class="p">)</span>
  <span class="n">J_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">num_candidates</span><span class="p">,</span> <span class="n">num_iterations</span><span class="p">])</span>
  <span class="n">J_control</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">num_candidates</span><span class="p">,</span> <span class="n">num_iterations</span><span class="p">])</span>

  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_iterations</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rho_array</span><span class="p">)):</span>
      <span class="n">lqr</span> <span class="o">=</span> <span class="n">LQR</span><span class="p">(</span><span class="n">ini_state</span><span class="p">,</span> <span class="n">noise_var</span><span class="p">)</span>
      <span class="n">L</span> <span class="o">=</span> <span class="n">lqr</span><span class="o">.</span><span class="n">control_gain_LQR</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">rho_array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
      <span class="n">s_lqr</span><span class="p">,</span> <span class="n">a_lqr</span> <span class="o">=</span> <span class="n">lqr</span><span class="o">.</span><span class="n">dynamics_closedloop</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
      <span class="n">J_state</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">lqr</span><span class="o">.</span><span class="n">calculate_J_state</span><span class="p">(</span><span class="n">s_lqr</span><span class="p">)</span>
      <span class="n">J_control</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">lqr</span><span class="o">.</span><span class="n">calculate_J_control</span><span class="p">(</span><span class="n">a_lqr</span><span class="p">)</span>

  <span class="n">J_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">J_state</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">J_control</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">J_control</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

  <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">J_state</span><span class="p">,</span> <span class="n">J_control</span><span class="p">,</span> <span class="s1">'.b'</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"$J_</span><span class="si">{state}</span><span class="s2"> = \sum_{t = 0}^</span><span class="si">{T}</span><span class="s2"> (s_</span><span class="si">{t}</span><span class="s2">-g)^2$"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"$J_</span><span class="si">{control}</span><span class="s2"> = \sum_{t=0}^{T-1}a_</span><span class="si">{t}</span><span class="s2">^2$"</span> <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Error vs control effort"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">calculate_plot_costs</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>You should notice the bottom half of a ‘C’ shaped curve, forming the tradeoff between the state cost and the control cost under optimal closed-loop linear control.</p>
<p>For a desired value of the state cost, we cannot reach a lower control cost than the curve in the above plot. Similarly, for a desired value of the control cost, we must accept that amount of state cost. For example, if you know that you have a limited amount of fuel, which determines your maximum control cost to be <span class="math notranslate nohighlight">\(J_{control}^{max}\)</span>.</p>
<p>You will be able to show that you will not be able to track your state with higher accuracy than the corresponding <span class="math notranslate nohighlight">\(J_{state}\)</span> as given by the graph above. This is thus an important curve when designing a system and exploring its control.</p>
</div>
</div>
<hr class="docutils"/>
<div class="section" id="section-3-lqr-for-tracking-a-time-varying-goal">
<h1>Section 3: LQR for tracking a time-varying goal<a class="headerlink" href="#section-3-lqr-for-tracking-a-time-varying-goal" title="Permalink to this headline">¶</a></h1>
<div class="section" id="video-3-tracking-a-moving-goal">
<h2>Video 3: Tracking a moving goal<a class="headerlink" href="#video-3-tracking-a-moving-goal" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_remove-input docutils container">
</div>
<p>In a more realistic situation, the mouse would move around constantly. Suppose you were able to predict the movement of the mouse as it bounces from one place to another. This becomes your goal trajectory <span class="math notranslate nohighlight">\(g_t\)</span>.</p>
<p>When the target state, denoted as <span class="math notranslate nohighlight">\(g_t\)</span>, is not <span class="math notranslate nohighlight">\(0\)</span>, the cost function becomes</p>
<div class="amsmath math notranslate nohighlight" id="equation-cbbf28a3-5612-4125-bc26-47c8460a2c33">
<span class="eqno">(424)<a class="headerlink" href="#equation-cbbf28a3-5612-4125-bc26-47c8460a2c33" title="Permalink to this equation">¶</a></span>\[\begin{equation}
J({\bf a}) = \sum_{t = 0}^{T} (s_{t}- g_t) ^2 + \rho \sum_{t=0}^{T-1}(a_{t}-\bar a_t)^2
\end{equation}\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\bar a_t\)</span> is the desired action based on the goal trajectory. In other words, the controller considers the goal for the next time step, and designs a preliminary control action that gets the state at the next time step to the desired goal. Specifically, without taking into account noise <span class="math notranslate nohighlight">\(w_t\)</span>, we would like to design <span class="math notranslate nohighlight">\(\bar a_t\)</span> such that <span class="math notranslate nohighlight">\(s_{t+1}=g_{t+1}\)</span>. Thus, from Equation <span class="math notranslate nohighlight">\((1)\)</span>,</p>
<div class="amsmath math notranslate nohighlight" id="equation-161d6595-f6e4-485b-95f1-3615b5dd013c">
<span class="eqno">(425)<a class="headerlink" href="#equation-161d6595-f6e4-485b-95f1-3615b5dd013c" title="Permalink to this equation">¶</a></span>\[\begin{eqnarray}
g_{t+1} &amp;=&amp; Ds_t + B \bar a_t\\
\bar a_{t} &amp;=&amp; \frac{- Ds_t + g_{t+1}}{B}
\end{eqnarray}\]</div>
<p>The final control action <span class="math notranslate nohighlight">\(a_t\)</span> is produced by adding this desired action <span class="math notranslate nohighlight">\(\bar a_t\)</span> with the term with the control gain <span class="math notranslate nohighlight">\(L_t(s_t - g_t)\)</span>.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@markdown Execute this cell to include class</span>
<span class="c1">#@markdown for LQR control to desired time-varying goal</span>

<span class="k">class</span> <span class="nc">LQR_tracking</span><span class="p">(</span><span class="n">LQR</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ini_state</span><span class="p">,</span> <span class="n">noise_var</span><span class="p">,</span> <span class="n">goal</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ini_state</span><span class="p">,</span> <span class="n">noise_var</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="o">=</span> <span class="n">goal</span>

  <span class="k">def</span> <span class="nf">dynamics_tracking</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="c1"># states intialization</span>
    <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ini_state</span>

    <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noise_var</span><span class="p">)</span> <span class="o">*</span> <span class="n">standard_normal_noise</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="c1"># control intialization</span>
    <span class="n">a_bar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">a_bar</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="o">-</span> <span class="n">D</span> <span class="o">*</span> <span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">B</span>
        <span class="n">a</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span>  <span class="n">L</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="o">+</span> <span class="n">a_bar</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">s</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span> <span class="o">*</span> <span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">noise</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a_bar</span>

  <span class="k">def</span> <span class="nf">calculate_J_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
    <span class="n">J_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">s</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">J_state</span>

  <span class="k">def</span> <span class="nf">calculate_J_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a_bar</span><span class="p">):</span>
    <span class="n">J_control</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">a</span><span class="o">-</span><span class="n">a_bar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">J_control</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="interactive-demo-3-lqr-control-to-desired-time-varying-goal">
<h3>Interactive Demo 3: LQR control to desired time-varying goal<a class="headerlink" href="#interactive-demo-3-lqr-control-to-desired-time-varying-goal" title="Permalink to this headline">¶</a></h3>
<p>Use the demo below to explore how LQR tracks a time-varying goal. Starting with the sinusoidal goal function <code class="docutils literal notranslate"><span class="pre">sin</span></code>, investigate how the system reacts with different values of <span class="math notranslate nohighlight">\(\rho\)</span> and process noise variance. Next, explore other time-varying goals, such as a step function and ramp.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@markdown Make sure you execute this cell to enable the widget!</span>
<span class="c1">#@markdown Explore different values of control gain **`L`** (close to optimal, over- and under- ambitious) \\</span>

<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">'''&lt;style&gt;.widget-label { min-width: 15ex !important; }&lt;/style&gt;'''</span><span class="p">))</span>

<span class="nd">@widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">rho</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="mf">20.</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"rho"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">40.</span><span class="p">),</span>
                  <span class="n">noise_var</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"noise_var"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.</span><span class="p">),</span>
                  <span class="n">goal_func</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">RadioButtons</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">'sin'</span><span class="p">,</span> <span class="s1">'step'</span><span class="p">,</span> <span class="s1">'ramp'</span><span class="p">],</span>
                                                 <span class="n">description</span><span class="o">=</span><span class="s1">'goal_func:'</span><span class="p">,</span>
                                                 <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">simulate_tracking</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">noise_var</span><span class="p">,</span> <span class="n">goal_func</span><span class="p">):</span>
  <span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">ini_state</span> <span class="o">=</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span>
  <span class="k">if</span> <span class="n">goal_func</span> <span class="o">==</span> <span class="s1">'sin'</span><span class="p">:</span>
      <span class="n">goal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="n">T</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">goal_func</span> <span class="o">==</span> <span class="s1">'step'</span><span class="p">:</span>
      <span class="n">goal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
      <span class="n">goal</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">T</span> <span class="o">/</span> <span class="mi">3</span><span class="p">):]</span> <span class="o">=</span> <span class="mf">1.</span>
  <span class="k">elif</span> <span class="n">goal_func</span> <span class="o">==</span> <span class="s1">'ramp'</span><span class="p">:</span>
      <span class="n">goal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
      <span class="n">goal</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">T</span> <span class="o">/</span> <span class="mi">3</span><span class="p">):]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">T</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">T</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>

  <span class="n">lqr_time</span> <span class="o">=</span> <span class="n">LQR_tracking</span><span class="p">(</span><span class="n">ini_state</span><span class="p">,</span> <span class="n">noise_var</span><span class="p">,</span> <span class="n">goal</span><span class="p">)</span>
  <span class="n">L</span> <span class="o">=</span> <span class="n">lqr_time</span><span class="o">.</span><span class="n">control_gain_LQR</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>
  <span class="n">s_lqr_time</span><span class="p">,</span> <span class="n">a_lqr_time</span><span class="p">,</span> <span class="n">a_bar_lqr_time</span> <span class="o">=</span> <span class="n">lqr_time</span><span class="o">.</span><span class="n">dynamics_tracking</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>

  <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">'LQR Control for time-varying goal'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="n">plot_vs_time</span><span class="p">(</span><span class="n">s_lqr_time</span><span class="p">,</span><span class="s1">'State evolution $s_t$'</span><span class="p">,</span><span class="s1">'b'</span><span class="p">,</span><span class="n">goal</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">"State"</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
  <span class="n">plot_vs_time</span><span class="p">(</span><span class="n">a_lqr_time</span><span class="p">,</span> <span class="s1">'Action $a_t$'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">"Action"</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to_remove explanation</span>

<span class="sd">"""</span>
<span class="sd">In Exercise 3, you should have noticed that:</span>
<span class="sd">* The system follows time varying goals rather well, with little change to the</span>
<span class="sd">   cost function and the control equations.</span>
<span class="sd">* Setting rho=0 leads to noise in the first part of the time series.</span>
<span class="sd">  Here, we see that the control cost in fact acts as a regularizer.</span>
<span class="sd">* Larger values of the process noise variance lead to a higher MSE between the</span>
<span class="sd">  state and the desired goal.</span>
<span class="sd">"""</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<hr class="docutils"/>
<div class="section" id="section-4-control-of-an-partially-observed-state-using-a-linear-quadratic-gaussian-lqg-controller">
<h1>Section 4: Control of an partially observed state using a Linear Quadratic Gaussian (LQG) controller<a class="headerlink" href="#section-4-control-of-an-partially-observed-state-using-a-linear-quadratic-gaussian-lqg-controller" title="Permalink to this headline">¶</a></h1>
<div class="section" id="section-4-1-introducing-the-lqg-controller">
<h2>Section 4.1 Introducing the LQG Controller<a class="headerlink" href="#section-4-1-introducing-the-lqg-controller" title="Permalink to this headline">¶</a></h2>
<div class="section" id="video-4-linear-quadratic-gaussian-lqg-control">
<h3>Video 4: Linear Quadratic Gaussian (LQG) Control<a class="headerlink" href="#video-4-linear-quadratic-gaussian-lqg-control" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_remove-input docutils container">
</div>
<p>In practice, the controller does not have full access to the state. For example, your jet pack in space may be controlled by Mission Control back on earth!  In this case, noisy measurements <span class="math notranslate nohighlight">\(m_t\)</span> of the state <span class="math notranslate nohighlight">\(s_t\)</span> are taken via radar, and the controller needs to (1) estimate the true state, and (2) design an action based on this estimate.</p>
<p>Fortunately, the separation principle tells us that it is optimal to do (1) and (2) separately. This makes our problem much easier, since we already know how to do each step.</p>
<ol class="simple">
<li><p><em>State Estimation</em><br>
Can we recover the state from the measurement?
yesterday you learned that the states <span class="math notranslate nohighlight">\(\hat{s}_t\)</span> can be estimated from the measurements <span class="math notranslate nohighlight">\(m_t\)</span> using the <strong>Kalman filter</strong>.</br></p></li>
<li><p><em>Design Action</em><br>
In Sections 2 and 3 above, we just learned about the LQR controller which designs an action based on the state. The separation principle tells us that it is sufficient to replace the use of the state in LQR with the <em>estimated</em> state, i.e.,</br></p></li>
</ol>
<div class="amsmath math notranslate nohighlight" id="equation-9b7ca163-12eb-4cf2-bc3f-dd5bc13c7c29">
<span class="eqno">(426)<a class="headerlink" href="#equation-9b7ca163-12eb-4cf2-bc3f-dd5bc13c7c29" title="Permalink to this equation">¶</a></span>\[\begin{equation}
a_t = L_t \hat s_t
\end{equation}\]</div>
<p>The state dynamics will then be:</p>
<div class="amsmath math notranslate nohighlight" id="equation-cc3a87be-f0e9-4197-aab0-7fbf1d58dc42">
<span class="eqno">(427)<a class="headerlink" href="#equation-cc3a87be-f0e9-4197-aab0-7fbf1d58dc42" title="Permalink to this equation">¶</a></span>\[\begin{equation}
s_{t+1} = D s_t + B a_t + w_t
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(w_t\)</span> is the process noise (proc_noise), and the observation / measurement is:</p>
<div class="amsmath math notranslate nohighlight" id="equation-6db5b1e4-2471-44ee-bef9-9160831f1cc1">
<span class="eqno">(428)<a class="headerlink" href="#equation-6db5b1e4-2471-44ee-bef9-9160831f1cc1" title="Permalink to this equation">¶</a></span>\[\begin{equation}
m_t = C s_t + v_t
\end{equation}\]</div>
<p>with <span class="math notranslate nohighlight">\(C\)</span> is the observation matrix and <span class="math notranslate nohighlight">\(v_t\)</span> is the measurement noise (meas_noise).</p>
<p>The combination of (1) state estimation and (2) action design using LQR is known as a <strong>linear quadratic gaussian (LQG)</strong>. Yesterday, you completed the code for the Kalman filter. Based on that, you will code up the LQG controller. For these exercises, we will return to using the goal <span class="math notranslate nohighlight">\(g=0\)</span>, as in Section 2.</p>
</div>
<div class="section" id="interactive-demo-4-1-the-kalman-filter-in-conjunction-with-a-linear-closed-loop-controller-lqg-control">
<h3>Interactive Demo 4.1: The Kalman filter in conjunction with a linear closed-loop controller (LQG Control)<a class="headerlink" href="#interactive-demo-4-1-the-kalman-filter-in-conjunction-with-a-linear-closed-loop-controller-lqg-control" title="Permalink to this headline">¶</a></h3>
<p>Inspect the <code class="docutils literal notranslate"><span class="pre">KalmanFilter</span></code> class, its method <code class="docutils literal notranslate"><span class="pre">get_estimate(self,</span> <span class="pre">m)</span></code> will help you refresh your understanding of how the filtering mechanism works. The only difference from yesterday’s implementation is that today’s Kalman filter takes into account the action when computing the estimates.</p>
<p>Also, inspect the <code class="docutils literal notranslate"><span class="pre">LQG</span></code> class. You will find that the only difference between this class and the <code class="docutils literal notranslate"><span class="pre">LQR</span></code> class is that the system now returns a noisy measurement of the state.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">KalmanFilter</span><span class="p">():</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transition_matrix</span><span class="p">,</span> <span class="n">transition_covariance</span><span class="p">,</span>
               <span class="n">observation_matrix</span><span class="p">,</span> <span class="n">observation_covariance</span><span class="p">,</span>
               <span class="n">initial_state_mean</span><span class="p">,</span> <span class="n">initial_state_covariance</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">transition_matrix</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">transition_covariance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">observation_matrix</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">observation_covariance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prior</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">initial_state_mean</span><span class="p">,</span> <span class="n">initial_state_covariance</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">get_estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>

    <span class="n">predicted_estimate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">mean</span> <span class="o">+</span> <span class="n">a</span>
    <span class="n">predicted_covariance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">cov</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span>

    <span class="n">innovation_estimate</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">*</span> <span class="n">predicted_estimate</span>
    <span class="n">innovation_covariance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">predicted_covariance</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span>

    <span class="c1"># Kalman gain is the weight given to the innovation (ie., the difference between the measurement and the predicted measurement)</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">predicted_covariance</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">/</span> <span class="n">innovation_covariance</span>
    <span class="n">updated_mean</span> <span class="o">=</span> <span class="n">predicted_estimate</span> <span class="o">+</span> <span class="n">K</span> <span class="o">*</span> <span class="n">innovation_estimate</span>
    <span class="n">updated_cov</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">K</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">)</span> <span class="o">*</span> <span class="n">predicted_covariance</span>
    <span class="n">posterior</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">updated_mean</span><span class="p">,</span> <span class="n">updated_cov</span><span class="p">)</span>

    <span class="c1"># Current posterior becomes next-step prior</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prior</span> <span class="o">=</span> <span class="n">posterior</span>

    <span class="k">return</span> <span class="n">posterior</span><span class="o">.</span><span class="n">mean</span>


<span class="k">class</span> <span class="nc">LQG</span><span class="p">():</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transition_matrix</span><span class="p">,</span> <span class="n">transition_covariance</span><span class="p">,</span>
               <span class="n">observation_matrix</span><span class="p">,</span> <span class="n">observation_covariance</span><span class="p">,</span> <span class="n">initial_state_mean</span><span class="p">,</span>
               <span class="n">initial_state_covariance</span><span class="p">,</span> <span class="n">ntrials</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">static_noise</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">transition_matrix</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">transition_covariance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">observation_matrix</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">observation_covariance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">static_noise</span> <span class="o">=</span> <span class="n">static_noise</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ntrials</span> <span class="o">=</span> <span class="n">ntrials</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">latent_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">T</span><span class="p">,</span> <span class="n">ntrials</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">latent_states</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_state_mean</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">initial_state_covariance</span><span class="p">)</span> <span class="o">*</span> <span class="n">standard_normal_noise</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_noise</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">latent_states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">latent_states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">action</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="o">*</span> <span class="n">standard_normal_noise</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">measurement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">latent_states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="n">standard_normal_noise_meas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">latent_states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">latent_states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">action</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ntrials</span><span class="p">)</span>
      <span class="n">measurement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">latent_states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ntrials</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">measurement</span>

  <span class="k">def</span> <span class="nf">get_control_gain_infinite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">P</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">P_t_1</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">P</span><span class="p">[</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">P_t_1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">*</span> <span class="n">P_t_1</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho</span> <span class="o">+</span> <span class="n">P_t_1</span><span class="p">)</span> <span class="o">*</span> <span class="n">P_t_1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">)</span>
        <span class="n">L</span><span class="p">[</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho</span> <span class="o">+</span> <span class="n">P_t_1</span><span class="p">)</span><span class="o">*</span> <span class="n">P_t_1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">control_policy_LQG</span><span class="p">(</span><span class="n">control_gain</span><span class="p">,</span> <span class="n">estimated_state</span><span class="p">):</span>
  <span class="n">current_action</span> <span class="o">=</span>  <span class="n">control_gain</span> <span class="o">*</span> <span class="n">estimated_state</span>
  <span class="k">return</span> <span class="n">current_action</span>
</pre></div>
</div>
</div>
</div>
<p>Use interactive demo below and observe the performance of the Kalman filter. Remember, the parameter <code class="docutils literal notranslate"><span class="pre">C</span></code> scales the observation matrix.</p>
<p>What happens when <code class="docutils literal notranslate"><span class="pre">C=0</span></code>?</p>
<p>Make sure you execute this cell to enable the widget!</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @markdown Make sure you execute this cell to enable the widget!</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">'''&lt;style&gt;.widget-label { min-width: 15ex !important; }&lt;/style&gt;'''</span><span class="p">))</span>

<span class="nd">@widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">C</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"C"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">3.</span><span class="p">),</span>
                  <span class="n">proc_noise</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="mf">.1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"proc_noise"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.</span><span class="p">),</span>
                  <span class="n">meas_noise</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="mf">.2</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"meas_noise"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">simulate_kf_no_control</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">proc_noise</span><span class="p">,</span> <span class="n">meas_noise</span><span class="p">):</span>

  <span class="n">D</span> <span class="o">=</span> <span class="mf">0.9</span>
  <span class="n">ini_state_mean</span> <span class="o">=</span> <span class="mf">5.</span>
  <span class="n">ini_state_cov</span> <span class="o">=</span> <span class="mf">.1</span>
  <span class="n">estimates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
  <span class="n">estimates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ini_state_mean</span>

  <span class="nb">filter</span> <span class="o">=</span> <span class="n">KalmanFilter</span><span class="p">(</span><span class="n">transition_matrix</span><span class="o">=</span><span class="n">D</span><span class="p">,</span>
                        <span class="n">transition_covariance</span><span class="o">=</span><span class="n">proc_noise</span><span class="p">,</span>
                        <span class="n">observation_matrix</span><span class="o">=</span><span class="n">C</span><span class="p">,</span>
                        <span class="n">observation_covariance</span><span class="o">=</span><span class="n">meas_noise</span><span class="p">,</span>
                        <span class="n">initial_state_mean</span><span class="o">=</span><span class="n">ini_state_mean</span><span class="p">,</span>
                        <span class="n">initial_state_covariance</span><span class="o">=</span><span class="n">ini_state_cov</span><span class="p">)</span>

  <span class="n">system</span> <span class="o">=</span> <span class="n">LQG</span><span class="p">(</span><span class="n">transition_matrix</span><span class="o">=</span><span class="n">D</span><span class="p">,</span>
               <span class="n">transition_covariance</span><span class="o">=</span><span class="n">proc_noise</span><span class="p">,</span>
               <span class="n">observation_matrix</span><span class="o">=</span><span class="n">C</span><span class="p">,</span>
               <span class="n">observation_covariance</span><span class="o">=</span><span class="n">meas_noise</span><span class="p">,</span>
               <span class="n">initial_state_mean</span><span class="o">=</span><span class="n">ini_state_mean</span><span class="p">,</span>
               <span class="n">initial_state_covariance</span><span class="o">=</span><span class="n">ini_state_cov</span><span class="p">,</span>
               <span class="n">static_noise</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

  <span class="n">action</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="n">measurement</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="n">estimates</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">get_estimate</span><span class="p">(</span><span class="n">measurement</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>

  <span class="n">plot_kf_state_vs_time</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">latent_states</span><span class="p">,</span> <span class="n">estimates</span><span class="p">,</span> <span class="s1">'State estimation with KF (Stable system without control input)'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to_remove explanation</span>
<span class="sd">"""</span>
<span class="sd">You should have seen that the Kalman filter generally estimates the latent state</span>
<span class="sd">accurately, even with fairly high noise levels, except when C=0.</span>
<span class="sd">"""</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="interactive-demo-4-2-lqg-controller-output-with-varying-control-gains">
<h3>Interactive Demo 4.2: LQG controller output with varying control gains<a class="headerlink" href="#interactive-demo-4-2-lqg-controller-output-with-varying-control-gains" title="Permalink to this headline">¶</a></h3>
<p>Now let’s implement the Kalman filter with closed-loop feedback with the controller. We will first use an arbitrary control gain and a fixed value for measurement noise. We will then use the control gain that we calculated for the LQR system given different values for <span class="math notranslate nohighlight">\(\rho\)</span> (weight on the control effort).</p>
<ol class="simple">
<li><p>Visualize the system dynamics <span class="math notranslate nohighlight">\(s_t\)</span> in closed-loop control with an arbitrary constant control gain. Vary this control gain.</p></li>
<li><p>Play arround with the remaining sliders. What happens when the process noise is high (low)? How about the measurement noise?</p></li>
</ol>
<p>Make sure you execute this cell to enable the widget!</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @markdown Make sure you execute this cell to enable the widget!</span>

<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">'''&lt;style&gt;.widget-label { min-width: 15ex !important; }&lt;/style&gt;'''</span><span class="p">))</span>

<span class="nd">@widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">C</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"C"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">3.</span><span class="p">),</span>
                  <span class="n">L</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="o">-</span><span class="mf">.3</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"L"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">.5</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.</span><span class="p">),</span>
                  <span class="n">proc_noise</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="mf">.1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"proc_noise"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.</span><span class="p">),</span>
                  <span class="n">meas_noise</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="mf">.2</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"meas_noise"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">simulate_kf_with_control</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">proc_noise</span><span class="p">,</span> <span class="n">meas_noise</span><span class="p">):</span>

  <span class="n">D</span> <span class="o">=</span> <span class="mf">1.1</span>
  <span class="n">ini_state_mean</span> <span class="o">=</span> <span class="mf">5.</span>
  <span class="n">ini_state_cov</span> <span class="o">=</span> <span class="mf">.1</span>
  <span class="n">estimates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
  <span class="n">estimates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ini_state_mean</span>
  <span class="n">control_gain</span> <span class="o">=</span> <span class="n">L</span>

  <span class="nb">filter</span> <span class="o">=</span> <span class="n">KalmanFilter</span><span class="p">(</span><span class="n">transition_matrix</span><span class="o">=</span><span class="n">D</span><span class="p">,</span>
                        <span class="n">transition_covariance</span><span class="o">=</span><span class="n">proc_noise</span><span class="p">,</span>
                        <span class="n">observation_matrix</span><span class="o">=</span><span class="n">C</span><span class="p">,</span>
                        <span class="n">observation_covariance</span><span class="o">=</span><span class="n">meas_noise</span><span class="p">,</span>
                        <span class="n">initial_state_mean</span><span class="o">=</span><span class="n">ini_state_mean</span><span class="p">,</span>
                        <span class="n">initial_state_covariance</span><span class="o">=</span><span class="n">ini_state_cov</span><span class="p">)</span>

  <span class="n">system</span> <span class="o">=</span> <span class="n">LQG</span><span class="p">(</span><span class="n">transition_matrix</span><span class="o">=</span><span class="n">D</span><span class="p">,</span>
               <span class="n">transition_covariance</span><span class="o">=</span><span class="n">proc_noise</span><span class="p">,</span>
               <span class="n">observation_matrix</span><span class="o">=</span><span class="n">C</span><span class="p">,</span>
               <span class="n">observation_covariance</span><span class="o">=</span><span class="n">meas_noise</span><span class="p">,</span>
               <span class="n">initial_state_mean</span><span class="o">=</span><span class="n">ini_state_mean</span><span class="p">,</span>
               <span class="n">initial_state_covariance</span><span class="o">=</span><span class="n">ini_state_cov</span><span class="p">,</span>
               <span class="n">static_noise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

  <span class="n">action</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="n">measurement</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="n">estimates</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">get_estimate</span><span class="p">(</span><span class="n">measurement</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">control_policy_LQG</span><span class="p">(</span><span class="n">control_gain</span><span class="p">,</span> <span class="n">estimates</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>

  <span class="n">plot_kf_state_vs_time</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">latent_states</span><span class="p">,</span> <span class="n">estimates</span><span class="p">,</span> <span class="sa">f</span><span class="s1">'State estimation with KF (control gain = </span><span class="si">{</span><span class="n">control_gain</span><span class="si">}</span><span class="s1">)'</span><span class="p">,</span> <span class="n">goal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="interactive-demo-4-3-lqg-controller-with-varying-weight-on-the-control-effort-costs">
<h3>Interactive Demo 4.3: LQG controller with varying weight on the control effort costs<a class="headerlink" href="#interactive-demo-4-3-lqg-controller-with-varying-weight-on-the-control-effort-costs" title="Permalink to this headline">¶</a></h3>
<p>Now let’s see the performance of the LQG controller as the parameter <span class="math notranslate nohighlight">\(\rho\)</span> changes. We will use an LQG controller gain, where the control gain is from a system with an infinite horizon; in this case, the optimal control gain turns out to be a constant.</p>
<p>Vary the value of <span class="math notranslate nohighlight">\(\rho\)</span> from <span class="math notranslate nohighlight">\(0\)</span> to large values, to see the effect on the state.</p>
<p>Make sure you execute this cell to enable the widget!</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@markdown Make sure you execute this cell to enable the widget!</span>

<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">'''&lt;style&gt;.widget-label { min-width: 15ex !important; }&lt;/style&gt;'''</span><span class="p">))</span>

<span class="nd">@widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">rho</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="mf">25.</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"rho"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">50.</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">simulate_kf_with_lqg</span><span class="p">(</span><span class="n">rho</span><span class="p">):</span>

    <span class="n">D</span><span class="o">=</span><span class="mf">1.1</span>
    <span class="n">C</span><span class="o">=</span><span class="mf">1.</span>
    <span class="n">ini_state_mean</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">ini_state_cov</span> <span class="o">=</span> <span class="mf">2.</span>
    <span class="n">proc_noise</span><span class="o">=</span><span class="mf">0.1</span>
    <span class="n">meas_noise</span><span class="o">=</span><span class="mf">0.2</span>
    <span class="n">estimates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="n">estimates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ini_state_mean</span>


    <span class="nb">filter</span> <span class="o">=</span> <span class="n">KalmanFilter</span><span class="p">(</span><span class="n">transition_matrix</span><span class="o">=</span><span class="n">D</span><span class="p">,</span>
                        <span class="n">transition_covariance</span><span class="o">=</span><span class="n">proc_noise</span><span class="p">,</span>
                        <span class="n">observation_matrix</span><span class="o">=</span><span class="n">C</span><span class="p">,</span>
                        <span class="n">observation_covariance</span><span class="o">=</span><span class="n">meas_noise</span><span class="p">,</span>
                        <span class="n">initial_state_mean</span><span class="o">=</span><span class="n">ini_state_mean</span><span class="p">,</span>
                        <span class="n">initial_state_covariance</span><span class="o">=</span><span class="n">ini_state_cov</span><span class="p">)</span>

    <span class="n">system</span> <span class="o">=</span> <span class="n">LQG</span><span class="p">(</span><span class="n">transition_matrix</span><span class="o">=</span><span class="n">D</span><span class="p">,</span>
                <span class="n">transition_covariance</span><span class="o">=</span><span class="n">proc_noise</span><span class="p">,</span>
                <span class="n">observation_matrix</span><span class="o">=</span><span class="n">C</span><span class="p">,</span>
                <span class="n">observation_covariance</span><span class="o">=</span><span class="n">meas_noise</span><span class="p">,</span>
                <span class="n">initial_state_mean</span><span class="o">=</span><span class="n">ini_state_mean</span><span class="p">,</span>
                <span class="n">initial_state_covariance</span><span class="o">=</span><span class="n">ini_state_cov</span><span class="p">,</span>
                <span class="n">static_noise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">control_gain</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">get_control_gain_infinite</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>

    <span class="n">action</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
      <span class="n">measurement</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
      <span class="n">estimates</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">get_estimate</span><span class="p">(</span><span class="n">measurement</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
      <span class="n">action</span> <span class="o">=</span> <span class="n">control_policy_LQG</span><span class="p">(</span><span class="n">control_gain</span><span class="p">,</span> <span class="n">estimates</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>

    <span class="n">plot_kf_state_vs_time</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">latent_states</span><span class="p">,</span> <span class="n">estimates</span><span class="p">,</span> <span class="sa">f</span><span class="s1">'State estimation with KF (LQG controller)'</span><span class="p">,</span> <span class="n">goal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="interactive-demo-4-4-how-does-the-process-noise-and-the-measurement-noise-influence-the-controlled-state-and-desired-action">
<h3>Interactive Demo 4.4: How does the process noise and the measurement noise influence the controlled state and desired action?<a class="headerlink" href="#interactive-demo-4-4-how-does-the-process-noise-and-the-measurement-noise-influence-the-controlled-state-and-desired-action" title="Permalink to this headline">¶</a></h3>
<p>Process noise <span class="math notranslate nohighlight">\(w_t\)</span> (proc_noise) and measurement noise <span class="math notranslate nohighlight">\(v_t\)</span> (meas_noise) have very different effects on the controlled state.</p>
<p>To visualize this, play with the sliders to get an intuition for how to process noise and measurement noise influences the controlled state. How are these two sources of noise different?</p>
<p>Make sure you execute this cell to enable the widget!</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@markdown Make sure you execute this cell to enable the widget!</span>

<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">'''&lt;style&gt;.widget-label { min-width: 15ex !important; }&lt;/style&gt;'''</span><span class="p">))</span>

<span class="nd">@widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">proc_noise</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="mf">.1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"proc_noise"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.</span><span class="p">),</span>
                  <span class="n">meas_noise</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="mf">.2</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"meas_noise"</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">lqg_slider</span><span class="p">(</span><span class="n">proc_noise</span><span class="p">,</span> <span class="n">meas_noise</span><span class="p">):</span>

    <span class="n">D</span><span class="o">=</span><span class="mf">1.1</span>
    <span class="n">C</span><span class="o">=</span><span class="mf">1.</span>
    <span class="n">rho</span><span class="o">=</span><span class="mf">1.</span>
    <span class="n">ini_state_mean</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">ini_state_cov</span> <span class="o">=</span> <span class="mf">2.</span>
    <span class="n">estimates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="n">estimates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ini_state_mean</span>

    <span class="nb">filter</span> <span class="o">=</span> <span class="n">KalmanFilter</span><span class="p">(</span><span class="n">transition_matrix</span><span class="o">=</span><span class="n">D</span><span class="p">,</span>
                        <span class="n">transition_covariance</span><span class="o">=</span><span class="n">proc_noise</span><span class="p">,</span>
                        <span class="n">observation_matrix</span><span class="o">=</span><span class="n">C</span><span class="p">,</span>
                        <span class="n">observation_covariance</span><span class="o">=</span><span class="n">meas_noise</span><span class="p">,</span>
                        <span class="n">initial_state_mean</span><span class="o">=</span><span class="n">ini_state_mean</span><span class="p">,</span>
                        <span class="n">initial_state_covariance</span><span class="o">=</span><span class="n">ini_state_cov</span><span class="p">)</span>

    <span class="n">system</span> <span class="o">=</span> <span class="n">LQG</span><span class="p">(</span><span class="n">transition_matrix</span><span class="o">=</span><span class="n">D</span><span class="p">,</span>
                <span class="n">transition_covariance</span><span class="o">=</span><span class="n">proc_noise</span><span class="p">,</span>
                <span class="n">observation_matrix</span><span class="o">=</span><span class="n">C</span><span class="p">,</span>
                <span class="n">observation_covariance</span><span class="o">=</span><span class="n">meas_noise</span><span class="p">,</span>
                <span class="n">initial_state_mean</span><span class="o">=</span><span class="n">ini_state_mean</span><span class="p">,</span>
                <span class="n">initial_state_covariance</span><span class="o">=</span><span class="n">ini_state_cov</span><span class="p">,</span>
                <span class="n">static_noise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">control_gain</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">get_control_gain_infinite</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>

    <span class="n">action</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
      <span class="n">measurement</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
      <span class="n">estimates</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">get_estimate</span><span class="p">(</span><span class="n">measurement</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
      <span class="n">action</span> <span class="o">=</span> <span class="n">control_policy_LQG</span><span class="p">(</span><span class="n">control_gain</span><span class="p">,</span> <span class="n">estimates</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>

    <span class="n">plot_kf_state_vs_time</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">latent_states</span><span class="p">,</span> <span class="n">estimates</span><span class="p">,</span> <span class="sa">f</span><span class="s1">'State estimation with KF (LQG controller)'</span><span class="p">,</span> <span class="n">goal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to_remove explanation</span>

<span class="sd">"""</span>
<span class="sd">As you increase the process noise, you will notice that it becomes more</span>
<span class="sd">difficult to keep the state close to the goal g=0, even though we may have very</span>
<span class="sd">little measurement noise (thus can estimate the state exactly).</span>
<span class="sd">On the other hand, as you increase the measurement noise, you will notice that</span>
<span class="sd">it is harder to estimate the states, and this also may make it harder to keep the</span>
<span class="sd">state close to the goal.</span>
<span class="sd">Which has a larger effect? How does this affect the required action a[t]?</span>
<span class="sd">We will quantify these in the next section.</span>
<span class="sd">"""</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="section-4-2-noise-effects-on-the-lqg">
<h2>Section 4.2 Noise effects on the LQG<a class="headerlink" href="#section-4-2-noise-effects-on-the-lqg" title="Permalink to this headline">¶</a></h2>
<p>Finally, we will quantify how the state cost and control costs change when we change the process and measurement noise levels. To do so, we will run many simulations, stepping through levels of process and measurement noise, tracking MSE and cost of control for each.</p>
<p>Observe the effects of increasing the process and measurement noises in an unstable system. How do you interpret the results?</p>
<p>Execute this cell to to quantify the dependence of state and control (Running many simulations takes time, you need to wait ~2 seconds before observing the consequences of changing the parameter D)</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@markdown Execute this cell to to quantify the dependence of state and control (Running many simulations takes time, you need to wait ~2 seconds before observing the consequences of changing the parameter D)</span>

<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">'''&lt;style&gt;.widget-label { min-width: 15ex !important; }&lt;/style&gt;'''</span><span class="p">))</span>

<span class="n">D</span><span class="o">=</span><span class="mf">1.1</span>                           <span class="c1"># transition matrix</span>
<span class="n">C</span> <span class="o">=</span> <span class="mi">1</span>                           <span class="c1"># observation matrix</span>
<span class="n">ini_state</span> <span class="o">=</span> <span class="mi">5</span>                   <span class="c1"># initial state mean</span>
<span class="n">ini_state_cov</span> <span class="o">=</span> <span class="mi">1</span>               <span class="c1"># initial state covariance</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">1</span>                         <span class="c1"># control effort parameter</span>
<span class="n">n_iter</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">n_ops</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">process_noise_var</span> <span class="o">=</span> <span class="mf">.1</span>
<span class="n">measurement_noise_var</span> <span class="o">=</span> <span class="mf">.2</span>

<span class="c1"># Implement LQG control over n_iter iterations, and record the MSE between state and goal</span>
<span class="n">MSE_array_N_meas</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">MSE_array_N_proc</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Jcontrol_array_N_meas</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Jcontrol_array_N_proc</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">meas_noise_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">n_ops</span><span class="p">)</span>
<span class="n">proc_noise_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">n_ops</span><span class="p">)</span>

<span class="c1"># Try several proc noises, but same measurement var</span>
<span class="n">MSE_array_proc</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Jcontrol_array_proc</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">proc_noise</span> <span class="ow">in</span> <span class="n">proc_noise_array</span><span class="p">:</span>
  <span class="n">transition_covariance</span> <span class="o">=</span> <span class="n">proc_noise</span>
  <span class="n">observation_covariance</span> <span class="o">=</span> <span class="n">measurement_noise_var</span>

  <span class="c1"># Controller</span>
  <span class="n">lqg</span> <span class="o">=</span> <span class="n">LQG</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">transition_covariance</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">observation_covariance</span><span class="p">,</span> <span class="n">ini_state</span><span class="p">,</span> <span class="n">ini_state_cov</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">)</span>
  <span class="n">control_gain_lqg</span> <span class="o">=</span> <span class="n">lqg</span><span class="o">.</span><span class="n">get_control_gain_infinite</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>

  <span class="c1"># Filtering</span>
  <span class="nb">filter</span> <span class="o">=</span> <span class="n">KalmanFilter</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">transition_covariance</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">observation_covariance</span><span class="p">,</span> <span class="n">ini_state</span><span class="p">,</span> <span class="n">ini_state_cov</span><span class="p">)</span>

  <span class="n">filtered_state_means_impl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">T</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">])</span>
  <span class="n">filtered_state_covariances_impl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">T</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">])</span>
  <span class="n">measurement</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">T</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">])</span>
  <span class="n">action_cost</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">T</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">])</span>

  <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_iter</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="n">measurement</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">lqg</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

    <span class="nb">filter</span><span class="o">.</span><span class="n">get_estimate</span><span class="p">(</span><span class="n">measurement</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">action</span><span class="p">)</span>

    <span class="n">filtered_state_means_impl</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">mean</span>
    <span class="n">filtered_state_covariances_impl</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">cov</span>

    <span class="n">action</span> <span class="o">=</span> <span class="n">control_gain_lqg</span> <span class="o">*</span> <span class="nb">filter</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">mean</span>
    <span class="n">action_cost</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">action</span><span class="o">**</span><span class="mi">2</span>

  <span class="n">state_cost</span> <span class="o">=</span> <span class="n">lqg</span><span class="o">.</span><span class="n">latent_states</span><span class="o">**</span><span class="mi">2</span>

  <span class="n">MSE_array_proc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">state_cost</span><span class="p">))</span>
  <span class="n">Jcontrol_array_proc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">action_cost</span><span class="p">))</span>

<span class="n">MSE_array_proc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MSE_array_proc</span><span class="p">)</span>
<span class="n">Jcontrol_array_proc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Jcontrol_array_proc</span><span class="p">)</span>

<span class="c1"># Try several measurement noises, but same proc var</span>
<span class="n">MSE_array_meas</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Jcontrol_array_meas</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">meas_noise</span> <span class="ow">in</span> <span class="n">meas_noise_array</span><span class="p">:</span>
  <span class="n">transition_covariance</span> <span class="o">=</span> <span class="n">process_noise_var</span>
  <span class="n">observation_covariance</span> <span class="o">=</span> <span class="n">meas_noise</span>

  <span class="c1"># Controller</span>
  <span class="n">lqg</span> <span class="o">=</span> <span class="n">LQG</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">transition_covariance</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">observation_covariance</span><span class="p">,</span> <span class="n">ini_state</span><span class="p">,</span> <span class="n">ini_state_cov</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">)</span>
  <span class="n">control_gain_lqg</span> <span class="o">=</span> <span class="n">lqg</span><span class="o">.</span><span class="n">get_control_gain_infinite</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>

  <span class="c1"># Filtering</span>
  <span class="nb">filter</span> <span class="o">=</span> <span class="n">KalmanFilter</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">transition_covariance</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">observation_covariance</span><span class="p">,</span> <span class="n">ini_state</span><span class="p">,</span> <span class="n">ini_state_cov</span><span class="p">)</span>

  <span class="n">filtered_state_means_impl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">T</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">])</span>
  <span class="n">filtered_state_covariances_impl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">T</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">])</span>
  <span class="n">measurement</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">T</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">])</span>
  <span class="n">action_cost</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">T</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">])</span>

  <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_iter</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="n">measurement</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">lqg</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

    <span class="nb">filter</span><span class="o">.</span><span class="n">get_estimate</span><span class="p">(</span><span class="n">measurement</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">action</span><span class="p">)</span>
    <span class="n">filtered_state_means_impl</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">mean</span>
    <span class="n">filtered_state_covariances_impl</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">cov</span>

    <span class="n">action</span> <span class="o">=</span> <span class="n">control_gain_lqg</span> <span class="o">*</span> <span class="nb">filter</span><span class="o">.</span><span class="n">prior</span><span class="o">.</span><span class="n">mean</span>
    <span class="n">action_cost</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">action</span><span class="o">**</span><span class="mi">2</span>

  <span class="n">state_cost</span> <span class="o">=</span> <span class="n">lqg</span><span class="o">.</span><span class="n">latent_states</span><span class="o">**</span><span class="mi">2</span>

  <span class="n">MSE_array_meas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">state_cost</span><span class="p">))</span>
  <span class="n">Jcontrol_array_meas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">action_cost</span><span class="p">))</span>

<span class="n">MSE_array_meas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MSE_array_meas</span><span class="p">)</span>
<span class="n">Jcontrol_array_meas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Jcontrol_array_meas</span><span class="p">)</span>

<span class="c1"># Compute statistics</span>
<span class="n">MSE_array_proc_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MSE_array_proc</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">MSE_array_proc_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MSE_array_proc</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">MSE_array_meas_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MSE_array_meas</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">MSE_array_meas_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MSE_array_meas</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">Jcontrol_array_proc_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Jcontrol_array_proc</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">Jcontrol_array_proc_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Jcontrol_array_proc</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">Jcontrol_array_meas_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Jcontrol_array_meas</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">Jcontrol_array_meas_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Jcontrol_array_meas</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Visualize the quantification</span>
<span class="n">f</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">proc_noise_array</span><span class="p">,</span> <span class="n">MSE_array_proc_mean</span><span class="p">,</span> <span class="s1">'r-'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">proc_noise_array</span><span class="p">,</span> <span class="n">MSE_array_proc_mean</span><span class="o">+</span><span class="n">MSE_array_proc_std</span><span class="p">,</span> <span class="n">MSE_array_proc_mean</span><span class="o">-</span><span class="n">MSE_array_proc_std</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'tab:gray'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Effect of process noise'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'State Cost (MSE between state and goal)'</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">meas_noise_array</span><span class="p">,</span> <span class="n">MSE_array_meas_mean</span><span class="p">,</span> <span class="s1">'r-'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">meas_noise_array</span><span class="p">,</span> <span class="n">MSE_array_meas_mean</span><span class="o">+</span><span class="n">MSE_array_meas_std</span><span class="p">,</span> <span class="n">MSE_array_meas_mean</span><span class="o">-</span><span class="n">MSE_array_meas_std</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'tab:gray'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Effect of measurement noise'</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">proc_noise_array</span><span class="p">,</span> <span class="n">Jcontrol_array_proc_mean</span><span class="p">,</span> <span class="s1">'r-'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">proc_noise_array</span><span class="p">,</span> <span class="n">Jcontrol_array_proc_mean</span><span class="o">+</span><span class="n">Jcontrol_array_proc_std</span><span class="p">,</span> <span class="n">Jcontrol_array_proc_mean</span><span class="o">-</span><span class="n">Jcontrol_array_proc_std</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'tab:gray'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Process Noise'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Cost of Control'</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">meas_noise_array</span><span class="p">,</span> <span class="n">Jcontrol_array_meas_mean</span><span class="p">,</span> <span class="s1">'r-'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">meas_noise_array</span><span class="p">,</span> <span class="n">Jcontrol_array_meas_mean</span><span class="o">+</span><span class="n">Jcontrol_array_meas_std</span><span class="p">,</span> <span class="n">Jcontrol_array_meas_mean</span><span class="o">-</span><span class="n">Jcontrol_array_meas_std</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'tab:gray'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Measurement Noise'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to_remove explanation</span>


<span class="sd">"""</span>
<span class="sd">While both sources of noise have an effect on the controlled state, the</span>
<span class="sd">process noise has a much larger effect. As the process noise w[t] increases,</span>
<span class="sd">state cost (MSE between state and goal) and  control cost increase drastically.</span>
<span class="sd">You can get an intuition as to why using the sliders in the demo above.  To make</span>
<span class="sd">matters worse, as the process noise gets larger, you will also need to put in</span>
<span class="sd">more effort to keep the system close to the goal.</span>

<span class="sd">The measurement noise v[t]  also has an effect on the accuracy of the</span>
<span class="sd">controlled state. As this noise increases, the MSE between the state and goal</span>
<span class="sd">increases. The cost of control in this case remains fairly constant with</span>
<span class="sd">increasing levels of measurement noise.</span>
<span class="sd">"""</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<hr class="docutils"/>
<div class="section" id="summary">
<h1>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, you have extended the idea of optimal policy to the Astrocat example. You have learned about how to design an optimal controller with a full observation of the state (linear quadratic regulator - LQR) and under partial observability of the state (linear quadratic gaussian - LQG).</p>
</div>
<script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./tutorials/W3D3_OptimalControl/instructor"
        },
        predefinedOutput: true
    }
    </script>
<script>kernelName = 'python3'</script>
</div>
</main>
<footer class="footer-article noprint">
<!-- Previous / next buttons -->
<div class="prev-next-area">
<a class="left-prev" href="W3D3_Tutorial1.html" id="prev-link" title="previous page">
<i class="fas fa-angle-left"></i>
<div class="prev-next-info">
<p class="prev-next-subtitle">previous</p>
<p class="prev-next-title">Tutorial 1: Optimal Control for Discrete States</p>
</div>
</a>
<a class="right-next" href="W3D3_Outro.html" id="next-link" title="next page">
<div class="prev-next-info">
<p class="prev-next-subtitle">next</p>
<p class="prev-next-title">Outro</p>
</div>
<i class="fas fa-angle-right"></i>
</a>
</div>
</footer>
</div>
</div>
<div class="footer-content row">
<footer class="col footer"><p>
  
    By Neuromatch<br>
<div class="extra_footer">
<div>
<a href="http://creativecommons.org/licenses/by/4.0/"><img src="https://i.creativecommons.org/l/by/4.0/88x31.png"/></a>
<a href="https://opensource.org/licenses/BSD-3-Clause"><img src="https://camo.githubusercontent.com/9b9ea65d95c9ef878afa1987df65731d47681336/68747470733a2f2f696d672e736869656c64732e696f2f707970692f6c2f736561626f726e2e737667"/></a>
The contents of this repository are shared under the <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
Software elements are additionally licensed under the <a href="https://opensource.org/licenses/BSD-3-Clause">BSD (3-Clause) License</a>.
</div>
</div>
</br></p>
</footer>
</div>
</div>
</div>
</div>
<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
</body>
</html>
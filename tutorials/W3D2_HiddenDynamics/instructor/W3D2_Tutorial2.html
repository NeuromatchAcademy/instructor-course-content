
<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Tutorial 2: Hidden Markov Model — Neuromatch Academy: Computational Neuroscience (instructor's version)</title>
<!-- Loaded before other Sphinx assets -->
<link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
<link as="font" crossorigin="" href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link href="../../../_static/pygments.css" rel="stylesheet" type="text/css">
<link href="../../../_static/styles/sphinx-book-theme.css" rel="stylesheet" type="text/css">
<link href="../../../_static/togglebutton.css" rel="stylesheet" type="text/css">
<link href="../../../_static/copybutton.css" rel="stylesheet" type="text/css">
<link href="../../../_static/mystnb.css" rel="stylesheet" type="text/css">
<link href="../../../_static/sphinx-thebe.css" rel="stylesheet" type="text/css"/>
<link href="../../../_static/custom.css" rel="stylesheet" type="text/css"/>
<link href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" rel="stylesheet" type="text/css"/>
<link href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" rel="stylesheet" type="text/css"/>
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf" rel="preload"/>
<script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
<script src="../../../_static/jquery.js"></script>
<script src="../../../_static/underscore.js"></script>
<script src="../../../_static/doctools.js"></script>
<script src="../../../_static/togglebutton.js"></script>
<script src="../../../_static/clipboard.min.js"></script>
<script src="../../../_static/copybutton.js"></script>
<script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
<script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
<script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
<script async="async" src="../../../_static/sphinx-thebe.js"></script>
<script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
<link href="../../../_static/nma-logo-square-4xp.png" rel="shortcut icon">
<link href="../../../genindex.html" rel="index" title="Index"/>
<link href="../../../search.html" rel="search" title="Search"/>
<link href="W3D2_Tutorial3.html" rel="next" title="Tutorial 3: The Kalman Filter"/>
<link href="W3D2_Tutorial1.html" rel="prev" title="Tutorial 1: Sequential Probability Ratio Test"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="None" name="docsearch:language"/>
<!-- Google Analytics -->
</link></link></link></link></link></link></head>
<body data-offset="60" data-spy="scroll" data-target="#bd-toc-nav">
<!-- Checkboxes to toggle the left sidebar -->
<input aria-label="Toggle navigation sidebar" class="sidebar-toggle" id="__navigation" name="__navigation" type="checkbox"/>
<label class="overlay overlay-navbar" for="__navigation">
<div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input aria-label="Toggle in-page Table of Contents" class="sidebar-toggle" id="__page-toc" name="__page-toc" type="checkbox"/>
<label class="overlay overlay-pagetoc" for="__page-toc">
<div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>
<div class="container-fluid" id="banner"></div>
<div class="container-xl">
<div class="row">
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
<div class="bd-sidebar__content">
<div class="bd-sidebar__top"><div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../../index.html">
<!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
<img alt="logo" class="logo" src="../../../_static/nma-logo-square-4xp.png"/>
<h1 class="site-logo" id="site-title">Neuromatch Academy: Computational Neuroscience (instructor's version)</h1>
</a>
</div><form action="../../../search.html" class="bd-search d-flex align-items-center" method="get">
<i class="icon fas fa-search"></i>
<input aria-label="Search this book..." autocomplete="off" class="form-control" id="search-input" name="q" placeholder="Search this book..." type="search"/>
</form><nav aria-label="Main" class="bd-links" id="bd-docs-nav">
<div class="bd-toc-item active">
<ul class="nav bd-sidenav bd-sidenav__home-link">
<li class="toctree-l1">
<a class="reference internal" href="../../intro.html">
                    Introduction
                </a>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../Schedule/schedule_intro.html">
   Schedule
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox">
<label for="toctree-checkbox-1">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../Schedule/daily_schedules.html">
     General schedule
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../Schedule/shared_calendars.html">
     Shared calendars
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../Schedule/timezone_widget.html">
     Timezone widget
    </a>
</li>
</ul>
</input></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../TechnicalHelp/tech_intro.html">
   Technical Help
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox">
<label for="toctree-checkbox-2">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../TechnicalHelp/Jupyterbook.html">
     Using jupyterbook
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox">
<label for="toctree-checkbox-3">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../TechnicalHelp/Tutorial_colab.html">
       Using Google Colab
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../TechnicalHelp/Tutorial_kaggle.html">
       Using Kaggle
      </a>
</li>
</ul>
</input></li>
<li class="toctree-l2">
<a class="reference internal" href="../../TechnicalHelp/Discord.html">
     Using discord
    </a>
</li>
</ul>
</input></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="../../TechnicalHelp/Links_Policy.html">
   Quick links and policies
  </a>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="../../../prereqs/ComputationalNeuroscience.html">
   Prerequisites and preparatory materials for NMA Computational Neuroscience
  </a>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="../../../tatraining/TA_Training_CN.html">
   TA Training - Computational Neuroscience
  </a>
</li>
</ul>
<p class="caption">
<span class="caption-text">
  Pre-reqs Refresher
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/chapter_title.html">
   Neuro Video Series (W0D0)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
<label for="toctree-checkbox-4">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial1.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial2.html">
     Human Psychophysics
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial3.html">
     Behavioral Readout
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial4.html">
     Live in Lab
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial5.html">
     Brain Signals: Spiking Activity
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial6.html">
     Brain Signals: LFP
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial7.html">
     Brain Signals: EEG &amp; MEG
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial8.html">
     Brain Signals: fMRI
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial9.html">
     Brain Signals: Calcium Imaging
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial10.html">
     Stimulus Representation
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial11.html">
     Neurotransmitters
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D0_NeuroVideoSeries/instructor/W0D0_Tutorial12.html">
     Neurons to Consciousness
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W0D1_PythonWorkshop1/chapter_title.html">
   Python Workshop 1 (W0D1)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
<label for="toctree-checkbox-5">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D1_PythonWorkshop1/instructor/W0D1_Tutorial1.html">
     Tutorial: LIF Neuron Part I
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W0D2_PythonWorkshop2/chapter_title.html">
   Python Workshop 2 (W0D2)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
<label for="toctree-checkbox-6">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D2_PythonWorkshop2/instructor/W0D2_Tutorial1.html">
     Tutorial 1: LIF Neuron Part II
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W0D3_LinearAlgebra/chapter_title.html">
   Linear Algebra (W0D3)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
<label for="toctree-checkbox-7">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D3_LinearAlgebra/instructor/W0D3_Tutorial1.html">
     Tutorial 1: Vectors
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D3_LinearAlgebra/instructor/W0D3_Tutorial2.html">
     Tutorial 2: Matrices
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D3_LinearAlgebra/instructor/W0D3_Tutorial3.html">
     Bonus Tutorial: Discrete Dynamical Systems
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D3_LinearAlgebra/instructor/W0D3_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D3_LinearAlgebra/instructor/W0D3_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W0D4_Calculus/chapter_title.html">
   Calculus (W0D4)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
<label for="toctree-checkbox-8">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D4_Calculus/instructor/W0D4_Tutorial1.html">
     Tutorial 1: Differentiation and Integration
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D4_Calculus/instructor/W0D4_Tutorial2.html">
     Tutorial 2: Differential Equations
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D4_Calculus/instructor/W0D4_Tutorial3.html">
     Tutorial 3: Numerical Methods
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D4_Calculus/instructor/W0D4_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W0D5_Statistics/chapter_title.html">
   Statistics (W0D5)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
<label for="toctree-checkbox-9">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D5_Statistics/instructor/W0D5_Tutorial1.html">
     Tutorial 1: Probability Distributions
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D5_Statistics/instructor/W0D5_Tutorial2.html">
     Tutorial 2: Statistical Inference
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D5_Statistics/instructor/W0D5_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W0D5_Statistics/instructor/W0D5_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
</ul>
<p class="caption">
<span class="caption-text">
  Intro to Modeling
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W1D1_ModelTypes/chapter_title.html">
   Model Types (W1D1)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
<label for="toctree-checkbox-10">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D1_ModelTypes/instructor/W1D1_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D1_ModelTypes/instructor/W1D1_Tutorial1.html">
     Tutorial 1: “What” models
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D1_ModelTypes/instructor/W1D1_Tutorial2.html">
     Tutorial 2: “How” models
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D1_ModelTypes/instructor/W1D1_Tutorial3.html">
     Tutorial 3: “Why” models
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D1_ModelTypes/instructor/W1D1_Tutorial4.html">
     Tutorial 4: Model Discussions
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D1_ModelTypes/instructor/W1D1_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D1_ModelTypes/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D1_ModelTypes/instructor/W1D1_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W2D1_ModelingPractice/chapter_title.html">
   Modeling Practice (W2D1)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
<label for="toctree-checkbox-11">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D1_ModelingPractice/instructor/W2D1_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D1_ModelingPractice/instructor/W2D1_Tutorial1.html">
     Tutorial 1: Framing the Question
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D1_ModelingPractice/instructor/W2D1_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D1_ModelingPractice/instructor/W2D1_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
</ul>
<p class="caption">
<span class="caption-text">
  Machine Learning
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W1D2_ModelFitting/chapter_title.html">
   Model Fitting (W1D2)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
<label for="toctree-checkbox-12">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/instructor/W1D2_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/instructor/W1D2_Tutorial1.html">
     Tutorial 1: Linear regression with MSE
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/instructor/W1D2_Tutorial2.html">
     Tutorial 2: Linear regression with MLE
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/instructor/W1D2_Tutorial3.html">
     Tutorial 3: Confidence intervals and bootstrapping
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/instructor/W1D2_Tutorial4.html">
     Tutorial 4: Multiple linear regression and polynomial regression
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/instructor/W1D2_Tutorial5.html">
     Tutorial 5: Model Selection: Bias-variance trade-off
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/instructor/W1D2_Tutorial6.html">
     Tutorial 6: Model Selection: Cross-validation
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/instructor/W1D2_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D2_ModelFitting/instructor/W1D2_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W1D3_GeneralizedLinearModels/chapter_title.html">
   Generalized Linear Models (W1D3)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
<label for="toctree-checkbox-13">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D3_GeneralizedLinearModels/instructor/W1D3_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D3_GeneralizedLinearModels/instructor/W1D3_Tutorial1.html">
     Tutorial 1: GLMs for Encoding
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D3_GeneralizedLinearModels/instructor/W1D3_Tutorial2.html">
     Tutorial 2: Classifiers and regularizers
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D3_GeneralizedLinearModels/instructor/W1D3_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D3_GeneralizedLinearModels/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D3_GeneralizedLinearModels/instructor/W1D3_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W1D4_DimensionalityReduction/chapter_title.html">
   Dimensionality Reduction (W1D4)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
<label for="toctree-checkbox-14">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D4_DimensionalityReduction/instructor/W1D4_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D4_DimensionalityReduction/instructor/W1D4_Tutorial1.html">
     Tutorial 1: Geometric view of data
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D4_DimensionalityReduction/instructor/W1D4_Tutorial2.html">
     Tutorial 2: Principal Component Analysis
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D4_DimensionalityReduction/instructor/W1D4_Tutorial3.html">
     Tutorial 3: Dimensionality Reduction &amp; Reconstruction
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D4_DimensionalityReduction/instructor/W1D4_Tutorial4.html">
     Tutorial 4:  Nonlinear Dimensionality Reduction
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D4_DimensionalityReduction/instructor/W1D4_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D4_DimensionalityReduction/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D4_DimensionalityReduction/instructor/W1D4_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W1D5_DeepLearning/chapter_title.html">
   Deep Learning (W1D5)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
<label for="toctree-checkbox-15">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D5_DeepLearning/instructor/W1D5_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D5_DeepLearning/instructor/W1D5_Tutorial1.html">
     Tutorial 1: Decoding Neural Responses
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D5_DeepLearning/instructor/W1D5_Tutorial2.html">
     Tutorial 2: Convolutional Neural Networks
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D5_DeepLearning/instructor/W1D5_Tutorial3.html">
     Tutorial 3: Building and Evaluating Normative Encoding Models
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D5_DeepLearning/instructor/W1D5_Tutorial4.html">
     Bonus Tutorial: Diving Deeper into Decoding &amp; Encoding
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D5_DeepLearning/instructor/W1D5_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D5_DeepLearning/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W1D5_DeepLearning/instructor/W1D5_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../Bonus_Autoencoders/chapter_title.html">
   Autoencoders (Bonus)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
<label for="toctree-checkbox-16">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../Bonus_Autoencoders/instructor/Bonus_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../Bonus_Autoencoders/instructor/Bonus_Tutorial1.html">
     Tutorial 1: Intro to Autoencoders
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../Bonus_Autoencoders/instructor/Bonus_Tutorial2.html">
     Tutorial 2: Autoencoder extensions
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../Bonus_Autoencoders/instructor/Bonus_Tutorial3.html">
     Tutorial 3: Autoencoders applications
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../Bonus_Autoencoders/instructor/Bonus_Outro.html">
     Outro
    </a>
</li>
</ul>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../../Module_WrapUps/MachineLearning.html">
   Machine Learning Wrap-Up
  </a>
</li>
</ul>
<p class="caption">
<span class="caption-text">
  Dynamical Systems
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W2D2_LinearSystems/chapter_title.html">
   Linear Systems (W2D2)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
<label for="toctree-checkbox-17">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D2_LinearSystems/instructor/W2D2_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D2_LinearSystems/instructor/W2D2_Tutorial1.html">
     Tutorial 1: Linear dynamical systems
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D2_LinearSystems/instructor/W2D2_Tutorial2.html">
     Tutorial 2: Markov Processes
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D2_LinearSystems/instructor/W2D2_Tutorial3.html">
     Tutorial 3: Combining determinism and stochasticity
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D2_LinearSystems/instructor/W2D2_Tutorial4.html">
     Tutorial 4: Autoregressive models
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D2_LinearSystems/instructor/W2D2_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D2_LinearSystems/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D2_LinearSystems/instructor/W2D2_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W2D3_BiologicalNeuronModels/chapter_title.html">
   Biological Neuron Models (W2D3)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
<label for="toctree-checkbox-18">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D3_BiologicalNeuronModels/instructor/W2D3_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D3_BiologicalNeuronModels/instructor/W2D3_Tutorial1.html">
     Tutorial 1: The Leaky Integrate-and-Fire (LIF) Neuron Model
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D3_BiologicalNeuronModels/instructor/W2D3_Tutorial2.html">
     Tutorial 2: Effects of Input Correlation
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D3_BiologicalNeuronModels/instructor/W2D3_Tutorial3.html">
     Tutorial 3: Synaptic transmission - Models of static and dynamic synapses
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D3_BiologicalNeuronModels/instructor/W2D3_Tutorial4.html">
     Bonus Tutorial: Spike-timing dependent plasticity (STDP)
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D3_BiologicalNeuronModels/instructor/W2D3_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D3_BiologicalNeuronModels/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D3_BiologicalNeuronModels/instructor/W2D3_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W2D4_DynamicNetworks/chapter_title.html">
   Dynamic Networks (W2D4)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
<label for="toctree-checkbox-19">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D4_DynamicNetworks/instructor/W2D4_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D4_DynamicNetworks/instructor/W2D4_Tutorial1.html">
     Tutorial 1: Neural Rate Models
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D4_DynamicNetworks/instructor/W2D4_Tutorial2.html">
     Tutorial 2: Wilson-Cowan Model
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D4_DynamicNetworks/instructor/W2D4_Tutorial3.html">
     Bonus Tutorial: Extending the Wilson-Cowan Model
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D4_DynamicNetworks/instructor/W2D4_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D4_DynamicNetworks/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W2D4_DynamicNetworks/instructor/W2D4_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../../Module_WrapUps/DynamicalSystems.html">
   Dynamical Systems Wrap-Up
  </a>
</li>
</ul>
<p class="caption">
<span class="caption-text">
  Stochastic Processes
 </span>
</p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W3D1_BayesianDecisions/chapter_title.html">
   Bayesian Decisions (W3D1)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
<label for="toctree-checkbox-20">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D1_BayesianDecisions/instructor/W3D1_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D1_BayesianDecisions/instructor/W3D1_Tutorial1.html">
     Tutorial 1: Bayes with a binary hidden state
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D1_BayesianDecisions/instructor/W3D1_Tutorial2.html">
     Tutorial 2: Bayesian inference and decisions with continuous hidden state
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D1_BayesianDecisions/instructor/W3D1_Tutorial3.html">
     Bonus Tutorial : Fitting to data
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D1_BayesianDecisions/instructor/W3D1_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D1_BayesianDecisions/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D1_BayesianDecisions/instructor/W3D1_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 current active has-children">
<a class="reference internal" href="../chapter_title.html">
   Hidden Dynamics (W3D2)
  </a>
<input checked="" class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
<label for="toctree-checkbox-21">
<i class="fas fa-chevron-down">
</i>
</label>
<ul class="current">
<li class="toctree-l2">
<a class="reference internal" href="W3D2_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="W3D2_Tutorial1.html">
     Tutorial 1: Sequential Probability Ratio Test
    </a>
</li>
<li class="toctree-l2 current active">
<a class="current reference internal" href="#">
     Tutorial 2: Hidden Markov Model
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="W3D2_Tutorial3.html">
     Tutorial 3: The Kalman Filter
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="W3D2_Tutorial4.html">
     Bonus Tutorial 4: The Kalman Filter, part 2
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="W3D2_Tutorial5.html">
     Bonus Tutorial 5: Expectation Maximization for spiking neurons
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="W3D2_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="W3D2_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W3D3_OptimalControl/chapter_title.html">
   Optimal Control (W3D3)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
<label for="toctree-checkbox-22">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D3_OptimalControl/instructor/W3D3_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D3_OptimalControl/instructor/W3D3_Tutorial1.html">
     Tutorial 1: Optimal Control for Discrete States
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D3_OptimalControl/instructor/W3D3_Tutorial2.html">
     Tutorial 2: Optimal Control for Continuous State
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D3_OptimalControl/instructor/W3D3_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D3_OptimalControl/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D3_OptimalControl/instructor/W3D3_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W3D4_ReinforcementLearning/chapter_title.html">
   Reinforcement Learning (W3D4)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
<label for="toctree-checkbox-23">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D4_ReinforcementLearning/instructor/W3D4_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D4_ReinforcementLearning/instructor/W3D4_Tutorial1.html">
     Tutorial 1: Learning to Predict
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D4_ReinforcementLearning/instructor/W3D4_Tutorial2.html">
     Tutorial 2: Learning to Act: Multi-Armed Bandits
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D4_ReinforcementLearning/instructor/W3D4_Tutorial3.html">
     Tutorial 3: Learning to Act: Q-Learning
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D4_ReinforcementLearning/instructor/W3D4_Tutorial4.html">
     Tutorial 4: Model-Based Reinforcement Learning
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D4_ReinforcementLearning/instructor/W3D4_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D4_ReinforcementLearning/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D4_ReinforcementLearning/instructor/W3D4_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../W3D5_NetworkCausality/chapter_title.html">
   Network Causality (W3D5)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/>
<label for="toctree-checkbox-24">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D5_NetworkCausality/instructor/W3D5_Intro.html">
     Intro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D5_NetworkCausality/instructor/W3D5_Tutorial1.html">
     Tutorial 1: Interventions
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D5_NetworkCausality/instructor/W3D5_Tutorial2.html">
     Tutorial 2: Correlations
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D5_NetworkCausality/instructor/W3D5_Tutorial3.html">
     Tutorial 3: Simultaneous fitting/regression
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D5_NetworkCausality/instructor/W3D5_Tutorial4.html">
     Tutorial 4: Instrumental Variables
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D5_NetworkCausality/instructor/W3D5_Outro.html">
     Outro
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D5_NetworkCausality/further_reading.html">
     Suggested further readings
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../W3D5_NetworkCausality/instructor/W3D5_DaySummary.html">
     Day Summary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../../Module_WrapUps/StochasticProcesses.html">
   Stochastic Processes Wrap-Up
  </a>
</li>
</ul>
<p class="caption">
<span class="caption-text">
  Project Booklet
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="../../../projects/README.html">
   Introduction
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../../../projects/docs/project_guidance.html">
   Daily guide for projects
  </a>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../../projects/modelingsteps/intro.html">
   Modeling Step-by-Step Guide
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/>
<label for="toctree-checkbox-25">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../../projects/modelingsteps/ModelingSteps_1through4.html">
     Modeling Steps 1 - 4
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../../projects/modelingsteps/ModelingSteps_5through10.html">
     Modeling Steps 5 - 10
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../../projects/modelingsteps/TrainIllusionModel.html">
     Example Model Project: the Train Illusion
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../../projects/modelingsteps/TrainIllusionDataProject.html">
     Example Data Project: the Train Illusion
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../../projects/docs/datasets_overview.html">
   Datasets
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/>
<label for="toctree-checkbox-26">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../../projects/docs/neurons.html">
     Neurons
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" type="checkbox"/>
<label for="toctree-checkbox-27">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../../projects/neurons/README.html">
       Guide
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../../projects/neurons/neurons_videos.html">
       Overview videos
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../../projects/docs/fMRI.html">
     fMRI
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" type="checkbox"/>
<label for="toctree-checkbox-28">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../../projects/fMRI/README.html">
       Guide
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../../projects/fMRI/fMRI_videos.html">
       Overview videos
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../../projects/docs/ECoG.html">
     ECoG
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" type="checkbox"/>
<label for="toctree-checkbox-29">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../../projects/ECoG/README.html">
       Guide
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../../projects/ECoG/ECoG_videos.html">
       Overview videos
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../../projects/docs/behavior.html">
     Behavior
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" type="checkbox"/>
<label for="toctree-checkbox-30">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../../projects/behavior/README.html">
       Guide
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../../projects/behavior/behavior_videos.html">
       Overview videos
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../../projects/docs/theory.html">
     Theory
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" type="checkbox"/>
<label for="toctree-checkbox-31">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../../projects/theory/README.html">
       Guide
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../../../projects/docs/project_templates.html">
   Project Templates
  </a>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../../projects/docs/project_2020_highlights.html">
   Projects 2020
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" type="checkbox"/>
<label for="toctree-checkbox-32">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../../projects/docs/projects_2020/neurons.html">
     Neurons
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../../projects/docs/projects_2020/theory.html">
     Theory
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../../projects/docs/projects_2020/behavior.html">
     Behavior
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../../projects/docs/projects_2020/fMRI.html">
     fMRI
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../../projects/docs/projects_2020/eeg.html">
     EEG
    </a>
</li>
</ul>
</li>
</ul>
</div>
</nav></div>
<div class="bd-sidebar__bottom">
<!-- To handle the deprecated key -->
<div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>
</div>
</div>
<div id="rtd-footer-container"></div>
</div>
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
<div class="header-article row sticky-top noprint">
<div class="col py-1 d-flex header-article-main">
<div class="header-article__left">
<label class="headerbtn" data-placement="right" data-toggle="tooltip" for="__navigation" title="Toggle navigation">
<span class="headerbtn__icon-container">
<i class="fas fa-bars"></i>
</span>
</label>
</div>
<div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
<button aria-label="Launch interactive content" class="headerbtn menu-dropdown__trigger">
<i class="fas fa-rocket"></i>
</button>
<div class="menu-dropdown__content">
<ul>
</ul>
</div>
</div>
<button class="headerbtn" data-placement="bottom" data-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode">
<span class="headerbtn__icon-container">
<i class="fas fa-expand"></i>
</span>
</button>
<div class="menu-dropdown menu-dropdown-repository-buttons">
<button aria-label="Source repositories" class="headerbtn menu-dropdown__trigger">
<i class="fab fa-github"></i>
</button>
<div class="menu-dropdown__content">
<ul>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://github.com/NeuromatchAcademy/instructor-course-content" title="Source repository">
<span class="headerbtn__icon-container">
<i class="fab fa-github"></i>
</span>
<span class="headerbtn__text-container">repository</span>
</a>
</li>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://github.com/NeuromatchAcademy/instructor-course-content/issues/new?title=Issue%20on%20page%20%2Ftutorials/W3D2_HiddenDynamics/instructor/W3D2_Tutorial2.html&amp;body=Your%20issue%20content%20here." title="Open an issue">
<span class="headerbtn__icon-container">
<i class="fas fa-lightbulb"></i>
</span>
<span class="headerbtn__text-container">open issue</span>
</a>
</li>
</ul>
</div>
</div>
<div class="menu-dropdown menu-dropdown-download-buttons">
<button aria-label="Download this page" class="headerbtn menu-dropdown__trigger">
<i class="fas fa-download"></i>
</button>
<div class="menu-dropdown__content">
<ul>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="../../../_sources/tutorials/W3D2_HiddenDynamics/instructor/W3D2_Tutorial2.ipynb" title="Download source file">
<span class="headerbtn__icon-container">
<i class="fas fa-file"></i>
</span>
<span class="headerbtn__text-container">.ipynb</span>
</a>
</li>
<li>
<button class="headerbtn" data-placement="left" data-toggle="tooltip" onclick="printPdf(this)" title="Print to PDF">
<span class="headerbtn__icon-container">
<i class="fas fa-file-pdf"></i>
</span>
<span class="headerbtn__text-container">.pdf</span>
</button>
</li>
</ul>
</div>
</div>
<label class="headerbtn headerbtn-page-toc" for="__page-toc">
<span class="headerbtn__icon-container">
<i class="fas fa-list"></i>
</span>
</label>
</div>
</div>
<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
<div class="tocsection onthispage pt-5 pb-3">
<i class="fas fa-list"></i> Contents
    </div>
<nav aria-label="Page" id="bd-toc-nav">
<ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#">
   Tutorial 2: Hidden Markov Model
  </a>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#tutorial-objectives">
   Tutorial objectives
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-1-introduction">
     Video 1: Introduction
    </a>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#setup">
   Setup
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#figure-settings">
     Figure Settings
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#plotting-functions">
     Plotting Functions
    </a>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-1-binary-hmm-with-gaussian-measurements">
   Section 1: Binary HMM with Gaussian measurements
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-2-binary-hmm-with-gaussian-measurements">
     Video 2: Binary HMM with Gaussian measurements
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#coding-exercise-1-1-simulate-a-binary-hmm-with-gaussian-measurements">
     Coding Exercise 1.1: Simulate a binary HMM with Gaussian measurements
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-1-2-binary-hmm">
     Interactive Demo 1.2: Binary HMM
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id1">
</a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-3-section-1-exercises-discussion">
       Video 3: Section 1 Exercises Discussion
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-2-predicting-the-future-in-an-hmm">
   Section 2: Predicting the future in an HMM
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-4-forgetting-in-a-changing-world">
     Video 4: Forgetting in a changing world
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-2-1-forgetting-in-a-changing-world">
     Interactive Demo 2.1: Forgetting in a changing world
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-5-section-2-exercise-discussion">
       Video 5: Section 2 Exercise Discussion
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-3-forward-inference-in-an-hmm">
   Section 3: Forward inference in an HMM
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-6-inference-in-an-hmm">
     Video 6: Inference in an HMM
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#coding-exercise-3-1-forward-inference-of-hmm">
       Coding Exercise 3.1: Forward inference of HMM
      </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-3-2-forward-inference-in-binary-hmm">
     Interactive Demo 3.2: Forward inference in binary HMM
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-7-section-3-exercise-discussion">
       Video 7: Section 3 Exercise Discussion
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#summary">
   Summary
  </a>
</li>
</ul>
</nav>
</div>
</div>
<div class="article row">
<div class="col pl-md-3 pl-lg-5 content-container">
<!-- Table of contents that is only displayed when printing the page -->
<div class="onlyprint" id="jb-print-docs-body">
<h1>Tutorial 2: Hidden Markov Model</h1>
<!-- Table of contents -->
<div id="print-main-content">
<div id="jb-print-toc">
<div>
<h2> Contents </h2>
</div>
<nav aria-label="Page">
<ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#">
   Tutorial 2: Hidden Markov Model
  </a>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#tutorial-objectives">
   Tutorial objectives
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-1-introduction">
     Video 1: Introduction
    </a>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#setup">
   Setup
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#figure-settings">
     Figure Settings
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#plotting-functions">
     Plotting Functions
    </a>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-1-binary-hmm-with-gaussian-measurements">
   Section 1: Binary HMM with Gaussian measurements
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-2-binary-hmm-with-gaussian-measurements">
     Video 2: Binary HMM with Gaussian measurements
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#coding-exercise-1-1-simulate-a-binary-hmm-with-gaussian-measurements">
     Coding Exercise 1.1: Simulate a binary HMM with Gaussian measurements
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-1-2-binary-hmm">
     Interactive Demo 1.2: Binary HMM
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id1">
</a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-3-section-1-exercises-discussion">
       Video 3: Section 1 Exercises Discussion
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-2-predicting-the-future-in-an-hmm">
   Section 2: Predicting the future in an HMM
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-4-forgetting-in-a-changing-world">
     Video 4: Forgetting in a changing world
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-2-1-forgetting-in-a-changing-world">
     Interactive Demo 2.1: Forgetting in a changing world
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-5-section-2-exercise-discussion">
       Video 5: Section 2 Exercise Discussion
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-3-forward-inference-in-an-hmm">
   Section 3: Forward inference in an HMM
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-6-inference-in-an-hmm">
     Video 6: Inference in an HMM
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#coding-exercise-3-1-forward-inference-of-hmm">
       Coding Exercise 3.1: Forward inference of HMM
      </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-demo-3-2-forward-inference-in-binary-hmm">
     Interactive Demo 3.2: Forward inference in binary HMM
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-7-section-3-exercise-discussion">
       Video 7: Section 3 Exercise Discussion
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#summary">
   Summary
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<main id="main-content" role="main">
<div>
<p><a href="https://colab.research.google.com/github/NeuromatchAcademy/course-content/blob/main/tutorials/W3D2_HiddenDynamics/instructor/W3D2_Tutorial2.ipynb" target="_blank"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg"/></a>   <a href="https://kaggle.com/kernels/welcome?src=https://raw.githubusercontent.com/NeuromatchAcademy/course-content/main/tutorials/W3D2_HiddenDynamics/instructor/W3D2_Tutorial2.ipynb" target="_blank"><img alt="Open in Kaggle" src="https://kaggle.com/static/images/open-in-kaggle.svg"/></a></p>
<div class="section" id="tutorial-2-hidden-markov-model">
<h1>Tutorial 2: Hidden Markov Model<a class="headerlink" href="#tutorial-2-hidden-markov-model" title="Permalink to this headline">¶</a></h1>
<p><strong>Week 3, Day 2: Hidden Dynamics</strong></p>
<p><strong>By Neuromatch Academy</strong></p>
<p><strong>Content creators:</strong> Yicheng Fei with help from Jesse Livezey and Xaq Pitkow</p>
<p><strong>Content reviewers:</strong> John Butler, Matt Krause, Meenakshi Khosla, Spiros Chavlis, Michael Waskom</p>
<p><strong>Production editor:</strong> Ella Batty</p>
<p><strong>Post-production team</strong>: Gagana B, Spiros Chavlis</p>
</div>
<div class="section" id="tutorial-objectives">
<h1>Tutorial objectives<a class="headerlink" href="#tutorial-objectives" title="Permalink to this headline">¶</a></h1>
<p><em>Estimated timing of tutorial: 1 hour, 5 minutes</em></p>
<p>The world around us is often changing, but we only have noisy sensory measurements. Similarly, neural systems switch between discrete states (e.g. sleep/wake) which are observable only indirectly, through their impact on neural activity. <strong>Hidden Markov Models</strong> (HMM) let us reason about these unobserved (also called hidden or latent) states using a time series of measurements.</p>
<p>Here we’ll learn how changing the HMM’s transition probability and measurement noise impacts the data. We’ll look at how uncertainty increases as we predict the future, and how to gain information from the measurements.</p>
<p>We will use a binary latent variable <span class="math notranslate nohighlight">\(s_t \in \{0,1\}\)</span> that switches randomly between the two states, and a 1D Gaussian emission model <span class="math notranslate nohighlight">\(m_t|s_t \sim \mathcal{N}(\mu_{s_t},\sigma^2_{s_t})\)</span> that provides evidence about the current state.</p>
<p>By the end of this tutorial, you should be able to:</p>
<ul class="simple">
<li><p>Describe how the hidden states in a Hidden Markov model evolve over time, both in words, mathematically, and in code</p></li>
<li><p>Estimate hidden states from data using forward inference in a Hidden Markov model</p></li>
<li><p>Describe how measurement noise and state transition probabilities affect uncertainty in predictions in the future and the ability to estimate hidden states.</p></li>
</ul>
<br/>
<p><strong>Summary of Exercises</strong></p>
<ol class="simple">
<li><p>Generate data from an HMM.</p></li>
<li><p>Calculate how predictions propagate in a Markov Chain without evidence.</p></li>
<li><p>Combine new evidence and prediction from past evidence to estimate hidden states.</p></li>
</ol>
<div class="section" id="video-1-introduction">
<h2>Video 1: Introduction<a class="headerlink" href="#video-1-introduction" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_remove-input docutils container">
</div>
</div>
</div>
<div class="section" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">linear_sum_assignment</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">patches</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="figure-settings">
<h2>Figure Settings<a class="headerlink" href="#figure-settings" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Figure Settings</span>
<span class="c1"># import ipywidgets as widgets       # interactive display</span>
<span class="kn">from</span> <span class="nn">IPython.html</span> <span class="kn">import</span> <span class="n">widgets</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interactive</span><span class="p">,</span> <span class="n">interact</span><span class="p">,</span> <span class="n">HBox</span><span class="p">,</span> <span class="n">Layout</span><span class="p">,</span><span class="n">VBox</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = 'retina'
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/NeuromatchAcademy/course-content/NMA2020/nma.mplstyle"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plotting-functions">
<h2>Plotting Functions<a class="headerlink" href="#plotting-functions" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Plotting Functions</span>

<span class="k">def</span> <span class="nf">plot_hmm1</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">states</span><span class="p">,</span> <span class="n">measurements</span><span class="p">,</span> <span class="n">flag_m</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">  </span><span class="sd">"""Plots HMM states and measurements for 1d states and measurements.</span>

<span class="sd">  Args:</span>
<span class="sd">    model (hmmlearn model):               hmmlearn model used to get state means.</span>
<span class="sd">    states (numpy array of floats):       Samples of the states.</span>
<span class="sd">    measurements (numpy array of floats): Samples of the states.</span>
<span class="sd">  """</span>
  <span class="n">T</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">nsteps</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">size</span>
  <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
  <span class="n">states_forplot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">means</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">states</span><span class="p">))</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nstep</span><span class="p">),</span> <span class="n">states_forplot</span><span class="p">,</span> <span class="s2">"-"</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s2">"mid"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"green"</span><span class="p">)</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Time"</span><span class="p">)</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Latent State"</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"green"</span><span class="p">)</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s2">"-1"</span><span class="p">,</span> <span class="s2">"+1"</span><span class="p">])</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
  <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">measurements</span><span class="p">)</span>
  <span class="n">ymax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">measurements</span><span class="p">)</span>

  <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
  <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Measurements"</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"crimson"</span><span class="p">)</span>

  <span class="c1"># show measurement gaussian</span>
  <span class="k">if</span> <span class="n">flag_m</span><span class="p">:</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">T</span><span class="p">,</span><span class="n">T</span><span class="p">],</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s2">"maroon"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
      <span class="n">mu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
      <span class="n">rv</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
      <span class="n">num_points</span> <span class="o">=</span> <span class="mi">50</span>
      <span class="n">domain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mu</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">scale</span><span class="p">,</span> <span class="n">mu</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">scale</span><span class="p">,</span> <span class="n">num_points</span><span class="p">)</span>

      <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">num_points</span><span class="p">)</span>
      <span class="c1"># left = np.repeat(0.0, num_points)</span>
      <span class="n">offset</span> <span class="o">=</span> <span class="n">rv</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
      <span class="n">offset</span> <span class="o">*=</span> <span class="n">T</span> <span class="o">/</span> <span class="mi">15</span>
      <span class="n">lbl</span> <span class="o">=</span> <span class="s2">"measurement"</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">""</span>
      <span class="c1"># ax2.fill_betweenx(domain, left, left-offset, alpha=0.3, lw=2, color="maroon", label=lbl)</span>
      <span class="n">ax2</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">left</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"maroon"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>
      <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nstep</span><span class="p">),</span> <span class="n">measurements</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"crimson"</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
      <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">"upper left"</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_marginal_seq</span><span class="p">(</span><span class="n">predictive_probs</span><span class="p">,</span> <span class="n">switch_prob</span><span class="p">):</span>
<span class="w">  </span><span class="sd">"""Plots the sequence of marginal predictive distributions.</span>

<span class="sd">    Args:</span>
<span class="sd">      predictive_probs (list of numpy vectors): sequence of predictive probability vectors</span>
<span class="sd">      switch_prob (float):                      Probability of switching states.</span>
<span class="sd">  """</span>
  <span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictive_probs</span><span class="p">)</span>
  <span class="n">prob_neg</span> <span class="o">=</span> <span class="p">[</span><span class="n">p_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p_vec</span> <span class="ow">in</span> <span class="n">predictive_probs</span><span class="p">]</span>
  <span class="n">prob_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">p_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p_vec</span> <span class="ow">in</span> <span class="n">predictive_probs</span><span class="p">]</span>
  <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">prob_neg</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">prob_pos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"orange"</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span>
    <span class="s2">"prob in state -1"</span><span class="p">,</span> <span class="s2">"prob in state 1"</span>
  <span class="p">])</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s2">"switching probability=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">switch_prob</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
          <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round"</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">"wheat"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">))</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Time"</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Probability"</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Forgetting curve in a changing world"</span><span class="p">)</span>
  <span class="c1">#ax.set_aspect(aspect_ratio)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_evidence_vs_noevidence</span><span class="p">(</span><span class="n">posterior_matrix</span><span class="p">,</span> <span class="n">predictive_probs</span><span class="p">):</span>
<span class="w">  </span><span class="sd">"""Plots the average posterior probabilities with evidence v.s. no evidence</span>

<span class="sd">  Args:</span>
<span class="sd">    posterior_matrix: (2d numpy array of floats): The posterior probabilities in state 1 from evidence (samples, time)</span>
<span class="sd">    predictive_probs (numpy array of floats):  Predictive probabilities in state 1 without evidence</span>
<span class="sd">  """</span>
  <span class="n">nsample</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">posterior_matrix</span><span class="o">.</span><span class="n">shape</span>
  <span class="n">posterior_mean</span> <span class="o">=</span> <span class="n">posterior_matrix</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="c1"># ax.plot([0.0, T],[0.5, 0.5], color="red", linestyle="dashed")</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">T</span><span class="p">],[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">predictive_probs</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"orange"</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"No evidence"</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="p">(</span><span class="n">nsample</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">posterior_matrix</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"With evidence(Sample)"</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">posterior_mean</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">'green'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"With evidence(Average)"</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Time"</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Probability in State +1"</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Gain confidence with evidence"</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_forward_inference</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">states</span><span class="p">,</span> <span class="n">measurements</span><span class="p">,</span> <span class="n">states_inferred</span><span class="p">,</span>
                           <span class="n">predictive_probs</span><span class="p">,</span> <span class="n">likelihoods</span><span class="p">,</span> <span class="n">posterior_probs</span><span class="p">,</span>
                           <span class="n">t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">flag_m</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">flag_d</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">flag_pre</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">flag_like</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">flag_post</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="p">):</span>
<span class="w">  </span><span class="sd">"""Plot ground truth state sequence with noisy measurements, and ground truth states v.s. inferred ones</span>

<span class="sd">      Args:</span>
<span class="sd">          model (instance of hmmlearn.GaussianHMM): an instance of HMM</span>
<span class="sd">          states (numpy vector): vector of 0 or 1(int or Bool), the sequences of true latent states</span>
<span class="sd">          measurements (numpy vector of numpy vector): the un-flattened Gaussian measurements at each time point, element has size (1,)</span>
<span class="sd">          states_inferred (numpy vector): vector of 0 or 1(int or Bool), the sequences of inferred latent states</span>
<span class="sd">  """</span>
  <span class="n">T</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="o">-</span><span class="mi">1</span>
  <span class="n">nsteps</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">size</span>
  <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
  <span class="c1"># inferred states</span>
  <span class="c1">#ax1.step(np.arange(nstep)[:t+1], states_forplot[:t+1], "-", where="mid", alpha=1.0, c="orange", label="inferred")</span>
  <span class="c1"># true states</span>
  <span class="n">states_forplot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">means</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">states</span><span class="p">))</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nstep</span><span class="p">)[:</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">states_forplot</span><span class="p">[:</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="s2">"-"</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s2">"mid"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"true"</span><span class="p">)</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nstep</span><span class="p">)[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">:],</span> <span class="n">states_forplot</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">:],</span> <span class="s2">"-"</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s2">"mid"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
  <span class="c1"># Posterior curve</span>
  <span class="n">delta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">means</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">means</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">states_interpolation</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">means</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">posterior_probs</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">flag_post</span><span class="p">:</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nstep</span><span class="p">)[:</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">states_interpolation</span><span class="p">[:</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="s2">"-"</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s2">"mid"</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"grey"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"posterior"</span><span class="p">)</span>

  <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Time"</span><span class="p">)</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Latent State"</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"green"</span><span class="p">)</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s2">"-1"</span><span class="p">,</span> <span class="s2">"+1"</span><span class="p">])</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.02</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>



  <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
  <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span>
      <span class="nb">min</span><span class="p">(</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">measurements</span><span class="p">)),</span>
      <span class="nb">max</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">measurements</span><span class="p">))</span>
      <span class="p">)</span>
  <span class="k">if</span> <span class="n">flag_d</span><span class="p">:</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nstep</span><span class="p">)[:</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">measurements</span><span class="p">[:</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">"crimson"</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"measurement"</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Measurements"</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"crimson"</span><span class="p">)</span>

  <span class="c1"># show measurement distributions</span>
  <span class="k">if</span> <span class="n">flag_m</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
      <span class="n">mu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
      <span class="n">rv</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
      <span class="n">num_points</span> <span class="o">=</span> <span class="mi">50</span>
      <span class="n">domain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mu</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">scale</span><span class="p">,</span> <span class="n">mu</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">scale</span><span class="p">,</span> <span class="n">num_points</span><span class="p">)</span>

      <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">num_points</span><span class="p">)</span>
      <span class="n">offset</span> <span class="o">=</span> <span class="n">rv</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
      <span class="n">offset</span> <span class="o">*=</span> <span class="n">T</span> <span class="o">/</span><span class="mi">15</span>
      <span class="c1"># lbl = "measurement" if i == 0 else ""</span>
      <span class="n">lbl</span> <span class="o">=</span> <span class="s2">""</span>
      <span class="c1"># ax2.fill_betweenx(domain, left, left-offset, alpha=0.3, lw=2, color="maroon", label=lbl)</span>
      <span class="n">ax2</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">left</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"maroon"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>
  <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
  <span class="n">width</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
  <span class="n">centers</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
  <span class="n">bar_scale</span> <span class="o">=</span> <span class="mi">15</span>

  <span class="c1"># Predictions</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">predictive_probs</span>
  <span class="k">if</span> <span class="n">flag_pre</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
      <span class="n">domain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">centers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mf">1.5</span><span class="o">*</span><span class="n">width</span><span class="p">,</span> <span class="n">centers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">width</span><span class="p">])</span>
      <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">t</span><span class="p">,</span><span class="n">t</span><span class="p">])</span>
      <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">offset</span> <span class="o">*=</span> <span class="n">bar_scale</span>
      <span class="n">lbl</span> <span class="o">=</span> <span class="s2">"todays prior"</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">""</span>
      <span class="n">ax2</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">left</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"dodgerblue"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>

  <span class="c1"># Likelihoods</span>
  <span class="c1"># data = np.stack([likelihoods, 1.0-likelihoods],axis=-1)</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">likelihoods</span>
  <span class="n">data</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">flag_like</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
      <span class="n">domain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">centers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">width</span><span class="p">,</span> <span class="n">centers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">1.5</span><span class="o">*</span><span class="n">width</span><span class="p">])</span>
      <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">t</span><span class="p">,</span><span class="n">t</span><span class="p">])</span>
      <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">offset</span> <span class="o">*=</span> <span class="n">bar_scale</span>
      <span class="n">lbl</span> <span class="o">=</span> <span class="s2">"likelihood"</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">""</span>
      <span class="n">ax2</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">left</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"crimson"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>
  <span class="c1"># Posteriors</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">posterior_probs</span>
  <span class="k">if</span> <span class="n">flag_post</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
      <span class="n">domain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">centers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">width</span><span class="p">,</span> <span class="n">centers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">width</span><span class="p">])</span>
      <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">t</span><span class="p">,</span><span class="n">t</span><span class="p">])</span>
      <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">offset</span> <span class="o">*=</span> <span class="n">bar_scale</span>
      <span class="n">lbl</span> <span class="o">=</span> <span class="s2">"posterior"</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">""</span>
      <span class="n">ax2</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">left</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"grey"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t</span><span class="p">,</span><span class="n">t</span><span class="p">],</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">flag_pre</span> <span class="ow">or</span> <span class="n">flag_like</span> <span class="ow">or</span> <span class="n">flag_post</span><span class="p">:</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t</span><span class="p">,</span><span class="n">t</span><span class="p">],</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">1.02</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>
  <span class="k">return</span> <span class="n">fig</span>
  <span class="c1"># plt.show(fig)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<hr class="docutils"/>
<div class="section" id="section-1-binary-hmm-with-gaussian-measurements">
<h1>Section 1: Binary HMM with Gaussian measurements<a class="headerlink" href="#section-1-binary-hmm-with-gaussian-measurements" title="Permalink to this headline">¶</a></h1>
<p>In contrast to last tutorial, the latent state in an HMM is not fixed, but may switch to a different state at each time step. The time dependence is simple: the probability of the state at time <span class="math notranslate nohighlight">\(t\)</span> is wholly determined by the state at time <span class="math notranslate nohighlight">\(t-1\)</span>. This is called called the <strong>Markov property</strong> and the dependency of the whole state sequence <span class="math notranslate nohighlight">\(\{s_1,...,s_t\}\)</span> can be described by a chain structure called a Markov Chain. You have seen a Markov chain in the <a class="reference external" href="https://compneuro.neuromatch.io/tutorials/W0D5_Statistics/student/W0D5_Tutorial2.html#section-1-2-markov-chains">pre-reqs Statistics day</a> and in the <a class="reference external" href="https://compneuro.neuromatch.io/tutorials/W2D2_LinearSystems/student/W2D2_Tutorial2.html">Linear Systems Tutorial 2</a>.</p>
<p><strong>Markov model for binary latent dynamics</strong></p>
<p>Let’s reuse the binary switching process you saw in the <a class="reference external" href="https://compneuro.neuromatch.io/tutorials/W2D2_LinearSystems/student/W2D2_Tutorial2.html">Linear Systems Tutorial 2</a>: our state can be either +1 or -1. The probability of switching to state <span class="math notranslate nohighlight">\(s_t=j\)</span> from the previous state <span class="math notranslate nohighlight">\(s_{t-1}=i\)</span> is the conditional probability distribution <span class="math notranslate nohighlight">\(p(s_t = j| s_{t-1} = i)\)</span>. We can summarize these as a <span class="math notranslate nohighlight">\(2\times 2\)</span> matrix we will denote <span class="math notranslate nohighlight">\(D\)</span> for Dynamics.</p>
<div class="amsmath math notranslate nohighlight" id="equation-ce300f16-a32c-4602-ad1c-c9d3634f45d3">
<span class="eqno">(374)<a class="headerlink" href="#equation-ce300f16-a32c-4602-ad1c-c9d3634f45d3" title="Permalink to this equation">¶</a></span>\[\begin{align}
D = \begin{bmatrix}p(s_t = +1 | s_{t-1} = +1) &amp; p(s_t = -1 | s_{t-1} = +1)\\p(s_t = +1 | s_{t-1} = -1)&amp; p(s_t = -1 | s_{t-1} = -1)\end{bmatrix}
\end{align}\]</div>
<p><span class="math notranslate nohighlight">\(D_{ij}\)</span> represents the transition probability to switch from state <span class="math notranslate nohighlight">\(i\)</span> to state <span class="math notranslate nohighlight">\(j\)</span> at next time step. Please note that this is in contrast to the meaning used in the intro and in Linear Systems (their transition matrices are the transpose of ours) but syncs with the <a class="reference external" href="https://compneuro.neuromatch.io/tutorials/W0D5_Statistics/student/W0D5_Tutorial2.html#section-1-2-markov-chains">pre-reqs Statistics day</a>.</p>
<p>We can represent the probability of the <em>current</em> state as a 2-dimensional vector</p>
<div class="amsmath math notranslate nohighlight" id="equation-0d881cb1-380f-4060-82f1-24139b214f33">
<span class="eqno">(375)<a class="headerlink" href="#equation-0d881cb1-380f-4060-82f1-24139b214f33" title="Permalink to this equation">¶</a></span>\[\begin{equation}
P_t = [p(s_t = +1), p(s_t = -1)]
\end{equation}\]</div>
<p>The entries are the probability that the current state is +1 and the probability that the current state is -1 so these must sum up to 1.</p>
<p>We then update the probabilities over time following the Markov process:</p>
<div class="amsmath math notranslate nohighlight" id="equation-56761940-996d-403a-a77a-5e550022a2b6">
<span class="eqno">(376)<a class="headerlink" href="#equation-56761940-996d-403a-a77a-5e550022a2b6" title="Permalink to this equation">¶</a></span>\[\begin{equation}
P_{t}= P_{t-1}D \tag{1}
\end{equation}\]</div>
<p>If you know the state, the entries of <span class="math notranslate nohighlight">\(P_{t-1}\)</span> would be either 1 or 0 as there is no uncertainty.</p>
<p><strong>Measurements</strong></p>
<p>In a <em>Hidden Markov Model</em>, we cannot directly observe the latent states <span class="math notranslate nohighlight">\(s_t\)</span>. Instead we get noisy measurements <span class="math notranslate nohighlight">\(m_t\sim p(m|s_t)\)</span>.</p>
<div class="section" id="video-2-binary-hmm-with-gaussian-measurements">
<h2>Video 2: Binary HMM with Gaussian measurements<a class="headerlink" href="#video-2-binary-hmm-with-gaussian-measurements" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_remove-input docutils container">
</div>
</div>
<div class="section" id="coding-exercise-1-1-simulate-a-binary-hmm-with-gaussian-measurements">
<h2>Coding Exercise 1.1: Simulate a binary HMM with Gaussian measurements<a class="headerlink" href="#coding-exercise-1-1-simulate-a-binary-hmm-with-gaussian-measurements" title="Permalink to this headline">¶</a></h2>
<p>In this exercise, you will implement a binary HMM with Gaussian measurements. Your HMM will start in State +1 and transition between states (both <span class="math notranslate nohighlight">\(-1 \rightarrow 1\)</span> and <span class="math notranslate nohighlight">\(1 \rightarrow -1\)</span>) with probability <code class="docutils literal notranslate"><span class="pre">switch_prob</span></code>. Each state emits measurements drawn from a Gaussian with mean <span class="math notranslate nohighlight">\(+1\)</span> for State +1 and mean <span class="math notranslate nohighlight">\(-1\)</span> for State -1. The standard deviation of both states is given by <code class="docutils literal notranslate"><span class="pre">noise_level</span></code>.</p>
<p>The exercises in the next cell have three steps:</p>
<p><strong>STEP 1</strong>. In <code class="docutils literal notranslate"><span class="pre">create_HMM</span></code>, complete the transition matrix  <code class="docutils literal notranslate"><span class="pre">transmat_</span></code> (i.e., <span class="math notranslate nohighlight">\(D\)</span>) in the code.</p>
<div class="amsmath math notranslate nohighlight" id="equation-525fb91a-a74a-4aa2-b32a-3eb5543b47e2">
<span class="eqno">(377)<a class="headerlink" href="#equation-525fb91a-a74a-4aa2-b32a-3eb5543b47e2" title="Permalink to this equation">¶</a></span>\[\begin{equation}
D = 
\begin{pmatrix}
p_{\rm stay} &amp; p_{\rm switch} \\
p_{\rm switch} &amp; p_{\rm stay} \\
\end{pmatrix}
\end{equation}\]</div>
<p>with <span class="math notranslate nohighlight">\(p_{\rm stay} = 1 - p_{\rm switch}\)</span>.</p>
<p><strong>STEP 2</strong>. In <code class="docutils literal notranslate"><span class="pre">create_HMM</span></code>, specify gaussian measurements <span class="math notranslate nohighlight">\(m_t | s_t\)</span>, by specifying the means for each state, and the standard deviation.</p>
<p><strong>STEP 3</strong>. In <code class="docutils literal notranslate"><span class="pre">sample</span></code>, use the transition matrix to specify the probabilities for the next state <span class="math notranslate nohighlight">\(s_t\)</span> given the previous state <span class="math notranslate nohighlight">\(s_{t-1}\)</span>.</p>
<p>In this exercise, we will use a helper data structure named <code class="docutils literal notranslate"><span class="pre">GaussianHMM1D</span></code>, implemented in the following cell. This allows us to set the information we need about the HMM model (the starting probabilities of state, the transition matrix, the means and variances of the Gaussian distributions, and the number of components) and easily access it. For example, if we can set our model using:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>  <span class="n">model</span> <span class="o">=</span> <span class="n">GaussianHMM1D</span><span class="p">(</span>
    <span class="n">startprob</span> <span class="o">=</span> <span class="n">startprob_vec</span><span class="p">,</span>
    <span class="n">transmat</span> <span class="o">=</span> <span class="n">transmat_mat</span><span class="p">,</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">means_vec</span><span class="p">,</span>
    <span class="nb">vars</span> <span class="o">=</span> <span class="n">vars_vec</span><span class="p">,</span>
    <span class="n">n_components</span> <span class="o">=</span> <span class="n">n_components</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>and then access the variances as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">vars</span>
</pre></div>
</div>
<p>Also note that we refer to the states as <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">1</span></code> in the code, instead of as <code class="docutils literal notranslate"><span class="pre">-1</span></code> and <code class="docutils literal notranslate"><span class="pre">+1</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">GaussianHMM1D</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">'GaussianHMM1D'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'startprob'</span><span class="p">,</span> <span class="s1">'transmat'</span><span class="p">,</span><span class="s1">'means'</span><span class="p">,</span><span class="s1">'vars'</span><span class="p">,</span><span class="s1">'n_components'</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="k">def</span> <span class="nf">create_HMM</span><span class="p">(</span><span class="n">switch_prob</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">noise_level</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">startprob</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]):</span>
<span class="w">  </span><span class="sd">"""Create an HMM with binary state variable and 1D Gaussian measurements</span>
<span class="sd">  The probability to switch to the other state is `switch_prob`. Two</span>
<span class="sd">  measurement models have mean 1.0 and -1.0 respectively. `noise_level`</span>
<span class="sd">  specifies the standard deviation of the measurement models.</span>

<span class="sd">  Args:</span>
<span class="sd">      switch_prob (float): probability to jump to the other state</span>
<span class="sd">      noise_level (float): standard deviation of measurement models. Same for</span>
<span class="sd">      two components</span>

<span class="sd">  Returns:</span>
<span class="sd">      model (GaussianHMM instance): the described HMM</span>
<span class="sd">  """</span>

  <span class="c1">############################################################################</span>
  <span class="c1"># Insert your code here to:</span>
  <span class="c1">#   * Create the transition matrix, `transmat_mat` so that the odds of</span>
  <span class="c1">#      switching is `switch_prob`</span>
  <span class="c1">#		* Set the measurement model variances, to `noise_level ^ 2` for both</span>
  <span class="c1">#      states</span>
  <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"`create_HMM` is incomplete"</span><span class="p">)</span>
  <span class="c1">############################################################################</span>

  <span class="n">n_components</span> <span class="o">=</span> <span class="mi">2</span>

  <span class="n">startprob_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">startprob</span><span class="p">)</span>

  <span class="c1"># STEP 1: Transition probabilities</span>
  <span class="n">transmat_mat</span> <span class="o">=</span> <span class="o">...</span> <span class="c1"># np.array([[...], [...]])</span>

  <span class="c1"># STEP 2: Measurement probabilities</span>

  <span class="c1"># Mean measurements for each state</span>
  <span class="n">means_vec</span> <span class="o">=</span> <span class="o">...</span>

  <span class="c1"># Noise for each state</span>
  <span class="n">vars_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="o">...</span>

  <span class="c1"># Initialize model</span>
  <span class="n">model</span> <span class="o">=</span> <span class="n">GaussianHMM1D</span><span class="p">(</span>
    <span class="n">startprob</span> <span class="o">=</span> <span class="n">startprob_vec</span><span class="p">,</span>
    <span class="n">transmat</span> <span class="o">=</span> <span class="n">transmat_mat</span><span class="p">,</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">means_vec</span><span class="p">,</span>
    <span class="nb">vars</span> <span class="o">=</span> <span class="n">vars_vec</span><span class="p">,</span>
    <span class="n">n_components</span> <span class="o">=</span> <span class="n">n_components</span>
  <span class="p">)</span>

  <span class="k">return</span> <span class="n">model</span>

<span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
<span class="w">  </span><span class="sd">"""Generate samples from the given HMM</span>

<span class="sd">  Args:</span>
<span class="sd">    model (GaussianHMM1D): the HMM with Gaussian measurement</span>
<span class="sd">    T (int): number of time steps to sample</span>

<span class="sd">  Returns:</span>
<span class="sd">    M (numpy vector): the series of measurements</span>
<span class="sd">    S (numpy vector): the series of latent states</span>

<span class="sd">  """</span>
  <span class="c1">############################################################################</span>
  <span class="c1"># Insert your code here to:</span>
  <span class="c1">#   * take row i from `model.transmat` to get the transition probabilities</span>
  <span class="c1">#       from state i to all states</span>
  <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"`sample` is incomplete"</span><span class="p">)</span>
  <span class="c1">############################################################################</span>
  <span class="c1"># Initialize S and M</span>
  <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">T</span><span class="p">,),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
  <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">T</span><span class="p">,))</span>

  <span class="c1"># Calculate initial state</span>
  <span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">p</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">startprob</span><span class="p">)</span>

  <span class="c1"># Latent state at time `t` depends on `t-1` and the corresponding transition probabilities to other states</span>
  <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="p">):</span>

    <span class="c1"># STEP 3: Get vector of probabilities for all possible `S[t]` given a particular `S[t-1]`</span>
    <span class="n">transition_vector</span> <span class="o">=</span> <span class="o">...</span>

    <span class="c1"># Calculate latent state at time `t`</span>
    <span class="n">S</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">p</span><span class="o">=</span><span class="n">transition_vector</span><span class="p">)</span>

  <span class="c1"># Calculate measurements conditioned on the latent states</span>
  <span class="c1"># Since measurements are independent of each other given the latent states, we could calculate them as a batch</span>
  <span class="n">means</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">means</span><span class="p">[</span><span class="n">S</span><span class="p">]</span>
  <span class="n">scales</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">S</span><span class="p">])</span>
  <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">means</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scales</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">T</span><span class="p">,))</span>

  <span class="k">return</span> <span class="n">M</span><span class="p">,</span> <span class="n">S</span>


<span class="c1"># Set random seed</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span>

<span class="c1"># Set parameters of HMM</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">switch_prob</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">noise_level</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="c1"># Create HMM</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">create_HMM</span><span class="p">(</span><span class="n">switch_prob</span><span class="o">=</span><span class="n">switch_prob</span><span class="p">,</span> <span class="n">noise_level</span><span class="o">=</span><span class="n">noise_level</span><span class="p">)</span>

<span class="c1"># Sample from HMM</span>
<span class="n">M</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">M</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="p">(</span><span class="n">T</span><span class="p">,)</span>
<span class="k">assert</span> <span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="p">(</span><span class="n">T</span><span class="p">,)</span>

<span class="c1"># Print values</span>
<span class="nb">print</span><span class="p">(</span><span class="n">M</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">S</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>

</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to_remove solution</span>

<span class="k">def</span> <span class="nf">create_HMM</span><span class="p">(</span><span class="n">switch_prob</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">noise_level</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">startprob</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]):</span>
<span class="w">  </span><span class="sd">"""Create an HMM with binary state variable and 1D Gaussian measurements</span>
<span class="sd">  The probability to switch to the other state is `switch_prob`. Two</span>
<span class="sd">  measurement models have mean 1.0 and -1.0 respectively. `noise_level`</span>
<span class="sd">  specifies the standard deviation of the measurement models.</span>

<span class="sd">  Args:</span>
<span class="sd">      switch_prob (float): probability to jump to the other state</span>
<span class="sd">      noise_level (float): standard deviation of measurement models. Same for</span>
<span class="sd">      two components</span>

<span class="sd">  Returns:</span>
<span class="sd">      model (GaussianHMM instance): the described HMM</span>
<span class="sd">  """</span>

  <span class="n">n_components</span> <span class="o">=</span> <span class="mi">2</span>

  <span class="n">startprob_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">startprob</span><span class="p">)</span>

  <span class="c1"># STEP 1: Transition probabilities</span>
  <span class="n">transmat_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">switch_prob</span><span class="p">,</span> <span class="n">switch_prob</span><span class="p">],</span> <span class="p">[</span><span class="n">switch_prob</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">switch_prob</span><span class="p">]])</span> <span class="c1"># # np.array([[...], [...]])</span>

  <span class="c1"># STEP 2: Measurement probabilities</span>

  <span class="c1"># Mean measurements for each state</span>
  <span class="n">means_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>

  <span class="c1"># Noise for each state</span>
  <span class="n">vars_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">noise_level</span> <span class="o">*</span> <span class="n">noise_level</span>

  <span class="c1"># Initialize model</span>
  <span class="n">model</span> <span class="o">=</span> <span class="n">GaussianHMM1D</span><span class="p">(</span>
    <span class="n">startprob</span> <span class="o">=</span> <span class="n">startprob_vec</span><span class="p">,</span>
    <span class="n">transmat</span> <span class="o">=</span> <span class="n">transmat_mat</span><span class="p">,</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">means_vec</span><span class="p">,</span>
    <span class="nb">vars</span> <span class="o">=</span> <span class="n">vars_vec</span><span class="p">,</span>
    <span class="n">n_components</span> <span class="o">=</span> <span class="n">n_components</span>
  <span class="p">)</span>

  <span class="k">return</span> <span class="n">model</span>


<span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
<span class="w">  </span><span class="sd">"""Generate samples from the given HMM</span>

<span class="sd">  Args:</span>
<span class="sd">    model (GaussianHMM1D): the HMM with Gaussian measurement</span>
<span class="sd">    T (int): number of time steps to sample</span>

<span class="sd">  Returns:</span>
<span class="sd">    M (numpy vector): the series of measurements</span>
<span class="sd">    S (numpy vector): the series of latent states</span>

<span class="sd">  """</span>
  <span class="c1"># Initialize S and M</span>
  <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">T</span><span class="p">,),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
  <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">T</span><span class="p">,))</span>

  <span class="c1"># Calculate initial state</span>
  <span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">p</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">startprob</span><span class="p">)</span>

  <span class="c1"># Latent state at time `t` depends on `t-1` and the corresponding transition probabilities to other states</span>
  <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="p">):</span>

    <span class="c1"># STEP 3: Get vector of probabilities for all possible `S[t]` given a particular `S[t-1]`</span>
    <span class="n">transition_vector</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transmat</span><span class="p">[</span><span class="n">S</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">],:]</span>

    <span class="c1"># Calculate latent state at time `t`</span>
    <span class="n">S</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">p</span><span class="o">=</span><span class="n">transition_vector</span><span class="p">)</span>

  <span class="c1"># Calculate measurements conditioned on the latent states</span>
  <span class="c1"># Since measurements are independent of each other given the latent states, we could calculate them as a batch</span>
  <span class="n">means</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">means</span><span class="p">[</span><span class="n">S</span><span class="p">]</span>
  <span class="n">scales</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">S</span><span class="p">])</span>
  <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">means</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scales</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">T</span><span class="p">,))</span>

  <span class="k">return</span> <span class="n">M</span><span class="p">,</span> <span class="n">S</span>


<span class="c1"># Set random seed</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span>

<span class="c1"># Set parameters of HMM</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">switch_prob</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">noise_level</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="c1"># Create HMM</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">create_HMM</span><span class="p">(</span><span class="n">switch_prob</span><span class="o">=</span><span class="n">switch_prob</span><span class="p">,</span> <span class="n">noise_level</span><span class="o">=</span><span class="n">noise_level</span><span class="p">)</span>

<span class="c1"># Sample from HMM</span>
<span class="n">M</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">M</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="p">(</span><span class="n">T</span><span class="p">,)</span>
<span class="k">assert</span> <span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="p">(</span><span class="n">T</span><span class="p">,)</span>

<span class="c1"># Print values</span>
<span class="nb">print</span><span class="p">(</span><span class="n">M</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">S</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>You should see that the first five measurements are:</p>
<p><code class="docutils literal notranslate"><span class="pre">[-3.09355908</span>  <span class="pre">1.58552915</span> <span class="pre">-3.93502804</span> <span class="pre">-1.98819072</span> <span class="pre">-1.32506947]</span></code></p>
<p>while the first five states are:</p>
<p><code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0]</span></code></p>
</div>
<div class="section" id="interactive-demo-1-2-binary-hmm">
<h2>Interactive Demo 1.2: Binary HMM<a class="headerlink" href="#interactive-demo-1-2-binary-hmm" title="Permalink to this headline">¶</a></h2>
<p>In the demo below, we simulate and plot a similar HMM. You can change the probability of switching states and the noise level (the standard deviation of the Gaussian distributions for measurements). You can click the empty box to also visualize the measurements.</p>
<p><strong>First</strong>, think about and discuss these questions:</p>
<ol class="simple">
<li><p>What will the states do if the switching probability is zero? One?</p></li>
<li><p>What will measurements look like with high noise? Low?</p></li>
</ol>
<p><strong>Then</strong>, play with the demo to see if you were correct or not.</p>
<div class="section" id="id1">
<h3><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Execute this cell to enable the widget!</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title</span>

<span class="c1">#@markdown Execute this cell to enable the widget!</span>

<span class="n">nstep</span> <span class="o">=</span> <span class="mi">100</span>

<span class="nd">@widgets</span><span class="o">.</span><span class="n">interact</span>
<span class="k">def</span> <span class="nf">plot_samples_widget</span><span class="p">(</span>
    <span class="n">switch_prob</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
    <span class="n">log10_noise_level</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=-</span><span class="mf">1.</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">.01</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mf">0.3</span><span class="p">),</span>
    <span class="n">flag_m</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">'measurements'</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">):</span>
  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span>
  <span class="n">model</span> <span class="o">=</span> <span class="n">create_HMM</span><span class="p">(</span><span class="n">switch_prob</span><span class="o">=</span><span class="n">switch_prob</span><span class="p">,</span>
                     <span class="n">noise_level</span><span class="o">=</span><span class="mf">10.</span><span class="o">**</span><span class="n">log10_noise_level</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
  <span class="n">observations</span><span class="p">,</span> <span class="n">states</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">nstep</span><span class="p">)</span>
  <span class="n">plot_hmm1</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">states</span><span class="p">,</span> <span class="n">observations</span><span class="p">,</span> <span class="n">flag_m</span><span class="o">=</span><span class="n">flag_m</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to_remove explanation</span>

<span class="sd">"""</span>

<span class="sd">1) With 0 switching probability, the HMM stays</span>
<span class="sd">in one state the whole time. With switching probability of 1, the HMM switches state</span>
<span class="sd">every single step.</span>

<span class="sd">2) With high noise, the measurements don't track the underlying latent state very well. With</span>
<span class="sd">low noise the latent state plot (green) and measurement plot (blue) look identical</span>
<span class="sd">"""</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="video-3-section-1-exercises-discussion">
<h3>Video 3: Section 1 Exercises Discussion<a class="headerlink" href="#video-3-section-1-exercises-discussion" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_remove-input docutils container">
</div>
<p><strong>Applications</strong>. Measurements could be:</p>
<ul class="simple">
<li><p>fish caught at different times as the school of fish moves from left to right</p></li>
<li><p>membrane voltage when an ion channel changes between open and closed</p></li>
<li><p>EEG frequency measurements as the brain moves between sleep states</p></li>
</ul>
<p>What phenomena can you imagine modeling with these HMMs?</p>
</div>
</div>
</div>
<hr class="docutils"/>
<div class="section" id="section-2-predicting-the-future-in-an-hmm">
<h1>Section 2: Predicting the future in an HMM<a class="headerlink" href="#section-2-predicting-the-future-in-an-hmm" title="Permalink to this headline">¶</a></h1>
<p><em>Estimated timing to here from start of tutorial: 20 min</em></p>
<div class="section" id="video-4-forgetting-in-a-changing-world">
<h2>Video 4: Forgetting in a changing world<a class="headerlink" href="#video-4-forgetting-in-a-changing-world" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_remove-input docutils container">
</div>
</div>
<div class="section" id="interactive-demo-2-1-forgetting-in-a-changing-world">
<h2>Interactive Demo 2.1: Forgetting in a changing world<a class="headerlink" href="#interactive-demo-2-1-forgetting-in-a-changing-world" title="Permalink to this headline">¶</a></h2>
<p>Even if we know the world state for sure, the world changes. We become less and less certain as time goes by since our last measurement. In this exercise, we’ll see how a Hidden Markov Model gradually “forgets” the current state when predicting the future without measurements.</p>
<p>Assume we know that the initial state is -1, <span class="math notranslate nohighlight">\(s_0=-1\)</span>, so <span class="math notranslate nohighlight">\(p(s_0)=[1,0]\)</span>. We will plot <span class="math notranslate nohighlight">\(p(s_t)\)</span> versus time.</p>
<ol class="simple">
<li><p>Examine helper function <code class="docutils literal notranslate"><span class="pre">simulate_prediction_only</span></code> and understand how the predicted distribution changes over time.</p></li>
<li><p>Using our provided code, plot this distribution over time, and manipulate the process dynamics via the slider controlling the switching probability.</p></li>
</ol>
<p>Do you forget more quickly with low or high switching probability? Why? How does the curve look when <code class="docutils literal notranslate"><span class="pre">prob_switch</span></code> <span class="math notranslate nohighlight">\(&gt;0.5\)</span>? Why?</p>
<p>Execute this cell to enable helper function <code class="docutils literal notranslate"><span class="pre">simulate_prediction_only</span></code></p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @markdown Execute this cell to enable helper function `simulate_prediction_only`</span>

<span class="k">def</span> <span class="nf">simulate_prediction_only</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">nstep</span><span class="p">):</span>
<span class="w">  </span><span class="sd">"""</span>
<span class="sd">  Simulate the diffusion of HMM with no observations</span>

<span class="sd">  Args:</span>
<span class="sd">    model (GaussianHMM1D instance): the HMM instance</span>
<span class="sd">    nstep (int): total number of time steps to simulate(include initial time)</span>

<span class="sd">  Returns:</span>
<span class="sd">    predictive_probs (list of numpy vector): the list of marginal probabilities</span>
<span class="sd">  """</span>
  <span class="n">entropy_list</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">predictive_probs</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">prob</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">startprob</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nstep</span><span class="p">):</span>

    <span class="c1"># Log probabilities</span>
    <span class="n">predictive_probs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span>

    <span class="c1"># One step forward</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="n">prob</span> <span class="o">@</span> <span class="n">model</span><span class="o">.</span><span class="n">transmat</span>

  <span class="k">return</span> <span class="n">predictive_probs</span>
</pre></div>
</div>
</div>
</div>
<p>Execute this cell to enable the widget!</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @markdown Execute this cell to enable the widget!</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">noise_level</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="nd">@widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">switch_prob</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.1</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">switch_prob</span><span class="o">=</span><span class="n">switch_prob</span><span class="p">):</span>
  <span class="n">model</span> <span class="o">=</span> <span class="n">create_HMM</span><span class="p">(</span><span class="n">switch_prob</span><span class="o">=</span><span class="n">switch_prob</span><span class="p">,</span> <span class="n">noise_level</span><span class="o">=</span><span class="n">noise_level</span><span class="p">)</span>
  <span class="n">predictive_probs</span> <span class="o">=</span> <span class="n">simulate_prediction_only</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
  <span class="n">plot_marginal_seq</span><span class="p">(</span><span class="n">predictive_probs</span><span class="p">,</span> <span class="n">switch_prob</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to_remove explanation</span>

<span class="sd">"""</span>
<span class="sd">1) You forget more quickly with high switching probability because you become less</span>
<span class="sd">certain that the state is the one you know.</span>

<span class="sd">2) With switch_prob &gt; 0.5, the predictive probabilities cross over 0 and eventually oscillate.</span>

<span class="sd">"""</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="video-5-section-2-exercise-discussion">
<h3>Video 5: Section 2 Exercise Discussion<a class="headerlink" href="#video-5-section-2-exercise-discussion" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_remove-input docutils container">
</div>
</div>
</div>
</div>
<div class="section" id="section-3-forward-inference-in-an-hmm">
<h1>Section 3: Forward inference in an HMM<a class="headerlink" href="#section-3-forward-inference-in-an-hmm" title="Permalink to this headline">¶</a></h1>
<p><em>Estimated timing to here from start of tutorial: 35 min</em></p>
<div class="section" id="video-6-inference-in-an-hmm">
<h2>Video 6: Inference in an HMM<a class="headerlink" href="#video-6-inference-in-an-hmm" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_remove-input docutils container">
</div>
<div class="section" id="coding-exercise-3-1-forward-inference-of-hmm">
<h3>Coding Exercise 3.1: Forward inference of HMM<a class="headerlink" href="#coding-exercise-3-1-forward-inference-of-hmm" title="Permalink to this headline">¶</a></h3>
<p>As a recursive algorithm, let’s assume we already have yesterday’s posterior from time <span class="math notranslate nohighlight">\(t-1\)</span>: <span class="math notranslate nohighlight">\(p(s_{t-1}|m_{1:t-1})\)</span>. When the new data <span class="math notranslate nohighlight">\(m_{t}\)</span> comes in, the algorithm performs the following steps:</p>
<ul class="simple">
<li><p><strong>Predict</strong>: transform yesterday’s posterior over <span class="math notranslate nohighlight">\(s_{t-1}\)</span> into today’s prior over <span class="math notranslate nohighlight">\(s_t\)</span> using the transition matrix <span class="math notranslate nohighlight">\(D\)</span>:</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-0484f1c5-a55e-44c4-ab91-5fa864f76029">
<span class="eqno">(378)<a class="headerlink" href="#equation-0484f1c5-a55e-44c4-ab91-5fa864f76029" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\text{today's prior}=p(s_t|m_{1:t-1})= p(s_{t-1}|m_{1:t-1}) D
\end{equation}\]</div>
<ul class="simple">
<li><p><strong>Update</strong>: Incorporate measurement <span class="math notranslate nohighlight">\(m_t\)</span> to calculate the posterior <span class="math notranslate nohighlight">\(p(s_t|m_{0:t})\)</span></p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-f2599cf7-d911-4860-9617-f80c0ea664d4">
<span class="eqno">(379)<a class="headerlink" href="#equation-f2599cf7-d911-4860-9617-f80c0ea664d4" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\text{posterior} \propto \text{prior}\cdot \text{likelihood}=p(m_t|s_t)p(s_t|m_{0:t-1})
\end{equation}\]</div>
<p>In this exercise, you will:</p>
<ul class="simple">
<li><p>STEP 1: Complete the code in function <code class="docutils literal notranslate"><span class="pre">markov_forward</span></code> to calculate the predictive marginal distribution at next time step</p></li>
<li><p>STEP 2: Complete the code in function <code class="docutils literal notranslate"><span class="pre">one_step_update</span></code> to combine predictive probabilities and data likelihood into a new posterior</p>
<ul>
<li><p>Hint: We have provided a function to calculate the likelihood of <span class="math notranslate nohighlight">\(m_t\)</span> under the two possible states: <code class="docutils literal notranslate"><span class="pre">compute_likelihood(model,M_t)</span></code>.</p></li>
</ul>
</li>
<li><p>STEP 3: Using code we provide, plot the posterior and compare with the true values</p></li>
</ul>
<p>The complete forward inference is implemented in <code class="docutils literal notranslate"><span class="pre">simulate_forward_inference</span></code> which just calls <code class="docutils literal notranslate"><span class="pre">one_step_update</span></code> recursively.</p>
<p>Execute to enable helper functions <code class="docutils literal notranslate"><span class="pre">compute_likelihood</span></code> and <code class="docutils literal notranslate"><span class="pre">simulate_forward_inference</span></code></p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @markdown Execute to enable helper functions `compute_likelihood` and `simulate_forward_inference`</span>

<span class="k">def</span> <span class="nf">compute_likelihood</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
<span class="w">  </span><span class="sd">"""</span>
<span class="sd">  Calculate likelihood of seeing data `M` for all measurement models</span>

<span class="sd">  Args:</span>
<span class="sd">    model (GaussianHMM1D): HMM</span>
<span class="sd">    M (float or numpy vector)</span>

<span class="sd">  Returns:</span>
<span class="sd">    L (numpy vector or matrix): the likelihood</span>
<span class="sd">  """</span>
  <span class="n">rv0</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">means</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
  <span class="n">rv1</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">means</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
  <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">rv0</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">M</span><span class="p">),</span> <span class="n">rv1</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">M</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">L</span><span class="o">.</span><span class="n">size</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
  <span class="k">return</span> <span class="n">L</span>


<span class="k">def</span> <span class="nf">simulate_forward_inference</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">  </span><span class="sd">"""</span>
<span class="sd">  Given HMM `model`, calculate posterior marginal predictions of x_t for T-1 time steps ahead based on</span>
<span class="sd">  evidence `data`. If `data` is not give, generate a sequence of measurements from first component.</span>

<span class="sd">  Args:</span>
<span class="sd">    model (GaussianHMM instance): the HMM</span>
<span class="sd">    T (int): length of returned array</span>

<span class="sd">  Returns:</span>
<span class="sd">    predictive_state1: predictive probabilities in first state w.r.t no evidence</span>
<span class="sd">    posterior_state1: posterior probabilities in first state w.r.t evidence</span>
<span class="sd">  """</span>

  <span class="c1"># First re-calculate hte predictive probabilities without evidence</span>
  <span class="c1"># predictive_probs = simulate_prediction_only(model, T)</span>
  <span class="n">predictive_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">T</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
  <span class="n">likelihoods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">T</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
  <span class="n">posterior_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">T</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
  <span class="c1"># Generate an measurement trajectory condtioned on that latent state x is always 1</span>
  <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">data</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">means</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">T</span><span class="p">,))</span>

  <span class="c1"># Calculate marginal for each latent state x_t</span>
  <span class="n">predictive_probs</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">startprob</span>
  <span class="n">likelihoods</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">compute_likelihood</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">M</span><span class="p">[[</span><span class="mi">0</span><span class="p">]])</span>
  <span class="n">posterior</span> <span class="o">=</span> <span class="n">predictive_probs</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">*</span> <span class="n">likelihoods</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
  <span class="n">posterior</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">posterior</span><span class="p">)</span>
  <span class="n">posterior_probs</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">posterior</span>

  <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="n">prediction</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">posterior</span> <span class="o">=</span> <span class="n">one_step_update</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">posterior_probs</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">M</span><span class="p">[[</span><span class="n">t</span><span class="p">]])</span>
    <span class="c1"># normalize and add to the list</span>
    <span class="n">posterior</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">posterior</span><span class="p">)</span>
    <span class="n">predictive_probs</span><span class="p">[</span><span class="n">t</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">prediction</span>
    <span class="n">likelihoods</span><span class="p">[</span><span class="n">t</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">likelihood</span>
    <span class="n">posterior_probs</span><span class="p">[</span><span class="n">t</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">posterior</span>
  <span class="k">return</span> <span class="n">predictive_probs</span><span class="p">,</span> <span class="n">likelihoods</span><span class="p">,</span> <span class="n">posterior_probs</span>

<span class="n">help</span><span class="p">(</span><span class="n">compute_likelihood</span><span class="p">)</span>
<span class="n">help</span><span class="p">(</span><span class="n">simulate_forward_inference</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="k">def</span> <span class="nf">markov_forward</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
<span class="w">  </span><span class="sd">"""Calculate the forward predictive distribution in a discrete Markov chain</span>

<span class="sd">  Args:</span>
<span class="sd">    p0 (numpy vector): a discrete probability vector</span>
<span class="sd">    D (numpy matrix): the transition matrix, D[i,j] means the prob. to</span>
<span class="sd">    switch FROM i TO j</span>

<span class="sd">  Returns:</span>
<span class="sd">    p1 (numpy vector): the predictive probabilities in next time step</span>
<span class="sd">  """</span>
  <span class="c1">##############################################################################</span>
  <span class="c1"># Insert your code here to:</span>
  <span class="c1">#    1. Calculate the predicted probabilities at next time step using the</span>
  <span class="c1">#      probabilities at current time and the transition matrix</span>
  <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"`markov_forward` is incomplete"</span><span class="p">)</span>
  <span class="c1">##############################################################################</span>

  <span class="c1"># Calculate predictive probabilities (prior)</span>
  <span class="n">p1</span> <span class="o">=</span> <span class="o">...</span>

  <span class="k">return</span> <span class="n">p1</span>

<span class="k">def</span> <span class="nf">one_step_update</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">posterior_tm1</span><span class="p">,</span> <span class="n">M_t</span><span class="p">):</span>
<span class="w">  </span><span class="sd">"""Given a HMM model, calculate the one-time-step updates to the posterior.</span>
<span class="sd">  Args:</span>
<span class="sd">    model (GaussianHMM1D instance): the HMM</span>
<span class="sd">    posterior_tm1 (numpy vector): Posterior at `t-1`</span>
<span class="sd">    M_t (numpy array): measurement at `t`</span>

<span class="sd">  Returns:</span>
<span class="sd">    posterior_t (numpy array): Posterior at `t`</span>
<span class="sd">  """</span>
  <span class="c1">##############################################################################</span>
  <span class="c1"># Insert your code here to:</span>
  <span class="c1">#    1. Call function `markov_forward` to calculate the prior for next time</span>
  <span class="c1">#      step</span>
  <span class="c1">#    2. Calculate likelihood of seeing current data `M_t` under both states</span>
  <span class="c1">#      as a vector.</span>
  <span class="c1">#    3. Calculate the posterior which is proportional to</span>
  <span class="c1">#      likelihood x prediction elementwise,</span>
  <span class="c1">#    4. Don't forget to normalize</span>
  <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"`one_step_update` is incomplete"</span><span class="p">)</span>
  <span class="c1">##############################################################################</span>

  <span class="c1"># Calculate predictive probabilities (prior)</span>
  <span class="n">prediction</span> <span class="o">=</span> <span class="n">markov_forward</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

  <span class="c1"># Get the likelihood</span>
  <span class="n">likelihood</span> <span class="o">=</span> <span class="n">compute_likelihood</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

  <span class="c1"># Calculate posterior</span>
  <span class="n">posterior_t</span> <span class="o">=</span> <span class="o">...</span>

  <span class="c1"># Normalize</span>
  <span class="n">posterior_t</span> <span class="o">/=</span> <span class="o">...</span>

  <span class="k">return</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">posterior_t</span>


<span class="c1"># Set random seed</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Set parameters</span>
<span class="n">switch_prob</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">noise_level</span> <span class="o">=</span> <span class="mf">.4</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">75</span>

<span class="c1"># Create and sample from model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">create_HMM</span><span class="p">(</span><span class="n">switch_prob</span> <span class="o">=</span> <span class="n">switch_prob</span><span class="p">,</span>
                    <span class="n">noise_level</span> <span class="o">=</span> <span class="n">noise_level</span><span class="p">,</span>
                    <span class="n">startprob</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>

<span class="n">measurements</span><span class="p">,</span> <span class="n">states</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">nstep</span><span class="p">)</span>

<span class="c1"># Infer state sequence</span>
<span class="n">predictive_probs</span><span class="p">,</span> <span class="n">likelihoods</span><span class="p">,</span> <span class="n">posterior_probs</span> <span class="o">=</span> <span class="n">simulate_forward_inference</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">nstep</span><span class="p">,</span>
                                                            <span class="n">measurements</span><span class="p">)</span>
<span class="n">states_inferred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">posterior_probs</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Visualize</span>
<span class="n">plot_forward_inference</span><span class="p">(</span>
      <span class="n">model</span><span class="p">,</span> <span class="n">states</span><span class="p">,</span> <span class="n">measurements</span><span class="p">,</span> <span class="n">states_inferred</span><span class="p">,</span>
      <span class="n">predictive_probs</span><span class="p">,</span> <span class="n">likelihoods</span><span class="p">,</span> <span class="n">posterior_probs</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">flag_m</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">)</span>

</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to_remove solution</span>

<span class="k">def</span> <span class="nf">markov_forward</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
<span class="w">  </span><span class="sd">"""Calculate the forward predictive distribution in a discrete Markov chain</span>

<span class="sd">  Args:</span>
<span class="sd">    p0 (numpy vector): a discrete probability vector</span>
<span class="sd">    D (numpy matrix): the transition matrix, D[i,j] means the prob. to</span>
<span class="sd">    switch FROM i TO j</span>

<span class="sd">  Returns:</span>
<span class="sd">    p1 (numpy vector): the predictive probabilities in next time step</span>
<span class="sd">  """</span>

  <span class="c1"># Calculate predictive probabilities (prior)</span>
  <span class="n">p1</span> <span class="o">=</span> <span class="n">p0</span> <span class="o">@</span> <span class="n">D</span>

  <span class="k">return</span> <span class="n">p1</span>

<span class="k">def</span> <span class="nf">one_step_update</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">posterior_tm1</span><span class="p">,</span> <span class="n">M_t</span><span class="p">):</span>
<span class="w">  </span><span class="sd">"""Given a HMM model, calculate the one-time-step updates to the posterior.</span>
<span class="sd">  Args:</span>
<span class="sd">    model (GaussianHMM1D instance): the HMM</span>
<span class="sd">    posterior_tm1 (numpy vector): Posterior at `t-1`</span>
<span class="sd">    M_t (numpy array): measurements at `t`</span>
<span class="sd">    Returns:</span>
<span class="sd">    posterior_t (numpy array): Posterior at `t`</span>
<span class="sd">  """</span>
  <span class="c1"># Calculate predictive probabilities (prior)</span>
  <span class="n">prediction</span> <span class="o">=</span> <span class="n">markov_forward</span><span class="p">(</span><span class="n">posterior_tm1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">transmat</span><span class="p">)</span>

  <span class="c1"># Get the likelihood</span>
  <span class="n">likelihood</span> <span class="o">=</span> <span class="n">compute_likelihood</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">M_t</span><span class="p">)</span>

  <span class="c1"># Calculate posterior</span>
  <span class="n">posterior_t</span> <span class="o">=</span> <span class="n">prediction</span> <span class="o">*</span> <span class="n">likelihood</span>

  <span class="c1"># Normalize</span>
  <span class="n">posterior_t</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">posterior_t</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">posterior_t</span>


<span class="c1"># Set random seed</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Set parameters</span>
<span class="n">switch_prob</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">noise_level</span> <span class="o">=</span> <span class="mf">.4</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">75</span>

<span class="c1"># Create and sample from model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">create_HMM</span><span class="p">(</span><span class="n">switch_prob</span> <span class="o">=</span> <span class="n">switch_prob</span><span class="p">,</span>
                    <span class="n">noise_level</span> <span class="o">=</span> <span class="n">noise_level</span><span class="p">,</span>
                    <span class="n">startprob</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>

<span class="n">measurements</span><span class="p">,</span> <span class="n">states</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">nstep</span><span class="p">)</span>

<span class="c1"># Infer state sequence</span>
<span class="n">predictive_probs</span><span class="p">,</span> <span class="n">likelihoods</span><span class="p">,</span> <span class="n">posterior_probs</span> <span class="o">=</span> <span class="n">simulate_forward_inference</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">nstep</span><span class="p">,</span>
                                                            <span class="n">measurements</span><span class="p">)</span>
<span class="n">states_inferred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">posterior_probs</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Visualize</span>
<span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">xkcd</span><span class="p">():</span>
  <span class="n">plot_forward_inference</span><span class="p">(</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">states</span><span class="p">,</span> <span class="n">measurements</span><span class="p">,</span> <span class="n">states_inferred</span><span class="p">,</span>
        <span class="n">predictive_probs</span><span class="p">,</span> <span class="n">likelihoods</span><span class="p">,</span> <span class="n">posterior_probs</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">flag_m</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="interactive-demo-3-2-forward-inference-in-binary-hmm">
<h2>Interactive Demo 3.2: Forward inference in binary HMM<a class="headerlink" href="#interactive-demo-3-2-forward-inference-in-binary-hmm" title="Permalink to this headline">¶</a></h2>
<p>Now visualize your inference algorithm. Play with the sliders and checkboxes to help you gain intuition.</p>
<ul class="simple">
<li><p>Use the sliders <code class="docutils literal notranslate"><span class="pre">switch_prob</span></code> and <code class="docutils literal notranslate"><span class="pre">log10_noise_level</span></code> to change the switching probability and measurement noise level.</p></li>
<li><p>Use the slider <code class="docutils literal notranslate"><span class="pre">t</span></code> to view prediction (prior) probabilities, likelihood, and posteriors at different times.</p></li>
</ul>
<p>When does the inference make a mistake? For example, set <code class="docutils literal notranslate"><span class="pre">switch_prob=0.1</span></code>, <code class="docutils literal notranslate"><span class="pre">log_10_noise_level=-0.2</span></code>, and take a look at the probabilities at time <code class="docutils literal notranslate"><span class="pre">t=2</span></code>.</p>
<p>Execute this cell to enable the demo</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @markdown Execute this cell to enable the demo</span>

<span class="n">nstep</span> <span class="o">=</span> <span class="mi">100</span>

<span class="nd">@widgets</span><span class="o">.</span><span class="n">interact</span>
<span class="k">def</span> <span class="nf">plot_forward_inference_widget</span><span class="p">(</span>
    <span class="n">switch_prob</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.05</span><span class="p">),</span>
    <span class="n">log10_noise_level</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=-</span><span class="mf">1.</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">.01</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
    <span class="n">t</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">nstep</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">nstep</span><span class="o">//</span><span class="mi">2</span><span class="p">),</span>
    <span class="c1">#flag_m=widgets.Checkbox(value=True, description='measurement distribution', disabled=False, indent=False),</span>
    <span class="n">flag_d</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">'measurements'</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">flag_pre</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">'todays prior'</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">flag_like</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">'likelihood'</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">flag_post</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">'posterior'</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="p">):</span>

  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">102</span><span class="p">)</span>

  <span class="c1"># global model, measurements, states, states_inferred, predictive_probs, likelihoods, posterior_probs</span>
  <span class="n">model</span> <span class="o">=</span> <span class="n">create_HMM</span><span class="p">(</span><span class="n">switch_prob</span><span class="o">=</span><span class="n">switch_prob</span><span class="p">,</span>
                      <span class="n">noise_level</span><span class="o">=</span><span class="mf">10.</span><span class="o">**</span><span class="n">log10_noise_level</span><span class="p">,</span>
                      <span class="n">startprob</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
  <span class="n">measurements</span><span class="p">,</span> <span class="n">states</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">nstep</span><span class="p">)</span>

  <span class="c1"># Infer state sequence</span>
  <span class="n">predictive_probs</span><span class="p">,</span> <span class="n">likelihoods</span><span class="p">,</span> <span class="n">posterior_probs</span> <span class="o">=</span> <span class="n">simulate_forward_inference</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">nstep</span><span class="p">,</span>
                                                              <span class="n">measurements</span><span class="p">)</span>
  <span class="n">states_inferred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">posterior_probs</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

  <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_forward_inference</span><span class="p">(</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">states</span><span class="p">,</span> <span class="n">measurements</span><span class="p">,</span> <span class="n">states_inferred</span><span class="p">,</span>
        <span class="n">predictive_probs</span><span class="p">,</span> <span class="n">likelihoods</span><span class="p">,</span> <span class="n">posterior_probs</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span>
        <span class="n">flag_m</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">flag_d</span><span class="o">=</span><span class="n">flag_d</span><span class="p">,</span><span class="n">flag_pre</span><span class="o">=</span><span class="n">flag_pre</span><span class="p">,</span><span class="n">flag_like</span><span class="o">=</span><span class="n">flag_like</span><span class="p">,</span><span class="n">flag_post</span><span class="o">=</span><span class="n">flag_post</span>
      <span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="video-7-section-3-exercise-discussion">
<h3>Video 7: Section 3 Exercise Discussion<a class="headerlink" href="#video-7-section-3-exercise-discussion" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_remove-input docutils container">
</div>
</div>
</div>
</div>
<hr class="docutils"/>
<div class="section" id="summary">
<h1>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h1>
<p><em>Estimated timing of tutorial: 1 hour, 5 minutes</em></p>
<p>In this tutorial, you</p>
<ul class="simple">
<li><p>Simulated the dynamics of the hidden state in a Hidden Markov model and visualized the measured data (Section 1)</p></li>
<li><p>Explored how uncertainty in a future hidden state changes based on the probabilities of switching between states (Section 2)</p></li>
<li><p>Estimated hidden states from the measurements using forward inference, connected this to Bayesian ideas, and explored the effects of noise and transition matrix probabilities on this process (Section 3)</p></li>
</ul>
</div>
<script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./tutorials/W3D2_HiddenDynamics/instructor"
        },
        predefinedOutput: true
    }
    </script>
<script>kernelName = 'python3'</script>
</div>
</main>
<footer class="footer-article noprint">
<!-- Previous / next buttons -->
<div class="prev-next-area">
<a class="left-prev" href="W3D2_Tutorial1.html" id="prev-link" title="previous page">
<i class="fas fa-angle-left"></i>
<div class="prev-next-info">
<p class="prev-next-subtitle">previous</p>
<p class="prev-next-title">Tutorial 1: Sequential Probability Ratio Test</p>
</div>
</a>
<a class="right-next" href="W3D2_Tutorial3.html" id="next-link" title="next page">
<div class="prev-next-info">
<p class="prev-next-subtitle">next</p>
<p class="prev-next-title">Tutorial 3: The Kalman Filter</p>
</div>
<i class="fas fa-angle-right"></i>
</a>
</div>
</footer>
</div>
</div>
<div class="footer-content row">
<footer class="col footer"><p>
  
    By Neuromatch<br>
<div class="extra_footer">
<div>
<a href="http://creativecommons.org/licenses/by/4.0/"><img src="https://i.creativecommons.org/l/by/4.0/88x31.png"/></a>
<a href="https://opensource.org/licenses/BSD-3-Clause"><img src="https://camo.githubusercontent.com/9b9ea65d95c9ef878afa1987df65731d47681336/68747470733a2f2f696d672e736869656c64732e696f2f707970692f6c2f736561626f726e2e737667"/></a>
The contents of this repository are shared under the <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
Software elements are additionally licensed under the <a href="https://opensource.org/licenses/BSD-3-Clause">BSD (3-Clause) License</a>.
</div>
</div>
</br></p>
</footer>
</div>
</div>
</div>
</div>
<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
</body>
</html>